import{ab as _e,r as V,c as p,w as H,t as le,n as Q,j as _,e as v,o as r,k as l,aa as S,x as o,f as e,g as t,l as i,a7 as T,a8 as Y,a5 as M,a6 as O,ac as at,b as Se,a9 as pe,a3 as W,ad as lt}from"./element-plus-CvrI1lB2.js";import{_ as se,i as st,a as fe,b as he,c as ge,d as ze,e as be,h as nt,j as rt,k as ot,u as it,l as ut}from"./index-BA_4wflW.js";import{i as dt}from"./installMarkPoint-DRgdH7kI.js";import{bd as ye,cF as ke}from"./echarts-Cq7vAPzK.js";const ct={class:"quality-trend-chart"},mt={class:"chart-header"},vt={class:"period-selector"},pt={key:0,class:"trend-analysis"},_t={class:"trend-metrics"},ft={class:"metric"},ht={class:"metric"},gt={class:"metric"},bt={class:"metric-value prediction"},yt={__name:"QualityTrendChart",props:{title:{type:String,default:"质量趋势"},trendData:{type:Object,required:!0},showAnalysis:{type:Boolean,default:!0},height:{type:String,default:"350px"},threshold:{type:Number,default:5}},setup(z){_e(d=>({"2975c2eb":m.height})),ye([st,fe,he,ge,ze,be,nt,dt]);const m=z,D=V(null),k=V(null),C=V("weekly"),I=p(()=>m.trendData[C.value]||{dates:[],total:[],passed:[],failed:[],prediction:[]}),E=p(()=>{const{dates:d,total:u,failed:h}=I.value;return d.map((g,w)=>u[w]===0||u[w]===null||h[w]===null?null:+(h[w]/u[w]*100).toFixed(2))}),L=p(()=>{const{prediction:d}=I.value,u=E.value.length,h=u-1,g=Array(u).fill(null);if(h>=0&&(g[h]=E.value[h]),d&&d.length){const w=d.filter(X=>X!==null);return[...g,...w]}return g}),y=p(()=>{const{dates:d}=I.value,u=L.value.filter(g=>g!==null).length;d.length;const h=[...d];if(u>0){const g=u-1;for(let w=1;w<=g;w++)C.value==="weekly"?h.push(`预测${w}`):C.value==="monthly"?h.push(`预测${w}`):C.value==="quarterly"&&h.push(`预测${w}`)}return h}),b=p(()=>{const d=E.value.filter(h=>h!==null);return d.length===0?0:(d.reduce((h,g)=>h+g,0)/d.length).toFixed(2)}),$=p(()=>{const d=E.value.filter(q=>q!==null);if(d.length<2)return"stable";const u=d.length,h=Array.from({length:u},(q,B)=>B),g=h.reduce((q,B)=>q+B,0),w=d.reduce((q,B)=>q+B,0),X=h.reduce((q,B,ie)=>q+B*d[ie],0),oe=h.reduce((q,B)=>q+B*B,0),ee=(u*X-g*w)/(u*oe-g*g);return Math.abs(ee)<.1?"stable":ee>0?"increasing":"decreasing"}),A=p(()=>{switch($.value){case"increasing":return"上升";case"decreasing":return"下降";default:return"稳定"}}),a=p(()=>{switch($.value){case"increasing":return"el-icon-top";case"decreasing":return"el-icon-bottom";default:return"el-icon-minus"}}),N=p(()=>{switch($.value){case"increasing":return"trend-up";case"decreasing":return"trend-down";default:return"trend-stable"}}),G=p(()=>{const d=parseFloat(b.value);return d>m.threshold?"value-warning":d>m.threshold/2?"value-notice":"value-good"}),f=p(()=>{const d=L.value.filter(u=>u!==null);return d.length<=1?"无数据":d[d.length-1].toFixed(2)}),j=p(()=>parseFloat(f.value)>m.threshold),J=p(()=>$.value==="increasing"?"不良率趋势上升":parseFloat(f.value)>m.threshold?"预测不良率超出阈值":""),Z=p(()=>parseFloat(f.value)>m.threshold*1.5?"error":parseFloat(f.value)>m.threshold?"warning":"info"),ne=p(()=>$.value==="increasing"&&parseFloat(f.value)>m.threshold?`预测不良率将持续上升至${f.value}%，已超过${m.threshold}%的阈值标准，建议采取预防措施。`:$.value==="increasing"?"不良率呈上升趋势，虽未超出阈值，仍建议关注。":parseFloat(f.value)>m.threshold?`预测不良率${f.value}%已超过${m.threshold}%的阈值标准，建议关注。`:""),re=()=>{D.value&&(k.value&&k.value.dispose(),k.value=ke(D.value),R())},R=()=>{if(!k.value)return;const d={tooltip:{trigger:"axis",formatter:function(u){let h=u[0].axisValueLabel+"<br/>";return u.forEach(g=>{g.value!==null&&(h+=`${g.marker} ${g.seriesName}: ${g.value}%<br/>`)}),h}},legend:{data:["不良率","预测趋势"],bottom:0},grid:{left:"3%",right:"4%",bottom:"10%",top:"8%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:y.value,axisLabel:{interval:0,rotate:y.value.length>7?30:0}},yAxis:{type:"value",name:"不良率(%)",min:0,max:u=>{const h=Math.max(...E.value.filter(g=>g!==null),...L.value.filter(g=>g!==null));return Math.max(m.threshold*2,h*1.2)},axisLine:{show:!0},splitLine:{show:!0,lineStyle:{type:"dashed"}}},series:[{name:"不良率",type:"line",smooth:!0,data:E.value,itemStyle:{color:"#409EFF"},markLine:{silent:!0,lineStyle:{color:"#F56C6C",type:"dashed"},data:[{yAxis:m.threshold,name:"阈值线",label:{formatter:`阈值 ${m.threshold}%`,position:"end"}}]},markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]}},{name:"预测趋势",type:"line",smooth:!0,data:L.value,itemStyle:{color:"#E6A23C"},lineStyle:{type:"dashed"}}]};k.value.setOption(d)};return window.addEventListener("resize",()=>{k.value&&k.value.resize()}),H(C,()=>{Q(()=>{R()})}),H(()=>m.trendData,()=>{Q(()=>{R()})},{deep:!0}),le(()=>{Q(()=>{re()})}),(d,u)=>{const h=_("el-radio-button"),g=_("el-radio-group"),w=_("el-alert");return r(),v("div",ct,[l("div",mt,[l("h3",null,o(z.title),1),l("div",vt,[e(g,{modelValue:C.value,"onUpdate:modelValue":u[0]||(u[0]=X=>C.value=X),size:"small"},{default:t(()=>[e(h,{label:"weekly"},{default:t(()=>u[1]||(u[1]=[i("周")])),_:1,__:[1]}),e(h,{label:"monthly"},{default:t(()=>u[2]||(u[2]=[i("月")])),_:1,__:[2]}),e(h,{label:"quarterly"},{default:t(()=>u[3]||(u[3]=[i("季度")])),_:1,__:[3]})]),_:1},8,["modelValue"])])]),l("div",{class:"chart-container",ref_key:"chartContainer",ref:D},null,512),z.showAnalysis?(r(),v("div",pt,[u[7]||(u[7]=l("h4",null,"趋势分析",-1)),l("div",_t,[l("div",ft,[u[4]||(u[4]=l("span",{class:"metric-label"},"平均不良率:",-1)),l("span",{class:Y(["metric-value",G.value])},o(b.value)+"%",3)]),l("div",ht,[u[5]||(u[5]=l("span",{class:"metric-label"},"趋势方向:",-1)),l("span",{class:Y(["metric-value",N.value])},[l("i",{class:Y(a.value)},null,2),i(" "+o(A.value),1)],2)]),l("div",gt,[u[6]||(u[6]=l("span",{class:"metric-label"},"预测值:",-1)),l("span",bt,o(f.value)+"%",1)])]),j.value?(r(),T(w,{key:0,title:J.value,type:Z.value,description:ne.value,"show-icon":""},null,8,["title","type","description"])):S("",!0)])):S("",!0)])}}},kt=se(yt,[["__scopeId","data-v-184e9c4b"]]),Ct={class:"batch-comparison-radar"},wt={class:"chart-header"},xt={class:"batch-selection"},$t={class:"chart-legend"},Dt={class:"legend-label"},Vt={key:0,class:"chart-analysis"},St={key:0,class:"insights"},At={__name:"BatchComparisonRadar",props:{title:{type:String,default:"批次质量参数对比"},batchData:{type:Object,required:!0},availableBatches:{type:Array,default:()=>[]},analysisText:{type:String,default:""},insights:{type:Array,default:()=>[]},height:{type:String,default:"400px"}},setup(z){_e(y=>({e8508f4a:m.height})),ye([rt,fe,he,ge,be]);const m=z,D={standard:"#409EFF","#03, #04":"#F56C6C","#B12, #B13":"#E6A23C","#C09":"#67C23A","#A22, #A23":"#F56C6C","#B15, #B16":"#E6A23C","#C12":"#67C23A"},k=V(null),C=V(null),I=V(["standard"]),E=()=>{k.value&&(C.value&&C.value.dispose(),C.value=ke(k.value),L())},L=()=>{if(!C.value||!m.batchData)return;const y=[],b=m.batchData.standard||{};Object.keys(b).forEach(a=>{y.push({name:a,max:100})});const $=[{type:"radar",data:[]}];I.value.forEach(a=>{if(m.batchData[a]){const N=Object.keys(b).map(G=>m.batchData[a][G]||0);$[0].data.push({value:N,name:a,areaStyle:{opacity:a==="standard"?.1:.3},lineStyle:{width:a==="standard"?2:1.5,type:"solid"},itemStyle:{color:D[a]||"#409EFF"},symbolSize:6})}});const A={tooltip:{trigger:"item"},radar:{indicator:y,center:["50%","50%"],radius:"65%",splitNumber:5,shape:"circle",axisName:{color:"#666",fontSize:12},splitArea:{areaStyle:{color:["rgba(250,250,250,0.3)","rgba(200,200,200,0.1)"]}},splitLine:{lineStyle:{color:["#ddd"]}},axisLine:{lineStyle:{color:"#ddd"}}},series:$};C.value.setOption(A)};return window.addEventListener("resize",()=>{C.value&&C.value.resize()}),H(I,()=>{Q(()=>{L()})}),H(()=>m.batchData,()=>{Q(()=>{L()})},{deep:!0}),le(()=>{Q(()=>{E()})}),(y,b)=>{const $=_("el-checkbox"),A=_("el-checkbox-group");return r(),v("div",Ct,[l("div",wt,[l("h3",null,o(z.title),1),l("div",xt,[e(A,{modelValue:I.value,"onUpdate:modelValue":b[0]||(b[0]=a=>I.value=a)},{default:t(()=>[(r(!0),v(M,null,O(z.availableBatches,a=>(r(),T($,{key:a,label:a},{default:t(()=>[i(o(a),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])]),l("div",{class:"chart-container",ref_key:"chartContainer",ref:k},null,512),l("div",$t,[(r(),v(M,null,O(D,(a,N)=>l("div",{class:"legend-item",key:N},[l("span",{class:"color-dot",style:at({backgroundColor:a})},null,4),l("span",Dt,o(N),1)])),64))]),z.analysisText?(r(),v("div",Vt,[b[2]||(b[2]=l("h4",null,"批次分析:",-1)),l("p",null,o(z.analysisText),1),z.insights&&z.insights.length?(r(),v("div",St,[b[1]||(b[1]=l("h4",null,"关键发现:",-1)),l("ul",null,[(r(!0),v(M,null,O(z.insights,(a,N)=>(r(),v("li",{key:N},o(a),1))),128))])])):S("",!0)])):S("",!0)])}}},Ae=se(At,[["__scopeId","data-v-3c8b0303"]]),Ft={class:"risk-factor-chart"},zt={class:"chart-header"},Nt={class:"risk-score"},Rt={key:0,class:"risk-recommendations"},It={class:"recommendations-list"},Et={class:"recommendation-header"},Tt={class:"priority-tag"},Lt={class:"recommendation-title"},Bt={class:"recommendation-description"},Pt={__name:"RiskFactorChart",props:{title:{type:String,default:"风险因子分析"},riskData:{type:Object,required:!0},height:{type:String,default:"300px"}},setup(z){_e($=>({"0799b54d":m.height})),ye([ot,fe,he,ge,ze,be]);const m=z,D=V(null),k=V(null),C=p(()=>!m.riskData||!m.riskData.riskFactors?[]:m.riskData.riskFactors),I=p(()=>!m.riskData||!m.riskData.recommendations?[]:m.riskData.recommendations),E=p(()=>!m.riskData||!m.riskData.riskScore?"无":m.riskData.riskScore),L=p(()=>{const $=Number(E.value);return isNaN($)?"":$>=85?"score-high":$>=70?"score-medium":"score-low"}),y=()=>{D.value&&(k.value&&k.value.dispose(),k.value=ke(D.value),b())},b=()=>{if(!k.value||!C.value||C.value.length===0)return;const $=C.value.map(f=>f.name),A=C.value.map(f=>f.value),a=C.value.map(f=>f.color||"#409EFF"),N=C.value.map(f=>f.description||""),G={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(f){const j=f[0].dataIndex;return`<div>
          <strong>${$[j]}</strong><br/>
          风险值: ${A[j]}<br/>
          ${N[j]||""}
        </div>`}},grid:{left:"3%",right:"4%",bottom:"3%",top:"8%",containLabel:!0},xAxis:{type:"value",name:"风险值",max:100,axisLabel:{formatter:"{value}"}},yAxis:{type:"category",data:$,axisLabel:{formatter:function(f){return f.length>10?f.substring(0,10)+"...":f}}},series:[{name:"风险值",type:"bar",data:A.map((f,j)=>({value:f,itemStyle:{color:a[j]}})),label:{show:!0,position:"right",formatter:"{c}"},barWidth:"60%"}]};k.value.setOption(G)};return window.addEventListener("resize",()=>{k.value&&k.value.resize()}),H(()=>m.riskData,()=>{Q(()=>{b()})},{deep:!0}),le(()=>{Q(()=>{y()})}),($,A)=>(r(),v("div",Ft,[l("div",zt,[l("h3",null,o(z.title),1),l("div",Nt,[A[0]||(A[0]=i(" 风险评分: ")),l("span",{class:Y(["score",L.value])},o(E.value),3)])]),l("div",{class:"chart-container",ref_key:"chartContainer",ref:D},null,512),I.value&&I.value.length?(r(),v("div",Rt,[A[1]||(A[1]=l("h4",null,"风险缓解建议",-1)),l("div",It,[(r(!0),v(M,null,O(I.value,(a,N)=>(r(),v("div",{key:N,class:Y(["recommendation-item","priority-"+a.priority.toLowerCase()])},[l("div",Et,[l("div",Tt,o(a.priority),1),l("div",Lt,o(a.title),1)]),l("div",Bt,o(a.description),1)],2))),128))])])):S("",!0)]))}},Fe=se(Pt,[["__scopeId","data-v-eb007282"]]),qt={class:"lab-view"},Mt={key:0,class:"quality-alert"},Ot={class:"alert-content"},jt={class:"alert-message"},Ut={class:"alert-actions"},Yt={class:"stat-cards"},Gt={class:"card-icon"},Qt={class:"card-content"},Xt={class:"card-label"},Kt={class:"card-value"},Wt={class:"card-trend"},Ht={class:"filter-container"},Jt={key:1,class:"empty-chart"},Zt={key:1,class:"empty-chart"},ea={class:"table-container"},ta={class:"pagination-container"},aa={key:0,class:"test-details"},la={key:0,class:"related-records"},sa={key:1,class:"test-images"},na={class:"image-grid"},ra={key:0,class:"image-caption"},oa={key:2,class:"test-procedure"},ia={key:0,class:"image-preview"},ua={class:"image-carousel"},da={class:"carousel-image-container"},ca=["src"],ma={key:0,class:"carousel-caption"},va={class:"image-thumbnails"},pa=["onClick"],_a={class:"risk-analysis-container"},fa={class:"risk-actions"},ha={__name:"LabView",setup(z){const m=ut(),D=it(),k=p(()=>D.labTestData),C=p(()=>D.trendAnalysisData),I=p(()=>D.getStatCardsData("lab")),E=p(()=>D.batchComparisonData),L=p(()=>D.riskAnalysisData),y=Se({materialCode:"",materialName:"",testItem:"",result:"",dateRange:[]}),b=Se({currentPage:1,pageSize:10}),$=p(()=>{const c=new Set;return k.value.forEach(s=>{s.testItem&&c.add(s.testItem)}),Array.from(c).map(s=>({label:s,value:s}))}),A=V(!1),a=V(null),N=V(!1),G=V(0),f=V(!1),j=V("batchComparison"),J=V(!0),Z=V([]),ne=V("32.5"),re=V("增加抽检比例，对来料进行重点筛选"),R=V(null),d=V(null),u=p(()=>!d.value||!d.value.materialCode?{}:E.value[d.value.materialCode]||{}),h=p(()=>!u.value||!u.value.batches?["standard"]:["standard",...u.value.batches]),g=p(()=>!d.value||!d.value.materialCode?{}:L.value[d.value.materialCode]||{}),w=p(()=>!R.value||!R.value.materialCode?{}:E.value[R.value.materialCode]||{}),X=p(()=>!w.value||!w.value.batches?["standard"]:["standard",...w.value.batches]),oe=p(()=>{let c=D.filterLabTests(y);const s=(b.currentPage-1)*b.pageSize,P=s+b.pageSize;return c.slice(s,P)}),ee=p(()=>D.filterLabTests(y).length),q=({row:c})=>c.result==="NG"?"error-row":c.result==="有条件接收"?"warning-row":"",B=c=>c==="NG"?"danger":c==="有条件接收"?"warning":c==="OK"?"success":"info",ie=c=>c?c>=85?"high-risk":c>=70?"medium-risk":"low-risk":"",Ne=c=>{b.pageSize=c,b.currentPage=1},Re=c=>{b.currentPage=c},Ie=()=>{b.currentPage=1},Ee=()=>{Object.keys(y).forEach(c=>{y[c]=c==="dateRange"?[]:""}),b.currentPage=1},Te=c=>{a.value=c,A.value=!0},Le=c=>{a.value=c,G.value=0,N.value=!0},Be=c=>{W({type:"success",message:`已将【${c.materialName}】的检测数据发送至AI助手进行深度分析`}),m.push({path:"/ai-assistant",query:{materialCode:c.materialCode,testId:c.id,action:"analyze"}})},Pe=c=>{d.value={materialCode:c.materialCode,materialName:c.materialName}},qe=c=>{W({type:"success",message:`已${c==="excel"?"导出Excel文件":"生成PDF报告"}`})},Me=()=>{J.value=!1},Oe=()=>{R.value=L.value[38501375],f.value=!0},je=()=>{lt.confirm("系统将自动创建处理措施工单并通知相关责任人，是否继续？","风险处理确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{W({type:"success",message:"已创建处理工单并推送给相关责任人"}),f.value=!1}).catch(()=>{})},Ue=()=>{var c;W({type:"success",message:"已将风险分析数据发送至AI助手进行深度分析"}),m.push({path:"/ai-assistant",query:{materialCode:(c=R.value)==null?void 0:c.materialCode,action:"risk-analysis"}})},Ye=()=>{W({type:"success",message:"风险分析报告生成中，完成后将发送至您的邮箱"})};return le(async()=>{await D.refreshData(),Z.value=D.qualityPredictionData.filter(c=>c.predictedResult==="NG"),k.value.length>0&&(d.value={materialCode:k.value[0].materialCode,materialName:k.value[0].materialName})}),(c,s)=>{const P=_("el-button"),Ge=_("el-alert"),Qe=_("el-card"),ue=_("el-col"),Ce=_("el-row"),we=_("el-input"),K=_("el-form-item"),te=_("el-option"),xe=_("el-select"),Xe=_("el-date-picker"),$e=_("el-dropdown-item"),Ke=_("el-dropdown-menu"),We=_("el-dropdown"),He=_("el-form"),ae=_("el-tab-pane"),De=_("el-tabs"),U=_("el-table-column"),de=_("el-tag"),Je=_("el-table"),Ze=_("el-pagination"),x=_("el-descriptions-item"),ce=_("el-descriptions"),Ve=_("el-image"),me=_("el-dialog"),et=_("el-carousel-item"),tt=_("el-carousel");return r(),v("div",qt,[s[30]||(s[30]=l("h2",{class:"page-title"},"实验室检测分析",-1)),J.value?(r(),v("div",Mt,[e(Ge,{title:`质量预警: 检测到${Z.value.length}个潜在风险批次`,type:"warning",description:"系统已基于历史检测数据分析出潜在风险，请查看详情","show-icon":"",closable:!1},{default:t(()=>[l("div",Ot,[l("div",jt,[l("p",null,[s[9]||(s[9]=i("相似批次的历史不良率: ")),l("b",null,o(ne.value)+"%",1)]),l("p",null,[s[10]||(s[10]=i("建议: ")),l("b",null,o(re.value),1)])]),l("div",Ut,[e(P,{size:"small",type:"warning",onClick:Oe},{default:t(()=>s[11]||(s[11]=[i("查看分析")])),_:1,__:[11]}),e(P,{size:"small",onClick:Me},{default:t(()=>s[12]||(s[12]=[i("稍后提醒")])),_:1,__:[12]})])])]),_:1},8,["title"])])):S("",!0),l("div",Yt,[e(Ce,{gutter:20},{default:t(()=>[(r(!0),v(M,null,O(I.value,(n,F)=>(r(),T(ue,{xs:24,sm:12,md:6,key:F},{default:t(()=>[e(Qe,{shadow:"hover",class:Y(["stat-card",n.type])},{default:t(()=>[l("div",Gt,[l("i",{class:Y(`el-icon-${n.icon}`)},null,2)]),l("div",Qt,[l("div",Xt,o(n.label),1),l("div",Kt,o(n.value),1),l("div",Wt,[l("i",{class:Y(n.trend==="up"?"el-icon-top":"el-icon-bottom")},null,2),i(" "+o(n.change),1)])])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),l("div",Ht,[e(He,{inline:!0,model:y,class:"filter-form"},{default:t(()=>[e(K,{label:"物料代码"},{default:t(()=>[e(we,{modelValue:y.materialCode,"onUpdate:modelValue":s[0]||(s[0]=n=>y.materialCode=n),placeholder:"输入物料代码",clearable:""},null,8,["modelValue"])]),_:1}),e(K,{label:"物料名称"},{default:t(()=>[e(we,{modelValue:y.materialName,"onUpdate:modelValue":s[1]||(s[1]=n=>y.materialName=n),placeholder:"输入物料名称",clearable:""},null,8,["modelValue"])]),_:1}),e(K,{label:"测试项目"},{default:t(()=>[e(xe,{modelValue:y.testItem,"onUpdate:modelValue":s[2]||(s[2]=n=>y.testItem=n),placeholder:"选择测试项目",clearable:""},{default:t(()=>[(r(!0),v(M,null,O($.value,n=>(r(),T(te,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(K,{label:"检测结果"},{default:t(()=>[e(xe,{modelValue:y.result,"onUpdate:modelValue":s[3]||(s[3]=n=>y.result=n),placeholder:"选择结果",clearable:""},{default:t(()=>[e(te,{label:"合格",value:"OK"}),e(te,{label:"不合格",value:"NG"}),e(te,{label:"有条件接收",value:"有条件接收"})]),_:1},8,["modelValue"])]),_:1}),e(K,{label:"日期范围"},{default:t(()=>[e(Xe,{modelValue:y.dateRange,"onUpdate:modelValue":s[4]||(s[4]=n=>y.dateRange=n),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY/MM/DD","value-format":"YYYY/MM/DD"},null,8,["modelValue"])]),_:1}),e(K,null,{default:t(()=>[e(P,{type:"primary",onClick:Ie},{default:t(()=>s[13]||(s[13]=[i("筛选")])),_:1,__:[13]}),e(P,{onClick:Ee},{default:t(()=>s[14]||(s[14]=[i("重置")])),_:1,__:[14]}),e(We,{onCommand:qe},{dropdown:t(()=>[e(Ke,null,{default:t(()=>[e($e,{command:"excel"},{default:t(()=>s[16]||(s[16]=[i("导出Excel")])),_:1,__:[16]}),e($e,{command:"pdf"},{default:t(()=>s[17]||(s[17]=[i("导出PDF报告")])),_:1,__:[17]})]),_:1})]),default:t(()=>[e(P,{type:"success"},{default:t(()=>s[15]||(s[15]=[i(" 导出数据"),l("i",{class:"el-icon-arrow-down el-icon--right"},null,-1)])),_:1,__:[15]})]),_:1})]),_:1})]),_:1},8,["model"])]),e(Ce,{gutter:20,class:"charts-container"},{default:t(()=>[e(ue,{span:12},{default:t(()=>[e(kt,{"trend-data":C.value,title:"检测结果趋势分析",threshold:5},null,8,["trend-data"])]),_:1}),e(ue,{span:12},{default:t(()=>[e(De,{modelValue:j.value,"onUpdate:modelValue":s[5]||(s[5]=n=>j.value=n),class:"analysis-tabs"},{default:t(()=>[e(ae,{label:"批次质量对比",name:"batchComparison"},{default:t(()=>[d.value?(r(),T(Ae,{key:0,title:`${d.value.materialName}批次质量参数对比`,"batch-data":u.value,"available-batches":h.value,"analysis-text":u.value.analysisText,insights:u.value.insights},null,8,["title","batch-data","available-batches","analysis-text","insights"])):(r(),v("div",Jt,s[18]||(s[18]=[l("p",null,"请从下方表格选择一个物料以查看批次质量对比",-1)])))]),_:1}),e(ae,{label:"风险因子分析",name:"riskFactors"},{default:t(()=>[d.value?(r(),T(Fe,{key:0,title:`${d.value.materialName}风险因子分析`,"risk-data":g.value},null,8,["title","risk-data"])):(r(),v("div",Zt,s[19]||(s[19]=[l("p",null,"请从下方表格选择一个物料以查看风险因子分析",-1)])))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l("div",ea,[s[23]||(s[23]=l("h3",{class:"section-title"},"检测结果明细",-1)),e(Je,{data:oe.value,style:{width:"100%"},border:"",stripe:"","row-class-name":q,onRowClick:Pe},{default:t(()=>[e(U,{prop:"id",label:"检测编号",width:"150"}),e(U,{prop:"testDate",label:"检测日期",width:"120"}),e(U,{prop:"materialCode",label:"物料代码",width:"110"}),e(U,{prop:"materialName",label:"物料名称","min-width":"180"}),e(U,{prop:"testItem",label:"测试项目","min-width":"200"}),e(U,{prop:"result",label:"检测结果",width:"100"},{default:t(n=>[e(de,{type:B(n.row.result),size:"small"},{default:t(()=>[i(o(n.row.result),1)]),_:2},1032,["type"])]),_:1}),e(U,{prop:"defectRate",label:"不良比例",width:"120"}),e(U,{prop:"supplier",label:"供应商",width:"120"}),e(U,{label:"操作",width:"180"},{default:t(n=>[e(P,{type:"text",size:"small",onClick:pe(F=>Te(n.row),["stop"])},{default:t(()=>s[20]||(s[20]=[i("详情")])),_:2,__:[20]},1032,["onClick"]),e(P,{type:"text",size:"small",onClick:pe(F=>Le(n.row),["stop"]),disabled:!n.row.images||!n.row.images.length},{default:t(()=>s[21]||(s[21]=[i(" 查看图片 ")])),_:2,__:[21]},1032,["onClick","disabled"]),e(P,{type:"text",size:"small",onClick:pe(F=>Be(n.row),["stop"])},{default:t(()=>s[22]||(s[22]=[i("AI分析")])),_:2,__:[22]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l("div",ta,[e(Ze,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:ee.value,"page-size":b.pageSize,"page-sizes":[10,20,50,100],"current-page":b.currentPage,onSizeChange:Ne,onCurrentChange:Re},null,8,["total","page-size","current-page"])])]),e(me,{modelValue:A.value,"onUpdate:modelValue":s[6]||(s[6]=n=>A.value=n),title:a.value?`检测详情: ${a.value.id}`:"检测详情",width:"70%","destroy-on-close":""},{default:t(()=>[a.value?(r(),v("div",aa,[e(ce,{column:2,border:"",size:"medium"},{default:t(()=>[e(x,{label:"检测编号"},{default:t(()=>[i(o(a.value.id),1)]),_:1}),e(x,{label:"检测日期"},{default:t(()=>[i(o(a.value.testDate),1)]),_:1}),e(x,{label:"物料代码"},{default:t(()=>[i(o(a.value.materialCode),1)]),_:1}),e(x,{label:"物料名称"},{default:t(()=>[i(o(a.value.materialName),1)]),_:1}),e(x,{label:"检测来源"},{default:t(()=>[i(o(a.value.testSource),1)]),_:1}),e(x,{label:"项目"},{default:t(()=>[i(o(a.value.project),1)]),_:1}),e(x,{label:"测试项目"},{default:t(()=>[i(o(a.value.testItem),1)]),_:1}),e(x,{label:"检测结果"},{default:t(()=>[e(de,{type:B(a.value.result)},{default:t(()=>[i(o(a.value.result),1)]),_:1},8,["type"])]),_:1}),e(x,{label:"不良批次"},{default:t(()=>[i(o(a.value.badBatch||"N/A"),1)]),_:1}),e(x,{label:"不良比例"},{default:t(()=>[i(o(a.value.defectRate),1)]),_:1}),e(x,{label:"供应商"},{default:t(()=>[i(o(a.value.supplier),1)]),_:1}),e(x,{label:"责任归类"},{default:t(()=>[i(o(a.value.responsibility),1)]),_:1}),e(x,{label:"建议处理",span:2},{default:t(()=>[i(o(a.value.recommendation),1)]),_:1}),e(x,{label:"备注",span:2},{default:t(()=>[i(o(a.value.remarks),1)]),_:1})]),_:1}),a.value.relatedRecords&&a.value.relatedRecords.length?(r(),v("div",la,[s[24]||(s[24]=l("h4",null,"相关记录",-1)),(r(!0),v(M,null,O(a.value.relatedRecords,n=>(r(),T(de,{key:n,size:"small"},{default:t(()=>[i(o(n),1)]),_:2},1024))),128))])):S("",!0),a.value.images&&a.value.images.length?(r(),v("div",sa,[s[25]||(s[25]=l("h4",null,"检测图片",-1)),l("div",na,[(r(!0),v(M,null,O(a.value.images,(n,F)=>(r(),v("div",{key:F,class:"image-item"},[e(Ve,{src:n.url||n,"preview-src-list":a.value.images.map(ve=>ve.url||ve),fit:"cover"},null,8,["src","preview-src-list"]),n.caption?(r(),v("div",ra,o(n.caption),1)):S("",!0)]))),128))])])):S("",!0),a.value.testProcedure||a.value.testEquipment||a.value.testParameters?(r(),v("div",oa,[s[26]||(s[26]=l("h4",null,"测试过程",-1)),e(ce,{column:1,border:"",size:"small"},{default:t(()=>[a.value.testProcedure?(r(),T(x,{key:0,label:"测试规范"},{default:t(()=>[i(o(a.value.testProcedure),1)]),_:1})):S("",!0),a.value.testEquipment?(r(),T(x,{key:1,label:"测试设备"},{default:t(()=>[i(o(Array.isArray(a.value.testEquipment)?a.value.testEquipment.join(", "):a.value.testEquipment),1)]),_:1})):S("",!0),a.value.testParameters?(r(),T(x,{key:2,label:"测试参数"},{default:t(()=>[(r(!0),v(M,null,O(a.value.testParameters,(n,F)=>(r(),v("div",{key:F,class:"param-item"},o(F)+": "+o(n),1))),128))]),_:1})):S("",!0),a.value.tester?(r(),T(x,{key:3,label:"测试人员"},{default:t(()=>[i(o(a.value.tester),1)]),_:1})):S("",!0),a.value.reviewer?(r(),T(x,{key:4,label:"复核人员"},{default:t(()=>[i(o(a.value.reviewer),1)]),_:1})):S("",!0)]),_:1})])):S("",!0)])):S("",!0)]),_:1},8,["modelValue","title"]),e(me,{modelValue:N.value,"onUpdate:modelValue":s[7]||(s[7]=n=>N.value=n),title:a.value?`${a.value.materialName} 检测图片`:"检测图片",width:"80%"},{default:t(()=>[a.value&&a.value.images&&a.value.images.length?(r(),v("div",ia,[l("div",ua,[e(tt,{height:"400px",arrow:"always","indicator-position":"outside"},{default:t(()=>[(r(!0),v(M,null,O(a.value.images,(n,F)=>(r(),T(et,{key:F},{default:t(()=>[l("div",da,[l("img",{src:n.url||n,alt:"检测图片",class:"carousel-image"},null,8,ca),n.caption?(r(),v("div",ma,o(n.caption),1)):S("",!0)])]),_:2},1024))),128))]),_:1})]),l("div",va,[(r(!0),v(M,null,O(a.value.images,(n,F)=>(r(),v("div",{key:F,class:"thumbnail-item",onClick:ve=>G.value=F},[e(Ve,{src:n.url||n,fit:"cover",class:"thumbnail"},null,8,["src"])],8,pa))),128))])])):S("",!0)]),_:1},8,["modelValue","title"]),e(me,{modelValue:f.value,"onUpdate:modelValue":s[8]||(s[8]=n=>f.value=n),title:"风险批次分析",width:"80%"},{default:t(()=>[l("div",_a,[e(ce,{column:2,border:""},{default:t(()=>[e(x,{label:"物料名称"},{default:t(()=>{var n;return[i(o((n=R.value)==null?void 0:n.materialName),1)]}),_:1}),e(x,{label:"物料代码"},{default:t(()=>{var n;return[i(o((n=R.value)==null?void 0:n.materialCode),1)]}),_:1}),e(x,{label:"风险评分"},{default:t(()=>{var n,F;return[l("span",{class:Y(["risk-score",ie((n=R.value)==null?void 0:n.riskScore)])},o((F=R.value)==null?void 0:F.riskScore),3)]}),_:1}),e(x,{label:"影响范围"},{default:t(()=>{var n;return[i(o((n=R.value)==null?void 0:n.riskImpactScope),1)]}),_:1})]),_:1}),e(De,{type:"border-card",class:"risk-tabs"},{default:t(()=>[e(ae,{label:"风险因子"},{default:t(()=>[e(Fe,{"risk-data":R.value,height:"400px"},null,8,["risk-data"])]),_:1}),e(ae,{label:"批次对比"},{default:t(()=>[R.value?(r(),T(Ae,{key:0,"batch-data":w.value,"available-batches":X.value,"analysis-text":w.value.analysisText,insights:w.value.insights,height:"400px"},null,8,["batch-data","available-batches","analysis-text","insights"])):S("",!0)]),_:1})]),_:1}),l("div",fa,[e(P,{type:"primary",onClick:je},{default:t(()=>s[27]||(s[27]=[i("采取措施")])),_:1,__:[27]}),e(P,{type:"warning",onClick:Ue},{default:t(()=>s[28]||(s[28]=[i("AI深度分析")])),_:1,__:[28]}),e(P,{onClick:Ye},{default:t(()=>s[29]||(s[29]=[i("生成完整报告")])),_:1,__:[29]})])])]),_:1},8,["modelValue"])])}}},Ca=se(ha,[["__scopeId","data-v-f9616467"]]);export{Ca as default};
