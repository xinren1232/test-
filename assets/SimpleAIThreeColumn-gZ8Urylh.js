import{S as x,T as de,Q as he,c as n,o as a,a as e,b as k,O as z,P as H,a0 as ee,E as Oe,M as V,n as T,az as j,F as q,r as D,t as i,e as L,d as te,W as ge,V as oe,U as Be,aE as ce,X as Ne,a7 as Ve,aU as Ue,aV as He,aW as je,aX as Fe,aY as Ge,L as We,aZ as Je,K as Xe,$ as Ke,a_ as Ze,Z as Ye,_ as et,R as tt,ai as fe}from"./element-plus-DR-erZ3X.js";/* empty css                                                                             */import{aM as K,a as ae}from"./index-Bo1zM2q5.js";import{i as _e,L as se}from"./echarts-Dfqt_Pbx.js";import{a as ie,v as Y}from"./VoiceServiceManager-2sv0FYbn.js";class st{constructor(){this.baseURL="http://localhost:3001/api"}async getInventoryDistribution(){try{const l=await K.post(`${this.baseURL}/assistant/query`,{query:"查询当前库存总体情况"}),c=this.parseInventoryData(l.data.reply);return this.formatPieChartData(c)}catch(l){return console.error("获取库存分布数据失败:",l),this.getMockInventoryDistribution()}}async getQualityTrend(){try{const l=await K.post(`${this.baseURL}/assistant/query`,{query:"分析质量指标趋势"}),c=this.parseQualityTrendData(l.data.reply);return this.formatLineChartData(c)}catch(l){return console.error("获取质量趋势数据失败:",l),this.getMockQualityTrend()}}async getDefectDistribution(){try{const l=await K.post(`${this.baseURL}/assistant/query`,{query:"分析主要不良类型分布"}),c=this.parseDefectData(l.data.reply);return this.formatBarChartData(c)}catch(l){return console.error("获取不良分布数据失败:",l),this.getMockDefectDistribution()}}async getSupplierEvaluation(){try{const l=await K.post(`${this.baseURL}/assistant/query`,{query:"分析各供应商的风险等级和质量表现"}),c=this.parseSupplierData(l.data.reply);return this.formatRadarChartData(c)}catch(l){return console.error("获取供应商评价数据失败:",l),this.getMockSupplierEvaluation()}}async getRiskDistribution(){try{const l=await K.post(`${this.baseURL}/assistant/query`,{query:"查询高风险等级的物料"}),c=this.parseRiskData(l.data.reply);return this.formatPieChartData(c)}catch(l){return console.error("获取风险分布数据失败:",l),this.getMockRiskDistribution()}}async getPassRateStats(){try{const l=await K.post(`${this.baseURL}/assistant/query`,{query:"计算本月的合格率"}),c=this.parsePassRateData(l.data.reply);return this.formatBarChartData(c)}catch(l){return console.error("获取合格率数据失败:",l),this.getMockPassRateStats()}}parseInventoryData(l){const c=l.split(`
`),r=[];return c.forEach(y=>{const _=y.match(/(电子元件|结构件|光学|电源|连接器).*?(\d+)/);_&&r.push({name:_[1],value:parseInt(_[2])})}),r.length>0?r:this.getMockInventoryDistribution()}parseQualityTrendData(l){const c=[];return["2024-01","2024-02","2024-03","2024-04","2024-05","2024-06"].forEach((y,_)=>{const p=l.match(/(\d+\.?\d*)%/),A=p?parseFloat(p[1]):95;c.push({date:y,value:A+(Math.random()-.5)*4})}),c}parseDefectData(l){const c=["外观不良","尺寸超差","功能异常","包装问题","其他"],r=[];return c.forEach(y=>{const _=new RegExp(`${y}.*?(\\d+)`,"i"),p=l.match(_),A=p?parseInt(p[1]):Math.floor(Math.random()*50)+10;r.push({type:y,count:A})}),r}parseSupplierData(l){const c=["美光科技","富士康","比亚迪","欧菲光","立讯精密"],r=["质量","交期","成本","服务","创新"];return c.slice(0,3).map(y=>({name:y,value:r.map(()=>Math.floor(Math.random()*40)+60)}))}parseRiskData(l){const c=["低风险","中风险","高风险","极高风险"],r=[];return c.forEach(y=>{const _=new RegExp(`${y}.*?(\\d+)`,"i"),p=l.match(_),A=p?parseInt(p[1]):Math.floor(Math.random()*100)+20;r.push({name:y,value:A})}),r}parsePassRateData(l){const c=["电子元件","结构件","光学器件","电源模块","连接器"],r=[];return c.forEach(y=>{const _=new RegExp(`${y}.*?(\\d+\\.?\\d*)%`,"i"),p=l.match(_),A=p?parseFloat(p[1]):90+Math.random()*10;r.push({name:y,value:A})}),r}formatPieChartData(l){return l.map(c=>({name:c.name,value:c.value||c.count}))}formatLineChartData(l){return{xAxis:l.map(c=>c.date||c.name),series:l.map(c=>c.value)}}formatBarChartData(l){return{xAxis:l.map(c=>c.type||c.name),series:l.map(c=>c.count||c.value)}}formatRadarChartData(l){return{indicator:["质量","交期","成本","服务","创新"].map(r=>({name:r,max:100})),series:l.map(r=>({name:r.name,value:r.value}))}}getMockInventoryDistribution(){return[{name:"电子元件",value:1200},{name:"结构件",value:800},{name:"光学器件",value:600},{name:"电源模块",value:400},{name:"连接器",value:300}]}getMockQualityTrend(){return{xAxis:["2024-01","2024-02","2024-03","2024-04","2024-05","2024-06"],series:[95.2,96.1,94.8,97.3,96.7,98.1]}}getMockDefectDistribution(){return[{type:"外观不良",count:45},{type:"尺寸超差",count:32},{type:"功能异常",count:28},{type:"包装问题",count:15},{type:"其他",count:8}]}getMockSupplierEvaluation(){return{indicator:[{name:"质量",max:100},{name:"交期",max:100},{name:"成本",max:100},{name:"服务",max:100},{name:"创新",max:100}],series:[{name:"美光科技",value:[95,88,92,90,85]},{name:"富士康",value:[92,95,88,93,87]},{name:"比亚迪",value:[88,90,95,85,92]}]}}getMockRiskDistribution(){return[{name:"低风险",value:65},{name:"中风险",value:25},{name:"高风险",value:8},{name:"极高风险",value:2}]}getMockPassRateStats(){return{xAxis:["电子元件","结构件","光学器件","电源模块","连接器"],series:[98.5,96.2,97.8,95.1,99.2]}}}const N=new st,at={class:"chart-tool-panel"},nt={class:"panel-header"},ot={class:"panel-actions"},it={class:"chart-categories"},lt={class:"chart-category"},rt={class:"category-content"},ct={class:"chart-grid"},dt=["onClick","title"],ut={class:"chart-icon"},vt={class:"chart-name"},pt={class:"chart-category"},mt={class:"category-content"},yt={class:"chart-grid"},ht=["onClick","title"],ft={class:"chart-icon"},gt={class:"chart-name"},_t={class:"chart-category"},bt={class:"category-content"},kt={class:"chart-grid"},$t=["onClick","title"],Ct={class:"chart-icon"},xt={class:"chart-name"},wt={key:0,class:"chart-preview"},St={class:"preview-header"},qt={class:"preview-actions"},Dt={class:"preview-content"},At={__name:"ChartToolPanel",setup(v){const l=x({visualization:!0,quality:!1,supplier:!1}),c=x(null),r=x(null),y=x(null),_=x(300),p=x([{id:"inventory-distribution",name:"库存分布",icon:"🥧",type:"pie",description:"显示各类物料的库存分布情况",dataSource:"inventory"},{id:"trend-analysis",name:"趋势分析",icon:"📈",type:"line",description:"显示质量指标的时间趋势",dataSource:"quality_trend"},{id:"risk-heatmap",name:"风险热力图",icon:"🔥",type:"heatmap",description:"显示各区域的风险分布热力图",dataSource:"risk_data"},{id:"defect-pareto",name:"不良帕累托",icon:"📊",type:"bar",description:"不良类型的帕累托分析图",dataSource:"defect_data"}]),A=x([{id:"quality-control",name:"质量控制图",icon:"📉",type:"line",description:"质量控制过程图表",dataSource:"quality_control"},{id:"pass-rate",name:"合格率统计",icon:"✅",type:"bar",description:"各产品线合格率统计",dataSource:"pass_rate"},{id:"defect-distribution",name:"不良分布",icon:"❌",type:"pie",description:"不良类型分布饼图",dataSource:"defect_distribution"}]),g=x([{id:"supplier-radar",name:"供应商雷达",icon:"🎯",type:"radar",description:"供应商综合评价雷达图",dataSource:"supplier_evaluation"},{id:"supplier-ranking",name:"供应商排名",icon:"🏆",type:"bar",description:"供应商质量排名柱状图",dataSource:"supplier_ranking"}]),$=M=>{l.value[M]=!l.value[M]},m=async M=>{try{if(c.value=M,await ge(),r.value){y.value&&y.value.dispose(),y.value=_e(r.value);const d=await u(M.dataSource),R=h(M,d);y.value.setOption(R),window.addEventListener("resize",()=>{y.value&&y.value.resize()}),oe.success(`${M.name} 生成成功`)}}catch(d){console.error("生成图表失败:",d),oe.error("生成图表失败")}},u=async M=>{try{switch(M){case"inventory":return await N.getInventoryDistribution();case"quality_trend":return await N.getQualityTrend();case"defect_data":return await N.getDefectDistribution();case"risk_data":return await N.getRiskDistribution();case"quality_control":return await N.getQualityTrend();case"pass_rate":return await N.getPassRateStats();case"defect_distribution":return await N.getDefectDistribution();case"supplier_evaluation":return await N.getSupplierEvaluation();case"supplier_ranking":const d=await N.getSupplierEvaluation();return{xAxis:d.series.map(R=>R.name),series:d.series.map(R=>R.value.reduce((O,w)=>O+w,0)/R.value.length)};default:return[]}}catch(d){return console.error("获取图表数据失败:",d),[]}},h=(M,d)=>{const R={title:{text:M.name,left:"center",textStyle:{fontSize:14,fontWeight:"bold"}},tooltip:{trigger:"item",backgroundColor:"rgba(0, 0, 0, 0.8)",textStyle:{color:"#fff"}},legend:{bottom:10,textStyle:{fontSize:12}}};switch(M.type){case"pie":return{...R,series:[{type:"pie",radius:["40%","70%"],data:Array.isArray(d)?d:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{formatter:"{b}: {c} ({d}%)"}}]};case"line":const O=d.xAxis?d:{xAxis:d.map(E=>E.date||E.name),series:d.map(E=>E.value)};return{...R,tooltip:{trigger:"axis"},xAxis:{type:"category",data:O.xAxis,axisLabel:{rotate:45}},yAxis:{type:"value",axisLabel:{formatter:"{value}%"}},series:[{type:"line",data:O.series,smooth:!0,areaStyle:{color:new se(0,0,0,1,[{offset:0,color:"rgba(24, 144, 255, 0.6)"},{offset:1,color:"rgba(24, 144, 255, 0.1)"}])},lineStyle:{width:3},symbol:"circle",symbolSize:6}]};case"bar":const w=d.xAxis?d:{xAxis:d.map(E=>E.type||E.name),series:d.map(E=>E.count||E.value)};return{...R,tooltip:{trigger:"axis"},xAxis:{type:"category",data:w.xAxis,axisLabel:{rotate:45}},yAxis:{type:"value"},series:[{type:"bar",data:w.series,itemStyle:{color:new se(0,0,0,1,[{offset:0,color:"#83bff6"},{offset:.5,color:"#188df0"},{offset:1,color:"#188df0"}])},emphasis:{itemStyle:{color:new se(0,0,0,1,[{offset:0,color:"#409EFF"},{offset:1,color:"#1890ff"}])}}}]};case"radar":return{...R,radar:{indicator:d.indicator||[],radius:"70%"},series:[{type:"radar",data:d.series||[],areaStyle:{opacity:.3}}]};case"heatmap":return{...R,tooltip:{position:"top"},grid:{height:"50%",top:"10%"},xAxis:{type:"category",data:d.xAxis||[],splitArea:{show:!0}},yAxis:{type:"category",data:d.yAxis||[],splitArea:{show:!0}},visualMap:{min:0,max:100,calculable:!0,orient:"horizontal",left:"center",bottom:"15%"},series:[{type:"heatmap",data:d.series||[],label:{show:!0},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};default:return R}},b=()=>{c.value&&m(c.value)},I=()=>{if(y.value){const M=y.value.getDataURL({type:"png",pixelRatio:2,backgroundColor:"#fff"}),d=document.createElement("a");d.download=`${c.value.name}.png`,d.href=M,d.click(),oe.success("图表导出成功")}},U=()=>{oe.info("全屏功能开发中...")},C=()=>{y.value&&(y.value.dispose(),y.value=null),c.value=null};return de(()=>{console.log("图表工具面板初始化完成")}),(M,d)=>{const R=he("el-icon"),O=he("el-button");return a(),n("div",at,[e("div",nt,[d[3]||(d[3]=e("span",{class:"panel-icon"},"📊",-1)),d[4]||(d[4]=e("h3",{class:"panel-title"},"图表工具",-1)),e("div",ot,[z(O,{size:"small",onClick:b},{default:H(()=>[z(R,null,{default:H(()=>[z(ee(Oe))]),_:1})]),_:1})])]),e("div",it,[e("div",lt,[e("div",{class:"category-header",onClick:d[0]||(d[0]=w=>$("visualization"))},[d[5]||(d[5]=e("span",{class:"category-icon"},"📈",-1)),d[6]||(d[6]=e("span",{class:"category-title"},"数据可视化",-1)),e("span",{class:T(["expand-icon",{expanded:l.value.visualization}])},"▼",2)]),V(e("div",rt,[e("div",ct,[(a(!0),n(q,null,D(p.value,w=>(a(),n("div",{key:w.id,class:"chart-item",onClick:E=>m(w),title:w.description},[e("div",ut,i(w.icon),1),e("div",vt,i(w.name),1)],8,dt))),128))])],512),[[j,l.value.visualization]])]),e("div",pt,[e("div",{class:"category-header",onClick:d[1]||(d[1]=w=>$("quality"))},[d[7]||(d[7]=e("span",{class:"category-icon"},"🧪",-1)),d[8]||(d[8]=e("span",{class:"category-title"},"质量分析",-1)),e("span",{class:T(["expand-icon",{expanded:l.value.quality}])},"▼",2)]),V(e("div",mt,[e("div",yt,[(a(!0),n(q,null,D(A.value,w=>(a(),n("div",{key:w.id,class:"chart-item",onClick:E=>m(w),title:w.description},[e("div",ft,i(w.icon),1),e("div",gt,i(w.name),1)],8,ht))),128))])],512),[[j,l.value.quality]])]),e("div",_t,[e("div",{class:"category-header",onClick:d[2]||(d[2]=w=>$("supplier"))},[d[9]||(d[9]=e("span",{class:"category-icon"},"🏭",-1)),d[10]||(d[10]=e("span",{class:"category-title"},"供应商分析",-1)),e("span",{class:T(["expand-icon",{expanded:l.value.supplier}])},"▼",2)]),V(e("div",bt,[e("div",kt,[(a(!0),n(q,null,D(g.value,w=>(a(),n("div",{key:w.id,class:"chart-item",onClick:E=>m(w),title:w.description},[e("div",Ct,i(w.icon),1),e("div",xt,i(w.name),1)],8,$t))),128))])],512),[[j,l.value.supplier]])])]),c.value?(a(),n("div",wt,[e("div",St,[e("h4",null,i(c.value.name),1),e("div",qt,[z(O,{size:"small",onClick:I},{default:H(()=>d[11]||(d[11]=[L("导出")])),_:1,__:[11]}),z(O,{size:"small",onClick:U},{default:H(()=>d[12]||(d[12]=[L("全屏")])),_:1,__:[12]}),z(O,{size:"small",onClick:C},{default:H(()=>d[13]||(d[13]=[L("关闭")])),_:1,__:[13]})])]),e("div",Dt,[e("div",{ref_key:"chartContainer",ref:r,class:"chart-container",style:te({height:_.value+"px"})},null,4)])])):k("",!0)])}}},Mt=ae(At,[["__scopeId","data-v-18aa7632"]]),Rt={class:"enhanced-chart-renderer"},Lt={key:0,class:"chart-container"},Tt={class:"chart-header"},It={class:"chart-title"},Et={class:"chart-controls"},Qt={key:0,class:"chart-description"},zt={key:1,class:"empty-state"},Pt={__name:"EnhancedChartRenderer",props:{chartData:{type:Array,default:()=>[]},title:{type:String,default:"数据图表"},description:{type:String,default:""},defaultChartType:{type:String,default:"bar"},chartHeight:{type:Number,default:400},theme:{type:String,default:"light"}},emits:["chart-ready","chart-click"],setup(v,{emit:l}){const c=v,r=l,y=x(null),_=x(null),p=x(c.defaultChartType),A=x([{value:"bar",label:"柱状图",icon:Fe},{value:"pie",label:"饼图",icon:Ge},{value:"line",label:"折线图",icon:We},{value:"gauge",label:"仪表盘",icon:Je},{value:"scatter",label:"散点图",icon:Xe}]),g=(h,b)=>{const I={backgroundColor:c.theme==="dark"?"#1a1a1a":"#ffffff",textStyle:{color:c.theme==="dark"?"#ffffff":"#333333"},tooltip:{trigger:"item",backgroundColor:c.theme==="dark"?"#333":"#fff",borderColor:c.theme==="dark"?"#555":"#ddd",textStyle:{color:c.theme==="dark"?"#fff":"#333"}},legend:{top:"5%",textStyle:{color:c.theme==="dark"?"#ffffff":"#333333"}}};switch(h){case"bar":return{...I,xAxis:{type:"category",data:b.map(C=>C.name||C.label),axisLabel:{color:c.theme==="dark"?"#ffffff":"#333333"}},yAxis:{type:"value",axisLabel:{color:c.theme==="dark"?"#ffffff":"#333333"}},series:[{data:b.map(C=>C.value||C.count),type:"bar",itemStyle:{color:new se(0,0,0,1,[{offset:0,color:"#83bff6"},{offset:.5,color:"#188df0"},{offset:1,color:"#188df0"}])}}]};case"pie":return{...I,series:[{name:c.title,type:"pie",radius:"50%",data:b.map(C=>({value:C.value||C.count,name:C.name||C.label})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};case"line":return{...I,xAxis:{type:"category",data:b.map(C=>C.name||C.label),axisLabel:{color:c.theme==="dark"?"#ffffff":"#333333"}},yAxis:{type:"value",axisLabel:{color:c.theme==="dark"?"#ffffff":"#333333"}},series:[{data:b.map(C=>C.value||C.count),type:"line",smooth:!0,itemStyle:{color:"#5470c6"},areaStyle:{color:new se(0,0,0,1,[{offset:0,color:"rgba(84, 112, 198, 0.3)"},{offset:1,color:"rgba(84, 112, 198, 0.1)"}])}}]};case"gauge":b.reduce((C,M)=>C+(M.value||M.count),0);const U=Math.max(...b.map(C=>C.value||C.count));return{...I,series:[{name:c.title,type:"gauge",progress:{show:!0},detail:{valueAnimation:!0,formatter:"{value}"},data:[{value:U,name:"最大值"}]}]};case"scatter":return{...I,xAxis:{type:"value",axisLabel:{color:c.theme==="dark"?"#ffffff":"#333333"}},yAxis:{type:"value",axisLabel:{color:c.theme==="dark"?"#ffffff":"#333333"}},series:[{symbolSize:20,data:b.map((C,M)=>[M,C.value||C.count]),type:"scatter"}]};default:return I}},$=async()=>{if(!y.value||!c.chartData.length)return;await ge(),_.value&&_.value.dispose(),_.value=_e(y.value,c.theme);const h=g(p.value,c.chartData);_.value.setOption(h),_.value.on("click",b=>{r("chart-click",b)}),r("chart-ready",_.value)},m=h=>{p.value=h,$()},u=()=>{_.value&&_.value.resize()};return de(()=>{$(),window.addEventListener("resize",u)}),Be(()=>{_.value&&_.value.dispose(),window.removeEventListener("resize",u)}),ce(()=>c.chartData,()=>{$()},{deep:!0}),ce(()=>c.theme,()=>{$()}),(h,b)=>(a(),n("div",Rt,[v.chartData&&v.chartData.length>0?(a(),n("div",Lt,[e("div",Tt,[e("h3",It,i(v.title),1),e("div",Et,[z(ee(Ue),{size:"small"},{default:H(()=>[(a(!0),n(q,null,D(A.value,I=>(a(),Ne(ee(Ve),{key:I.value,type:p.value===I.value?"primary":"default",onClick:U=>m(I.value),icon:I.icon},{default:H(()=>[L(i(I.label),1)]),_:2},1032,["type","onClick","icon"]))),128))]),_:1})])]),e("div",{ref_key:"chartContainer",ref:y,class:"chart-canvas",style:te({height:v.chartHeight+"px"})},null,4),v.description?(a(),n("div",Qt,[z(ee(He),{type:"info",size:"small"},{default:H(()=>[L(i(v.description),1)]),_:1})])):k("",!0)])):(a(),n("div",zt,[z(ee(je),{description:"暂无图表数据"})]))]))}},Ot=ae(Pt,[["__scopeId","data-v-4eab013f"]]),Bt={class:"enhanced-response-renderer"},Nt={key:0,class:"empty-result"},Vt={class:"empty-message"},Ut={key:0,class:"suggestions"},Ht={key:1,class:"inventory-response"},jt={class:"response-header"},Ft={class:"timestamp"},Gt={class:"summary-cards"},Wt={class:"summary-card"},Jt={class:"card-content"},Xt={class:"card-value"},Kt={class:"summary-card"},Zt={class:"card-content"},Yt={class:"card-value"},es={class:"summary-card"},ts={class:"card-content"},ss={class:"card-value"},as={class:"card-content"},ns={class:"card-value"},os={key:0,class:"charts-section"},is={key:1,class:"table-section"},ls={class:"table-container"},rs={class:"data-table"},cs={key:1},ds={key:0,class:"pagination-info"},us={key:2,class:"quality-response"},vs={class:"response-header"},ps={class:"timestamp"},ms={class:"quality-summary"},ys={class:"grade-letter"},hs={class:"grade-label"},fs={class:"quality-metrics"},gs={class:"metric"},_s={class:"metric-value"},bs={class:"metric"},ks={class:"metric-value"},$s={class:"metric"},Cs={class:"metric-value"},xs={key:0,class:"insights-section"},ws={class:"insight-cards"},Ss={class:"insight-icon"},qs={class:"insight-content"},Ds={class:"insight-title"},As={class:"insight-text"},Ms={key:1,class:"recommendations-section"},Rs={class:"recommendations-list"},Ls={key:3,class:"action-buttons"},Ts=["onClick"],Is={__name:"EnhancedResponseRenderer",props:{data:{type:Object,required:!0}},emits:["action","chart-ready","chart-click"],setup(v,{emit:l}){const c=v,r=l,y=m=>m?new Date(m).toLocaleString("zh-CN"):"",_=m=>{r("action",{action:m,data:c.data})},p=()=>{_("export")},A=()=>{_("load_more")},g=m=>{console.log("📊 图表已准备就绪:",m),r("chart-ready",m)},$=m=>{console.log("📊 图表点击事件:",m),r("chart-click",m),m.data&&_("chart_drill_down",{chartData:m.data,seriesName:m.seriesName})};return(m,u)=>(a(),n("div",Bt,[v.data.type==="empty_result"?(a(),n("div",Nt,[u[1]||(u[1]=e("div",{class:"empty-icon"},"📭",-1)),e("div",Vt,i(v.data.message),1),v.data.suggestions?(a(),n("div",Ut,[u[0]||(u[0]=e("div",{class:"suggestion-title"},"建议：",-1)),e("ul",null,[(a(!0),n(q,null,D(v.data.suggestions,h=>(a(),n("li",{key:h},i(h),1))),128))])])):k("",!0)])):v.data.type==="inventory_query"?(a(),n("div",Ht,[e("div",jt,[e("h3",null,i(v.data.title),1),e("div",Ft,i(y(v.data.timestamp)),1)]),e("div",Gt,[e("div",Wt,[u[3]||(u[3]=e("div",{class:"card-icon"},"📦",-1)),e("div",Jt,[e("div",Xt,i(v.data.summary.totalBatches),1),u[2]||(u[2]=e("div",{class:"card-label"},"批次总数",-1))])]),e("div",Kt,[u[5]||(u[5]=e("div",{class:"card-icon"},"📊",-1)),e("div",Zt,[e("div",Yt,i(v.data.summary.totalQuantity),1),u[4]||(u[4]=e("div",{class:"card-label"},"总数量",-1))])]),e("div",es,[u[7]||(u[7]=e("div",{class:"card-icon"},"🏭",-1)),e("div",ts,[e("div",ss,i(v.data.summary.materialTypes),1),u[6]||(u[6]=e("div",{class:"card-label"},"物料种类",-1))])]),e("div",{class:T(["summary-card",{risk:v.data.summary.riskItems>0}])},[u[9]||(u[9]=e("div",{class:"card-icon"},"⚠️",-1)),e("div",as,[e("div",ns,i(v.data.summary.riskItems),1),u[8]||(u[8]=e("div",{class:"card-label"},"风险项目",-1))])],2)]),v.data.charts?(a(),n("div",os,[(a(!0),n(q,null,D(v.data.charts,(h,b)=>(a(),n("div",{class:"chart-container",key:b},[z(Ot,{"chart-data":h.data,title:h.title,description:h.description,"default-chart-type":h.type,"chart-height":350,onChartReady:g,onChartClick:$},null,8,["chart-data","title","description","default-chart-type"])]))),128))])):k("",!0),v.data.table?(a(),n("div",is,[e("div",{class:"table-header"},[u[11]||(u[11]=e("h4",null,"详细数据",-1)),e("div",{class:"table-actions"},[e("button",{class:"action-btn",onClick:p},u[10]||(u[10]=[e("span",null,"📊",-1),L(" 导出 ")]))])]),e("div",ls,[e("table",rs,[e("thead",null,[e("tr",null,[(a(!0),n(q,null,D(v.data.table.columns,h=>(a(),n("th",{key:h.key,style:te({width:h.width})},i(h.title),5))),128))])]),e("tbody",null,[(a(!0),n(q,null,D(v.data.table.rows,h=>(a(),n("tr",{key:h.id},[(a(!0),n(q,null,D(v.data.table.columns,b=>(a(),n("td",{key:b.key,class:T(b.align)},[b.type==="status"?(a(),n("span",{key:0,class:"status-badge",style:te({backgroundColor:h[b.key].color})},i(h[b.key].icon)+" "+i(h[b.key].value),5)):(a(),n("span",cs,i(h[b.key]),1))],2))),128))]))),128))])])]),v.data.table.pagination.hasMore?(a(),n("div",ds,[L(" 显示 "+i(v.data.table.pagination.pageSize)+" / "+i(v.data.table.pagination.total)+" 条记录 ",1),e("button",{class:"load-more-btn",onClick:A},"加载更多")])):k("",!0)])):k("",!0)])):v.data.type==="quality_analysis"?(a(),n("div",us,[e("div",vs,[e("h3",null,i(v.data.title),1),e("div",ps,i(y(v.data.timestamp)),1)]),e("div",ms,[e("div",{class:"quality-grade",style:te({backgroundColor:v.data.summary.qualityGrade.color})},[e("div",ys,i(v.data.summary.qualityGrade.grade),1),e("div",hs,i(v.data.summary.qualityGrade.label),1)],4),e("div",fs,[e("div",gs,[e("div",_s,i(v.data.summary.passRate)+"%",1),u[12]||(u[12]=e("div",{class:"metric-label"},"合格率",-1))]),e("div",bs,[e("div",ks,i(v.data.summary.totalTests),1),u[13]||(u[13]=e("div",{class:"metric-label"},"总测试数",-1))]),e("div",$s,[e("div",Cs,i(v.data.summary.failedTests),1),u[14]||(u[14]=e("div",{class:"metric-label"},"不合格数",-1))])])]),v.data.insights?(a(),n("div",xs,[u[15]||(u[15]=e("h4",null,"关键洞察",-1)),e("div",ws,[(a(!0),n(q,null,D(v.data.insights,h=>(a(),n("div",{key:h.title,class:T(["insight-card",h.type])},[e("div",Ss,i(h.icon),1),e("div",qs,[e("div",Ds,i(h.title),1),e("div",As,i(h.content),1)])],2))),128))])])):k("",!0),v.data.recommendations?(a(),n("div",Ms,[u[16]||(u[16]=e("h4",null,"改进建议",-1)),e("ul",Rs,[(a(!0),n(q,null,D(v.data.recommendations,h=>(a(),n("li",{key:h},i(h),1))),128))])])):k("",!0)])):k("",!0),v.data.actions?(a(),n("div",Ls,[(a(!0),n(q,null,D(v.data.actions,h=>(a(),n("button",{key:h.action,class:"action-btn",onClick:b=>_(h.action)},[e("span",null,i(h.icon),1),L(" "+i(h.label),1)],8,Ts))),128))])):k("",!0)]))}},Es=ae(Is,[["__scopeId","data-v-1afa43aa"]]),Qs=["innerHTML"],zs={__name:"MarkdownRenderer",props:{content:{type:String,required:!0}},setup(v){const l=v,c=Ke(()=>{let r=l.content;return r=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),r=r.replace(/```(\w+)?\n([\s\S]*?)```/g,(y,_,p)=>{const A=_||"text";return`<div class="code-block">
      <div class="code-header">
        <span class="code-lang">${A}</span>
        <button class="copy-btn" onclick="copyCode(this)">复制</button>
      </div>
      <pre><code class="language-${A}">${p.trim()}</code></pre>
    </div>`}),r=r.replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>'),r=r.replace(/^### (.*$)/gm,'<h3 class="md-h3">$1</h3>'),r=r.replace(/^## (.*$)/gm,'<h2 class="md-h2">$1</h2>'),r=r.replace(/^# (.*$)/gm,'<h1 class="md-h1">$1</h1>'),r=r.replace(/\*\*(.*?)\*\*/g,'<strong class="md-bold">$1</strong>'),r=r.replace(/\*(.*?)\*/g,'<em class="md-italic">$1</em>'),r=r.replace(/^(\d+)\. (.*$)/gm,'<li class="md-ol-item">$2</li>'),r=r.replace(/^- (.*$)/gm,'<li class="md-ul-item">$2</li>'),r=r.replace(/^• (.*$)/gm,'<li class="md-ul-item">$2</li>'),r=r.replace(/(<li class="md-ol-item">.*<\/li>)/gs,'<ol class="md-ol">$1</ol>'),r=r.replace(/(<li class="md-ul-item">.*<\/li>)/gs,'<ul class="md-ul">$1</ul>'),r=r.replace(/\n\n/g,'</p><p class="md-paragraph">'),r=r.replace(/\n/g,"<br>"),r.startsWith("<")||(r='<p class="md-paragraph">'+r+"</p>"),r=r.replace(/^&gt; (.*$)/gm,'<blockquote class="md-quote">$1</blockquote>'),r=r.replace(/^---$/gm,'<hr class="md-divider">'),r=r.replace(/\|(.+)\|/g,(y,_)=>`<tr class="md-tr">${_.split("|").map(g=>g.trim()).map(g=>`<td class="md-td">${g}</td>`).join("")}</tr>`),r});return typeof window<"u"&&(window.copyCode=function(r){const _=r.closest(".code-block").querySelector("code").textContent;navigator.clipboard.writeText(_).then(()=>{r.textContent="已复制",setTimeout(()=>{r.textContent="复制"},2e3)}).catch(()=>{const p=document.createElement("textarea");p.value=_,document.body.appendChild(p),p.select(),document.execCommand("copy"),document.body.removeChild(p),r.textContent="已复制",setTimeout(()=>{r.textContent="复制"},2e3)})}),(r,y)=>(a(),n("div",{class:"markdown-renderer",innerHTML:c.value},null,8,Qs))}},Ps=ae(zs,[["__scopeId","data-v-01919da8"]]),Os={class:"simple-ai-three-column"},Bs={class:"three-column-layout"},Ns={class:"left-panel"},Vs={class:"conversation-management"},Us={class:"section-content"},Hs={key:0,class:"saved-sessions"},js={class:"sessions-header"},Fs={class:"sessions-title"},Gs={class:"sessions-container"},Ws={class:"sessions-list-scrollable"},Js=["onClick","title"],Xs={class:"session-content"},Ks={class:"session-info"},Zs={class:"session-title"},Ys={class:"session-preview"},ea={class:"session-meta"},ta={class:"session-time"},sa=["onClick"],aa={style:{background:"#e8f5e8",padding:"5px",margin:"5px 0","font-size":"11px","border-radius":"3px",color:"#2d5a2d"}},na={class:"rule-section"},oa={class:"section-content"},ia={class:"rule-category"},la={class:"rule-container"},ra={class:"rule-buttons-scrollable",ref:"inventoryRulesContainer"},ca=["onClick","title"],da={class:"rule-pagination"},ua={class:"rule-count"},va={class:"rule-category"},pa={class:"rule-container"},ma={class:"rule-buttons-scrollable",ref:"qualityRulesContainer"},ya=["onClick","title"],ha={class:"rule-pagination"},fa={class:"rule-count"},ga={class:"rule-category"},_a={class:"rule-container"},ba={class:"rule-buttons-scrollable",ref:"productionRulesContainer"},ka=["onClick","title"],$a={class:"rule-pagination"},Ca={class:"rule-count"},xa={class:"rule-section"},wa={class:"section-content"},Sa={class:"rule-category"},qa={class:"rule-buttons"},Da=["onClick"],Aa={class:"rule-section"},Ma={class:"section-content"},Ra={class:"rule-section"},La={class:"section-content"},Ta={key:0,class:"current-session"},Ia={class:"session-info"},Ea={class:"message-count"},Qa={class:"session-actions"},za=["disabled"],Pa={key:1,class:"history-sessions"},Oa={class:"session-list"},Ba=["onClick"],Na={class:"session-header"},Va={class:"session-title"},Ua=["onClick"],Ha={class:"session-meta"},ja={class:"session-time"},Fa={class:"session-count"},Ga={key:0,class:"view-more"},Wa={key:2,class:"empty-sessions"},Ja={class:"center-panel"},Xa={class:"chat-container"},Ka={class:"messages-container",ref:"messagesContainer"},Za={key:0,class:"empty-messages"},Ya={key:0,class:"user-message-wrapper"},en={class:"user-content"},tn={class:"user-text"},sn={class:"message-time"},an={key:1,class:"assistant-message-wrapper"},nn={class:"assistant-content"},on={class:"assistant-header"},ln={key:0,class:"message-source"},rn=["onClick","disabled","title"],cn={key:0},dn={key:1},un={key:0,class:"loading-content"},vn={class:"loading-text"},pn={key:1},mn={key:2},yn={key:0,class:"ai-response"},hn=["innerHTML"],fn={key:2,class:"cards-container"},gn={class:"card-header"},_n={class:"card-icon"},bn={class:"card-title"},kn={class:"card-content"},$n={class:"card-value"},Cn={key:0,class:"card-subtitle"},xn={key:3,class:"table-container"},wn={class:"data-table"},Sn={key:3,class:"workflow-info"},qn={class:"workflow-summary"},Dn={class:"workflow-text"},An={key:4,class:"chart-info"},Mn={class:"chart-summary"},Rn={class:"chart-text"},Ln={class:"message-time"},Tn={class:"input-area"},In={class:"input-container"},En=["disabled"],Qn=["disabled","title"],zn={key:0},Pn={key:1},On={key:2},Bn=["disabled"],Nn={key:0},Vn={key:1},Un={key:0,class:"voice-status"},Hn={key:1,class:"voice-transcript"},jn={key:0,class:"transcript-line"},Fn={class:"transcript-text interim"},Gn={key:1,class:"transcript-line"},Wn={class:"transcript-text final"},Jn={class:"confidence"},Xn={key:2,class:"voice-debug"},Kn={class:"debug-info"},Zn={class:"right-panel"},Yn={class:"panel-header"},eo={key:0,class:"analysis-status"},to={class:"status-text"},so={key:0,class:"analysis-content"},ao={class:"analysis-overview"},no={class:"analysis-title"},oo={class:"analysis-meta"},io={class:"analysis-time"},lo={class:"analysis-type"},ro={class:"workflow-steps"},co={class:"step-header"},uo={class:"step-number"},vo={class:"step-info"},po={class:"step-title"},mo={class:"step-description"},yo={class:"step-status"},ho={key:0,class:"loading-spinner"},fo={key:1,class:"success-icon"},go={key:2,class:"error-icon"},_o={key:3,class:"pending-icon"},bo={key:0,class:"step-details"},ko={key:0,class:"step-data"},$o={key:1,class:"step-result"},Co={key:2,class:"step-duration"},xo={key:0,class:"analysis-summary"},wo={class:"summary-content"},So={key:0,class:"summary-item"},qo={key:1,class:"summary-item"},Do={key:2,class:"summary-item"},Ao={key:1,class:"empty-analysis"},Mo={__name:"SimpleAIThreeColumn",setup(v){const l=x([]),c=x(""),r=x(null),y=x(!1),_=x(null),p=x(null),A=x({available:!1,lastCheck:null,error:null}),g=x({isSupported:!1,isListening:!1,isSpeaking:!1}),$=x({final:"",interim:"",confidence:0});x([]);const m=x([]),u=x({basic:!0,ai:!1,chart:!1,conversation:!0}),h=x(!1),b=x({inventory:[{name:"🏭 工厂库存查询",query:"查询深圳工厂的库存情况"},{name:"🏢 供应商物料查询",query:"查询聚龙供应商的物料批次"},{name:"🔋 物料库存查询",query:"查询电池盖的库存状态"},{name:"⚠️ 状态库存查询",query:"查询风险状态的物料批次"},{name:"📦 批次详情查询",query:"查询批次号的详细信息"},{name:"🏪 仓库分布查询",query:"查询中央库存的物料分布"}],quality:[{name:"📊 质量状态分析",query:"分析库存物料的质量状态"},{name:"🏢 供应商质量评估",query:"评估各供应商的质量表现"},{name:"⚠️ 风险等级分析",query:"分析物料的风险等级分布"},{name:"🏗️ 物料类别质量",query:"分析结构件类物料的质量状况"},{name:"🏭 工厂质量分析",query:"分析深圳工厂的整体质量情况"},{name:"💡 质量改进建议",query:"基于当前数据提供质量改进建议"}],production:[{name:"🏭 生产状态查询",query:"查询当前生产状态"},{name:"📉 不良率分析",query:"分析生产不良率情况"},{name:"⚡ 产线效率查询",query:"查询各产线效率"},{name:"📋 在线跟踪记录",query:"查询在线跟踪记录"},{name:"⚠️ 异常记录查询",query:"查询生产异常记录"},{name:"🎯 质量控制点",query:"查询质量控制点状态"}]}),I=x({analysis:[{name:"🤖 智能质量分析",query:"请对当前质量状况进行深度分析并提供改进建议"},{name:"🏢 供应商风险评估",query:"分析聚龙、欣冠、广正等供应商的风险等级和质量表现"},{name:"🔮 预测性维护",query:"基于历史数据预测可能的质量问题"},{name:"📦 库存优化建议",query:"基于历史数据分析库存配置优化方案"},{name:"📈 趋势预测分析",query:"预测未来一个月的质量趋势变化"},{name:"⚙️ 工艺优化建议",query:"基于质量数据提供工艺优化建议"}]});x({visualization:[{name:"📊 TOP不良物料排行",query:"生成TOP不良物料排行榜"},{name:"⚠️ 风险等级分布图",query:"显示风险等级分布图"},{name:"🏢 供应商质量对比",query:"生成聚龙、欣冠、广正供应商质量对比雷达图"},{name:"📈 库存趋势图表",query:"生成库存变化趋势图表"},{name:"✅ 合格率统计图",query:"生成月度合格率统计图"},{name:"📉 不良类型分析图",query:"生成不良类型帕累托分析图"}]});const U=async()=>{var s,f,S,Q,P;if(!c.value.trim()||y.value)return;const o=c.value.trim();console.log("🚀 开始处理用户消息:",o),l.value.push({type:"user",content:o,timestamp:new Date});const t={type:"assistant",content:"正在智能分析您的问题...",isLoading:!0,timestamp:new Date};l.value.push(t),c.value="",y.value=!0;try{console.log("🧠 执行AI意图分析...");const B=await ie.analyzeUserIntent(o);console.log("🎯 意图分析结果:",B);const X=l.value.length-1;l.value[X].content="正在处理您的请求...";let F=null;if(B.needsDataQuery){console.log("📊 需要数据查询，调用数据API...");const G=await fetch("/api/assistant/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:o,scenario:"basic",intentAnalysis:B})});if(!G.ok)throw new Error(`数据查询API请求失败: ${G.status}`);F=await G.json(),console.log("✅ 数据查询成功:",F),l.value[X]={type:"assistant",content:((s=F.data)==null?void 0:s.answer)||"查询完成",cards:((f=F.data)==null?void 0:f.cards)||[],tableData:((S=F.data)==null?void 0:S.tableData)||[],tableColumns:((Q=F.data)==null?void 0:Q.tableColumns)||[],chartId:((P=F.data)==null?void 0:P.chartId)||null,isLoading:!1,timestamp:new Date,source:"data-query",intentAnalysis:B}}else{console.log("💬 咨询问答，使用AI增强回复...");try{const G=await ie.callDeepSeek(`
我是小Q，QMS问答助手，专业的质量管理AI助手。请回答以下问题：

用户问题：${o}

请以小Q的身份提供专业、详细的回答，包含：
1. 问题分析
2. 专业建议
3. 最佳实践
4. 注意事项

回答要求：
- 以"小Q为您解答"开头
- 语言亲切专业
- 结构清晰
- 实用性强
- 符合质量管理标准
- 结尾可以说"还有其他问题随时问小Q哦！"
        `);l.value[X]={type:"assistant",content:G,isLoading:!1,timestamp:new Date,source:"ai-consultation",intentAnalysis:B}}catch(G){console.warn("⚠️ AI咨询失败，使用降级回复:",G.message);const Pe=ie.generateFallbackResponse(o,B.intent);l.value[X]={type:"assistant",content:Pe,isLoading:!1,timestamp:new Date,source:"fallback",intentAnalysis:B}}}console.log("📊 消息处理完成")}catch(B){console.error("❌ 处理消息失败:",B);const X=l.value.length-1;l.value[X]={type:"assistant",content:`抱歉，处理您的问题时出现错误：${B.message}`,isLoading:!1,timestamp:new Date,source:"error"}}finally{y.value=!1}},C=()=>{l.value=[],_.value=null,console.log("🗑️ 对话已清空")},M=()=>{if(!g.value.isSupported){console.warn("⚠️ 浏览器不支持语音功能");return}g.value.isListening?R():d()},d=()=>{console.log("🎤 开始语音输入"),$.value={final:"",interim:"",confidence:0},Y.startListening()?(g.value.isListening=!0,console.log("🎤 语音识别已启动，请开始说话...")):console.error("❌ 语音识别启动失败")},R=()=>{console.log("🎤 停止语音输入"),Y.stopListening()&&(g.value.isListening=!1,$.value.final.trim()&&(c.value=$.value.final.trim(),$.value={final:"",interim:"",confidence:0}))},O=o=>{if(!g.value.isSupported)return console.warn("⚠️ 浏览器不支持语音合成"),!1;const t=o.replace(/<[^>]*>/g,"").replace(/[#*`]/g,"").replace(/\n+/g,"。").trim();return t.length===0?(console.warn("⚠️ 没有可播放的文本内容"),!1):(console.log("🔊 开始语音播放回复"),Y.speak(t))},w=()=>{console.log("🧪 开始语音调试测试"),console.log("🎤 当前语音状态:",g.value),console.log("📝 当前识别结果:",$.value),console.log("💬 当前输入内容:",c.value),g.value.isListening?(console.log("🎤 停止语音识别测试..."),R()):(console.log("🎤 启动语音识别测试..."),d())},E=()=>{l.value.push({type:"assistant",content:`# 小Q为您解答

## 质量管理分析报告

### 1. 问题分析
您询问的是关于**质量管理**的问题，这是一个非常重要的话题。

### 2. 专业建议
- **建立完善的质量体系**：确保所有流程都有明确的标准
- **定期质量检查**：建立定期检查机制
- **数据驱动决策**：基于数据分析进行质量改进

### 3. 最佳实践
\`\`\`javascript
// 质量检查示例代码
function qualityCheck(product) {
  if (product.defectRate > 0.03) {
    return 'FAIL';
  }
  return 'PASS';
}
\`\`\`

### 4. 注意事项
> 质量管理是一个持续改进的过程，需要全员参与。

---

还有其他问题随时问小Q哦！`,timestamp:new Date,source:"ai-consultation"})},ue=o=>new Date(o).toLocaleTimeString(),be=o=>typeof o=="object"&&o!==null&&o.type,ke=o=>{switch(console.log("处理响应操作:",o),o.action){case"export":$e(o.data);break;case"detail":Ce(o.data);break;case"risk_analysis":xe(o.data);break;case"load_more":we(o.data);break;default:console.log("未知操作:",o.action)}},$e=o=>{console.log("导出数据:",o)},Ce=o=>{console.log("显示详细视图:",o)},xe=o=>{console.log("执行风险分析:",o)},we=o=>{console.log("加载更多数据:",o)},Se=o=>{if(!o)return"";let t=o.replace(/\n/g,"<br>");return t=t.replace(/(\d+\.?\d*%?)/g,'<span class="highlight-number">$1</span>'),["合格","不合格","风险","质量","库存","供应商","测试","检验","聚龙","欣冠","广正","BOE","天马","华星","深圳工厂","重庆工厂","南昌工厂","宜宾工厂","电池盖","中框","手机卡托","LCD显示屏","OLED显示屏","结构件类","光学类","机械类"].forEach(f=>{const S=new RegExp(`(${f})`,"g");t=t.replace(S,'<span class="highlight-keyword">$1</span>')}),t},qe=o=>({"basic-rules":"基础规则","ai-enhanced":"AI增强","chart-tool":"图表工具"})[o]||o,De=o=>{var S,Q;if(!o)return"";const t=((S=o.steps)==null?void 0:S.filter(P=>P.status==="completed").length)||0,s=((Q=o.steps)==null?void 0:Q.length)||0,f=o.totalTime||0;return`${t}/${s}步完成，耗时${f}ms`},ve=o=>{const t=new Date(o),f=new Date-t,S=Math.floor(f/6e4),Q=Math.floor(f/36e5),P=Math.floor(f/864e5);return S<1?"刚刚":S<60?`${S}分钟前`:Q<24?`${Q}小时前`:P<7?`${P}天前`:t.toLocaleDateString()},Z=o=>{u.value[o]=!u.value[o]},ne=o=>{y.value||(c.value=o,U())},W=(o,t)=>{const s={inventory:"inventoryRulesContainer",quality:"qualityRulesContainer",production:"productionRulesContainer"}[o],f=document.querySelector(`[ref="${s}"]`)||document.querySelector(".rule-buttons-scrollable");if(f){const Q=f.scrollLeft,P=t==="left"?Math.max(0,Q-120):Q+120;f.scrollTo({left:P,behavior:"smooth"})}},le=o=>{const t=b.value[o]||[];return`${Math.min(4,t.length)}/${t.length}`},Ae=()=>{if(!p.value)return"";switch(p.value.status){case"processing":return"分析中...";case"completed":return"分析完成";case"error":return"分析失败";default:return"等待中"}},Me=o=>o?new Date(o).toLocaleTimeString():"",Re=o=>typeof o=="object"?JSON.stringify(o).substring(0,100)+"...":String(o).substring(0,100),Le=()=>"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),J=()=>{var s,f;if(l.value.length===0)return;const o={id:r.value||Le(),title:((f=(s=l.value[0])==null?void 0:s.content)==null?void 0:f.substring(0,30))+"..."||"新对话",messages:[...l.value],analysis:p.value?{...p.value}:null,timestamp:new Date,messageCount:l.value.length},t=m.value.findIndex(S=>S.id===o.id);t>=0?m.value[t]=o:m.value.unshift(o),m.value.length>50&&(m.value=m.value.slice(0,50)),localStorage.setItem("ai_chat_sessions",JSON.stringify(m.value)),r.value=o.id,console.log("💾 会话已保存:",o.title)},pe=()=>{try{const o=localStorage.getItem("ai_chat_sessions");o&&(m.value=JSON.parse(o),console.log(`📚 加载了 ${m.value.length} 个历史会话`))}catch(o){console.error("加载历史会话失败:",o),m.value=[]}},me=o=>{let t;typeof o=="string"?t=m.value.find(s=>s.id===o):t=o,t&&(l.value=[...t.messages],p.value=t.analysis?{...t.analysis}:null,r.value=t.id,console.log("📖 已加载会话:",t.title))},re=()=>{l.value.length>0&&J(),l.value=[],p.value=null,r.value=null,console.log("🆕 创建新会话")},Te=()=>{re();const o=[];A.value.available&&o.push("AI增强分析"),g.value.isSupported&&o.push("语音交互");const t=o.length>0?`👋 您好！我是小Q，您的专属QMS问答助手！已启用${o.join("、")}功能，可以帮您查询质量数据、分析问题和提供专业建议。有什么问题尽管问我吧！`:"👋 您好！我是小Q，您的专属QMS问答助手！当前使用基础模式，可以帮您查询质量数据和提供基础建议。有什么问题尽管问我吧！";l.value.push({type:"assistant",content:t,timestamp:new Date,source:"system"})},ye=o=>{m.value=m.value.filter(t=>t.id!==o),localStorage.setItem("ai_chat_sessions",JSON.stringify(m.value)),r.value===o&&re(),console.log("🗑️ 会话已删除")},Ie=()=>{pe(),console.log("🔄 已刷新会话列表")},Ee=()=>{confirm("确定要清空所有历史会话吗？此操作不可恢复。")&&(m.value=[],localStorage.removeItem("ai_chat_sessions"),console.log("🗑️ 已清空所有历史会话"))},Qe=o=>{if(!o.messages||o.messages.length===0)return"空会话";const t=o.messages.find(f=>f.type==="user");if(t)return t.content.substring(0,30)+(t.content.length>30?"...":"");const s=o.messages.find(f=>f.type==="assistant");return s?s.content.substring(0,30)+(s.content.length>30?"...":""):"无内容"};ce(l,()=>{l.value.length>0&&setTimeout(()=>{J()},1e3)},{deep:!0}),de(async()=>{console.log("🚀 QMS问答助手-小Q初始化..."),pe();try{console.log("🤖 初始化AI服务...");const s=await ie.initialize();A.value={available:s,lastCheck:new Date,error:s?null:"AI服务初始化失败"},console.log("🤖 AI服务状态:",A.value)}catch(s){console.error("❌ AI服务初始化失败:",s),A.value={available:!1,lastCheck:new Date,error:s.message}}try{console.log("🎤 初始化语音服务...");const s=Y.getStatus();g.value=s,Y.setCallbacks({onResult:f=>{console.log("🎤 语音识别结果:",f),$.value=f,f.final&&f.final.trim()&&(console.log("🎤 自动填入识别结果:",f.final),c.value=f.final.trim(),setTimeout(()=>{$.value={final:"",interim:"",confidence:0}},1e3))},onError:f=>{console.error("❌ 语音识别错误:",f),g.value.isListening=!1,$.value={final:"",interim:"",confidence:0}},onStart:()=>{console.log("🎤 语音识别开始"),g.value.isListening=!0,$.value={final:"",interim:"",confidence:0}},onEnd:()=>{console.log("🎤 语音识别结束"),g.value.isListening=!1,$.value.final&&$.value.final.trim()&&!c.value&&(console.log("🎤 识别结束时填入结果:",$.value.final),c.value=$.value.final.trim(),setTimeout(()=>{$.value={final:"",interim:"",confidence:0}},1e3))},onSpeechStart:()=>{console.log("🔊 语音播放开始"),g.value.isSpeaking=!0},onSpeechEnd:()=>{console.log("🔊 语音播放结束"),g.value.isSpeaking=!1}}),console.log("🎤 语音服务状态:",g.value)}catch(s){console.error("❌ 语音服务初始化失败:",s),g.value.isSupported=!1}m.value.length>0&&console.log(`📚 发现 ${m.value.length} 个历史会话`);const o=[];A.value.available&&o.push("AI增强分析"),g.value.isSupported&&o.push("语音交互");const t=o.length>0?`👋 您好！我是小Q，您的专属QMS问答助手！已启用${o.join("、")}功能，可以帮您查询质量数据、分析问题和提供专业建议。有什么问题尽管问我吧！`:"👋 您好！我是小Q，您的专属QMS问答助手！当前使用基础模式，可以帮您查询质量数据和提供基础建议。有什么问题尽管问我吧！";l.value.push({type:"assistant",content:t,timestamp:new Date,source:"system"})});const ze=o=>{console.log("📊 图表生成成功:",o);const t={type:"assistant",content:`📊 已生成${o.name}图表，请查看左侧图表工具面板中的预览。`,timestamp:new Date,chartData:o,source:"chart-tool"};l.value.push(t),setTimeout(()=>{J()},500)};return Ze(()=>{l.value.length>0&&J()}),(o,t)=>(a(),n("div",Os,[e("div",{class:"header-bar"},[t[13]||(t[13]=e("div",{class:"header-left"},[e("div",{class:"logo-section"},[e("span",{class:"logo-icon"},"🤖"),e("span",{class:"logo-text"},"QMS问答助手-小Q")])],-1)),e("div",{class:"header-right"},[e("button",{onClick:C,class:"header-button"},"清空对话")])]),e("div",Bs,[e("div",Ns,[t[34]||(t[34]=e("div",{class:"panel-header"},[e("span",{class:"panel-icon"},"⚙️"),e("h3",{class:"panel-title"},"功能区")],-1)),e("div",Vs,[e("div",{class:"section-header",onClick:t[0]||(t[0]=s=>Z("conversation"))},[t[14]||(t[14]=e("span",{class:"section-icon"},"💬",-1)),t[15]||(t[15]=e("span",{class:"section-title"},"对话管理",-1)),e("span",{class:T(["expand-icon",{expanded:u.value.conversation}])},"▼",2)]),V(e("div",Us,[e("div",{class:"conversation-controls"},[e("button",{onClick:Te,class:"control-btn new-conversation"},t[16]||(t[16]=[e("span",{class:"btn-icon"},"➕",-1),e("span",{class:"btn-text"},"新建对话",-1)])),e("button",{onClick:J,class:"control-btn save-session"},t[17]||(t[17]=[e("span",{class:"btn-icon"},"💾",-1),e("span",{class:"btn-text"},"保存会话",-1)])),e("button",{onClick:C,class:"control-btn clear-messages"},t[18]||(t[18]=[e("span",{class:"btn-icon"},"🗑️",-1),e("span",{class:"btn-text"},"清空对话",-1)]))]),m.value.length>0?(a(),n("div",Hs,[e("div",js,[e("h5",Fs,"历史会话 ("+i(m.value.length)+")",1),e("div",{class:"sessions-controls"},[e("button",{onClick:Ie,class:"refresh-btn",title:"刷新会话列表"}," 🔄 "),e("button",{onClick:Ee,class:"clear-all-btn",title:"清空所有历史会话"}," 🗑️ ")])]),e("div",Gs,[e("div",Ws,[(a(!0),n(q,null,D(m.value,s=>(a(),n("div",{key:s.id,onClick:f=>me(s),class:T(["session-item",{active:s.id===r.value}]),title:s.title},[e("div",Xs,[t[19]||(t[19]=e("span",{class:"session-icon"},"📝",-1)),e("div",Ks,[e("span",Zs,i(s.title),1),e("span",Ys,i(Qe(s)),1)]),e("div",ea,[e("span",ta,i(ve(s.timestamp)),1),e("button",{onClick:fe(f=>ye(s.id),["stop"]),class:"delete-session-btn",title:"删除此会话"}," ❌ ",8,sa)])])],10,Js))),128))])])])):k("",!0)],512),[[j,u.value.conversation]])]),e("div",aa," ✅ 规则已优化去重 | 库存("+i(b.value.inventory.length)+") 质量("+i(b.value.quality.length)+") 生产("+i(b.value.production.length)+") | "+i(new Date().toLocaleTimeString()),1),e("div",na,[e("div",{class:"section-header",onClick:t[1]||(t[1]=s=>Z("basic"))},[t[20]||(t[20]=e("span",{class:"section-icon"},"📋",-1)),t[21]||(t[21]=e("span",{class:"section-title"},"智能问答规则",-1)),e("span",{class:T(["expand-icon",{expanded:u.value.basic}])},"▼",2)]),V(e("div",oa,[e("div",ia,[e("h4",null,"📦 库存查询 ("+i(b.value.inventory.length)+")",1),e("div",la,[e("div",ra,[(a(!0),n(q,null,D(b.value.inventory,s=>(a(),n("button",{key:s.query,onClick:f=>ne(s.query),class:"rule-btn",title:s.query},i(s.name),9,ca))),128))],512),e("div",da,[e("button",{onClick:t[2]||(t[2]=s=>W("inventory","left")),class:"scroll-btn"},"◀"),e("span",ua,i(le("inventory")),1),e("button",{onClick:t[3]||(t[3]=s=>W("inventory","right")),class:"scroll-btn"},"▶")])])]),e("div",va,[e("h4",null,"🧪 质量分析 ("+i(b.value.quality.length)+")",1),e("div",pa,[e("div",ma,[(a(!0),n(q,null,D(b.value.quality,s=>(a(),n("button",{key:s.query,onClick:f=>ne(s.query),class:"rule-btn",title:s.query},i(s.name),9,ya))),128))],512),e("div",ha,[e("button",{onClick:t[4]||(t[4]=s=>W("quality","left")),class:"scroll-btn"},"◀"),e("span",fa,i(le("quality")),1),e("button",{onClick:t[5]||(t[5]=s=>W("quality","right")),class:"scroll-btn"},"▶")])])]),e("div",ga,[e("h4",null,"🏭 生产跟踪 ("+i(b.value.production.length)+")",1),e("div",_a,[e("div",ba,[(a(!0),n(q,null,D(b.value.production,s=>(a(),n("button",{key:s.query,onClick:f=>ne(s.query),class:"rule-btn",title:s.query},i(s.name),9,ka))),128))],512),e("div",$a,[e("button",{onClick:t[6]||(t[6]=s=>W("production","left")),class:"scroll-btn"},"◀"),e("span",Ca,i(le("production")),1),e("button",{onClick:t[7]||(t[7]=s=>W("production","right")),class:"scroll-btn"},"▶")])])])],512),[[j,u.value.basic]])]),e("div",xa,[e("div",{class:"section-header",onClick:t[8]||(t[8]=s=>Z("ai"))},[t[22]||(t[22]=e("span",{class:"section-icon"},"🤖",-1)),t[23]||(t[23]=e("span",{class:"section-title"},"AI增强分析",-1)),e("span",{class:T(["expand-icon",{expanded:u.value.ai}])},"▼",2)]),V(e("div",wa,[e("div",Sa,[t[24]||(t[24]=e("h4",null,"🔍 智能分析",-1)),e("div",qa,[(a(!0),n(q,null,D(I.value.analysis,s=>(a(),n("button",{key:s.query,onClick:f=>ne(s.query),class:"rule-btn ai-rule"},i(s.name),9,Da))),128))])])],512),[[j,u.value.ai]])]),e("div",Aa,[e("div",{class:"section-header",onClick:t[9]||(t[9]=s=>Z("chart"))},[t[25]||(t[25]=e("span",{class:"section-icon"},"📊",-1)),t[26]||(t[26]=e("span",{class:"section-title"},"图表工具",-1)),e("span",{class:T(["expand-icon",{expanded:u.value.chart}])},"▼",2)]),V(e("div",Ma,[z(Mt,{onChartGenerated:ze})],512),[[j,u.value.chart]])]),e("div",Ra,[e("div",{class:"section-header",onClick:t[10]||(t[10]=s=>Z("conversation"))},[t[27]||(t[27]=e("span",{class:"section-icon"},"💬",-1)),t[28]||(t[28]=e("span",{class:"section-title"},"对话管理",-1)),e("span",{class:T(["expand-icon",{expanded:u.value.conversation}])},"▼",2)]),V(e("div",La,[r.value?(a(),n("div",Ta,[e("div",Ia,[t[29]||(t[29]=e("span",{class:"session-icon"},"🟢",-1)),t[30]||(t[30]=e("span",{class:"session-text"},"当前会话",-1)),e("span",Ea,i(l.value.length)+"条",1)])])):k("",!0),e("div",Qa,[e("button",{onClick:re,class:"action-btn new-session"},t[31]||(t[31]=[e("span",{class:"btn-icon"},"➕",-1),L(" 新建对话 ")])),e("button",{onClick:J,class:"action-btn save-session",disabled:l.value.length===0},t[32]||(t[32]=[e("span",{class:"btn-icon"},"💾",-1),L(" 保存对话 ")]),8,za)]),m.value.length>0?(a(),n("div",Pa,[e("h4",null,"📚 历史对话 ("+i(m.value.length)+")",1),e("div",Oa,[(a(!0),n(q,null,D(m.value.slice(0,5),s=>(a(),n("div",{key:s.id,class:T(["session-item",{active:s.id===r.value}]),onClick:f=>me(s.id)},[e("div",Na,[e("span",Va,i(s.title),1),e("button",{onClick:fe(f=>ye(s.id),["stop"]),class:"delete-btn",title:"删除会话"}," ❌ ",8,Ua)]),e("div",Ha,[e("span",ja,i(ve(s.timestamp)),1),e("span",Fa,i(s.messageCount)+"条消息",1)])],10,Ba))),128))]),m.value.length>5?(a(),n("div",Ga,[e("button",{onClick:t[11]||(t[11]=s=>h.value=!h.value),class:"view-more-btn"},i(h.value?"收起":`查看全部 ${m.value.length} 个会话`),1)])):k("",!0)])):(a(),n("div",Wa,t[33]||(t[33]=[e("div",{class:"empty-icon"},"📝",-1),e("div",{class:"empty-text"},"暂无历史对话",-1)])))],512),[[j,u.value.conversation]])])]),e("div",Ja,[t[46]||(t[46]=e("div",{class:"panel-header"},[e("span",{class:"panel-icon"},"💬"),e("h3",{class:"panel-title"},"AI对话")],-1)),e("div",Xa,[e("div",Ka,[l.value.length===0?(a(),n("div",Za,t[35]||(t[35]=[e("div",{class:"empty-icon"},"💬",-1),e("div",{class:"empty-text"},"开始您的智能问答之旅",-1),e("div",{class:"empty-hint"},"点击左侧规则按钮或直接输入问题",-1)]))):k("",!0),(a(!0),n(q,null,D(l.value,(s,f)=>(a(),n("div",{key:f,class:T(["message-item",s.type])},[s.type==="user"?(a(),n("div",Ya,[t[36]||(t[36]=e("div",{class:"user-avatar"},"👤",-1)),e("div",en,[e("div",tn,i(s.content),1),e("div",sn,i(ue(s.timestamp)),1)])])):(a(),n("div",an,[t[41]||(t[41]=e("div",{class:"assistant-avatar"},"🤖",-1)),e("div",nn,[e("div",on,[t[37]||(t[37]=e("span",{class:"assistant-name"},"QMS问答助手-小Q",-1)),s.source?(a(),n("span",ln,i(qe(s.source)),1)):k("",!0),g.value.isSupported&&!s.isLoading?(a(),n("button",{key:1,onClick:S=>O(s.content),class:"voice-play-button",disabled:g.value.isSpeaking,title:g.value.isSpeaking?"正在播放...":"点击播放语音"},[g.value.isSpeaking?(a(),n("span",cn,"🔊")):(a(),n("span",dn,"🔉"))],8,rn)):k("",!0)]),s.isLoading?(a(),n("div",un,[t[38]||(t[38]=e("div",{class:"loading-spinner"},"⏳",-1)),e("div",vn,i(s.content),1)])):be(s.content)?(a(),n("div",pn,[z(Es,{data:s.content,onAction:ke},null,8,["data"])])):(a(),n("div",mn,[s.source==="ai-consultation"||s.source==="ai-enhanced"?(a(),n("div",yn,[z(Ps,{content:s.content},null,8,["content"])])):(a(),n("div",{key:1,class:"assistant-text",innerHTML:Se(s.content)},null,8,hn)),s.cards&&s.cards.length>0?(a(),n("div",fn,[(a(!0),n(q,null,D(s.cards,(S,Q)=>(a(),n("div",{key:Q,class:"data-card"},[e("div",gn,[e("span",_n,i(S.icon||"📊"),1),e("span",bn,i(S.title),1)]),e("div",kn,[e("div",$n,i(S.value),1),S.subtitle?(a(),n("div",Cn,i(S.subtitle),1)):k("",!0)])]))),128))])):k("",!0),s.tableData&&s.tableData.length>0?(a(),n("div",xn,[e("table",wn,[e("thead",null,[e("tr",null,[(a(!0),n(q,null,D(s.tableColumns,S=>(a(),n("th",{key:S.key},i(S.title),1))),128))])]),e("tbody",null,[(a(!0),n(q,null,D(s.tableData,(S,Q)=>(a(),n("tr",{key:Q},[(a(!0),n(q,null,D(s.tableColumns,P=>(a(),n("td",{key:P.key},i(S[P.key]),1))),128))]))),128))])])])):k("",!0)])),s.workflow?(a(),n("div",Sn,[e("div",qn,[t[39]||(t[39]=e("span",{class:"workflow-icon"},"⚡",-1)),e("span",Dn,i(De(s.workflow)),1)])])):k("",!0),s.chartId?(a(),n("div",An,[e("div",Mn,[t[40]||(t[40]=e("span",{class:"chart-icon"},"📊",-1)),e("span",Rn,"已生成图表，ID: "+i(s.chartId),1)])])):k("",!0),e("div",Ln,i(ue(s.timestamp)),1)])]))],2))),128))],512),e("div",Tn,[e("div",In,[V(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>c.value=s),onKeyup:et(U,["enter"]),placeholder:"向小Q提问，或点击🎤语音输入...",class:"message-input",disabled:y.value},null,40,En),[[Ye,c.value]]),e("button",{onClick:M,class:T(["voice-button",{listening:g.value.isListening,disabled:!g.value.isSupported}]),disabled:y.value,title:g.value.isSupported?g.value.isListening?"点击停止录音":"点击开始语音输入":"浏览器不支持语音功能"},[g.value.isListening?(a(),n("span",zn,"🔴")):g.value.isSupported?(a(),n("span",Pn,"🎤")):(a(),n("span",On,"🚫"))],10,Qn),e("button",{onClick:U,class:"send-button",disabled:y.value||!c.value.trim()},[y.value?(a(),n("span",Nn,"⏳")):(a(),n("span",Vn,"🚀"))],8,Bn)]),g.value.isListening?(a(),n("div",Un,t[42]||(t[42]=[tt('<div class="voice-indicator" data-v-0290bfa9><div class="voice-wave" data-v-0290bfa9></div><div class="voice-wave" data-v-0290bfa9></div><div class="voice-wave" data-v-0290bfa9></div></div><span class="voice-text" data-v-0290bfa9>正在听您说话...</span>',2)]))):k("",!0),$.value.interim||$.value.final?(a(),n("div",Hn,[$.value.interim?(a(),n("div",jn,[t[43]||(t[43]=e("span",{class:"transcript-label"},"识别中:",-1)),e("span",Fn,i($.value.interim),1)])):k("",!0),$.value.final?(a(),n("div",Gn,[t[44]||(t[44]=e("span",{class:"transcript-label"},"识别完成:",-1)),e("span",Wn,i($.value.final),1),e("span",Jn,"("+i(($.value.confidence*100).toFixed(1))+"%)",1)])):k("",!0)])):k("",!0),g.value.isSupported?(a(),n("div",Xn,[e("small",Kn,[L(" 语音状态: "+i(g.value.isListening?"🔴 录音中":"⚪ 待机")+" | 支持: ✅ | ",1),e("button",{onClick:w,class:"debug-button"},"测试语音"),t[45]||(t[45]=L(" | ")),e("button",{onClick:E,class:"debug-button"},"测试MD")])])):k("",!0)])])]),e("div",Zn,[e("div",Yn,[t[47]||(t[47]=e("span",{class:"panel-icon"},"🧠",-1)),t[48]||(t[48]=e("h3",{class:"panel-title"},"智能分析",-1)),p.value?(a(),n("div",eo,[e("span",{class:T(["status-dot",p.value.status])},null,2),e("span",to,i(Ae()),1)])):k("",!0)]),p.value?(a(),n("div",so,[e("div",ao,[e("div",no,i(p.value.question),1),e("div",oo,[e("span",io,i(Me(p.value.startTime)),1),e("span",lo,i(p.value.type),1)])]),e("div",ro,[(a(!0),n(q,null,D(p.value.steps,(s,f)=>(a(),n("div",{key:f,class:T(["workflow-step",{active:s.status==="processing",completed:s.status==="completed",error:s.status==="error"}])},[e("div",co,[e("div",uo,i(f+1),1),e("div",vo,[e("div",po,i(s.title),1),e("div",mo,i(s.description),1)]),e("div",yo,[s.status==="processing"?(a(),n("span",ho,"⏳")):s.status==="completed"?(a(),n("span",fo,"✅")):s.status==="error"?(a(),n("span",go,"❌")):(a(),n("span",_o,"⏸️"))])]),s.details&&s.status==="completed"?(a(),n("div",bo,[s.data?(a(),n("div",ko,[t[49]||(t[49]=e("strong",null,"数据:",-1)),L(" "+i(Re(s.data)),1)])):k("",!0),s.result?(a(),n("div",$o,[t[50]||(t[50]=e("strong",null,"结果:",-1)),L(" "+i(s.result),1)])):k("",!0),s.duration?(a(),n("div",Co,[t[51]||(t[51]=e("strong",null,"耗时:",-1)),L(" "+i(s.duration)+"ms ",1)])):k("",!0)])):k("",!0)],2))),128))]),p.value.summary?(a(),n("div",xo,[t[55]||(t[55]=e("h4",null,"📊 分析摘要",-1)),e("div",wo,[p.value.summary.dataPoints?(a(),n("div",So,[t[52]||(t[52]=e("strong",null,"数据点:",-1)),L(" "+i(p.value.summary.dataPoints),1)])):k("",!0),p.value.summary.insights?(a(),n("div",qo,[t[53]||(t[53]=e("strong",null,"关键洞察:",-1)),L(" "+i(p.value.summary.insights),1)])):k("",!0),p.value.summary.recommendations?(a(),n("div",Do,[t[54]||(t[54]=e("strong",null,"建议:",-1)),L(" "+i(p.value.summary.recommendations),1)])):k("",!0)])])):k("",!0)])):(a(),n("div",Ao,t[56]||(t[56]=[e("div",{class:"empty-icon"},"🤔",-1),e("div",{class:"empty-text"},"等待分析任务...",-1),e("div",{class:"empty-hint"},"点击左侧规则或输入问题开始分析",-1)])))])])]))}},Qo=ae(Mo,[["__scopeId","data-v-0290bfa9"]]);export{Qo as default};
