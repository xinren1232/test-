import{a as S,v as l}from"./VoiceServiceManager-2sv0FYbn.js";import{a as T}from"./index-Bo1zM2q5.js";import{S as r,T as $,c as v,o as d,a as e,b as _,n as b,t as i,F as C,r as x}from"./element-plus-DR-erZ3X.js";import"./echarts-Dfqt_Pbx.js";const Q={class:"test-voice-ai"},V={class:"test-sections"},w={class:"test-section"},E={class:"status-icon"},M={class:"status-info"},R={class:"status-detail"},z=["disabled"],B={key:0,class:"test-result"},D={class:"test-section"},F={class:"status-icon"},N={class:"status-info"},U={class:"status-detail"},J={class:"voice-controls"},O=["disabled"],j=["disabled"],q={key:0,class:"voice-transcript"},G={class:"interim"},H={key:1,class:"voice-transcript"},K={class:"final"},P={class:"confidence"},W={class:"test-section"},X=["disabled"],Y={key:0,class:"test-log"},Z={class:"log-time"},ss={class:"log-message"},es={__name:"TestVoiceAI",setup(ts){const u=r({available:!1,error:null}),a=r({isSupported:!1,isListening:!1,isSpeaking:!1}),n=r({final:"",interim:"",confidence:0}),g=r(!1),m=r(""),p=r(!1),c=r([]);$(async()=>{console.log("🧪 初始化语音AI测试页面");try{const s=await S.initialize();u.value={available:s,error:s?null:"AI服务初始化失败"}}catch(s){u.value={available:!1,error:s.message}}a.value=l.getStatus(),l.setCallbacks({onResult:s=>{console.log("🎤 测试页面收到语音识别结果:",s),n.value=s,t(`语音识别: final="${s.final}", interim="${s.interim}", confidence=${s.confidence}`)},onError:s=>{console.error("语音错误:",s),a.value.isListening=!1,t(`语音识别错误: ${s}`)},onStart:()=>{a.value.isListening=!0,t("语音识别开始")},onEnd:()=>{a.value.isListening=!1,t("语音识别结束")},onSpeechStart:()=>{a.value.isSpeaking=!0,t("语音播放开始")},onSpeechEnd:()=>{a.value.isSpeaking=!1,t("语音播放结束")}});const t=s=>{c.value||(c.value=[]),c.value.push({timestamp:new Date,message:s}),console.log("📝 测试日志:",s)}});const h=async()=>{g.value=!0;try{const t=await S.analyzeUserIntent("测试查询深圳工厂的库存情况");m.value=JSON.stringify(t,null,2)}catch(t){m.value=`测试失败: ${t.message}`}finally{g.value=!1}},I=()=>{a.value.isListening?l.stopListening():(n.value={final:"",interim:"",confidence:0},l.startListening())},k=()=>{l.speak("您好，我是小Q，您的专属QMS问答助手！语音功能正常工作，有什么问题尽管问我吧！")},y=()=>{p.value=!0,c.value=[],o("开始综合测试"),o("请说话，我会识别您的语音，然后用AI分析并语音回复"),n.value={final:"",interim:"",confidence:0},l.startListening(),l.onResult,l.setCallbacks({...l,onResult:async t=>{if(n.value=t,t.final&&t.final.trim()){o(`语音识别完成: ${t.final}`);try{o("正在进行AI分析...");const s=await S.analyzeUserIntent(t.final);o(`AI分析完成: ${s.intent}`);const f=`我是小Q！我听到您说："${t.final}"。根据AI分析，这是一个${s.intent}类型的问题。有什么其他问题随时问我哦！`;o(`生成回复: ${f}`),o("开始语音播放回复..."),l.speak(f)}catch(s){o(`AI分析失败: ${s.message}`)}finally{p.value=!1}}},onEnd:()=>{a.value.isListening=!1,p.value&&!n.value.final&&(o("未识别到语音，测试结束"),p.value=!1)}})},o=t=>{c.value.push({timestamp:new Date,message:t})},A=t=>t.toLocaleTimeString();return(t,s)=>(d(),v("div",Q,[s[10]||(s[10]=e("div",{class:"header"},[e("h1",null,"🎤 小Q语音AI功能测试"),e("p",null,"测试QMS问答助手-小Q的语音识别、AI分析和语音合成功能")],-1)),e("div",V,[e("div",w,[s[2]||(s[2]=e("h2",null,"🤖 AI服务测试",-1)),e("div",{class:b(["status-card",{success:u.value.available,error:!u.value.available}])},[e("div",E,i(u.value.available?"✅":"❌"),1),e("div",M,[s[0]||(s[0]=e("div",{class:"status-title"},"AI服务状态",-1)),e("div",R,i(u.value.available?"服务正常":u.value.error||"服务不可用"),1)])],2),e("button",{onClick:h,disabled:g.value,class:"test-button"},i(g.value?"测试中...":"测试AI服务"),9,z),m.value?(d(),v("div",B,[s[1]||(s[1]=e("h4",null,"AI测试结果：",-1)),e("pre",null,i(m.value),1)])):_("",!0)]),e("div",D,[s[6]||(s[6]=e("h2",null,"🎤 语音服务测试",-1)),e("div",{class:b(["status-card",{success:a.value.isSupported,error:!a.value.isSupported}])},[e("div",F,i(a.value.isSupported?"✅":"❌"),1),e("div",N,[s[3]||(s[3]=e("div",{class:"status-title"},"语音服务状态",-1)),e("div",U,i(a.value.isSupported?"浏览器支持语音功能":"浏览器不支持语音功能"),1)])],2),e("div",J,[e("button",{onClick:I,disabled:!a.value.isSupported,class:b(["voice-button",{recording:a.value.isListening}])},i(a.value.isListening?"🔴 停止录音":"🎤 开始录音"),11,O),e("button",{onClick:k,disabled:!a.value.isSupported||a.value.isSpeaking,class:"test-button"},i(a.value.isSpeaking?"🔊 播放中...":"🔉 测试语音播放"),9,j)]),n.value.interim?(d(),v("div",q,[s[4]||(s[4]=e("h4",null,"识别中：",-1)),e("p",G,i(n.value.interim),1)])):_("",!0),n.value.final?(d(),v("div",H,[s[5]||(s[5]=e("h4",null,"识别结果：",-1)),e("p",K,i(n.value.final),1),e("p",P,"置信度: "+i((n.value.confidence*100).toFixed(1))+"%",1)])):_("",!0)]),e("div",W,[s[8]||(s[8]=e("h2",null,"🚀 综合功能测试",-1)),s[9]||(s[9]=e("p",null,"说话 → AI分析 → 语音回复",-1)),e("button",{onClick:y,disabled:!a.value.isSupported||!u.value.available||p.value,class:"comprehensive-button"},i(p.value?"测试进行中...":"开始综合测试"),9,X),c.value.length>0?(d(),v("div",Y,[s[7]||(s[7]=e("h4",null,"测试日志：",-1)),(d(!0),v(C,null,x(c.value,(f,L)=>(d(),v("div",{key:L,class:"log-item"},[e("span",Z,i(A(f.timestamp)),1),e("span",ss,i(f.message),1)]))),128))])):_("",!0)])])]))}},os=T(es,[["__scopeId","data-v-322d779f"]]);export{os as default};
