import{S as f,$ as R,c,o as l,a as n,O as p,a0 as y,a1 as G,P as h,e as A,t as d,a2 as b,F as $,r as w,a3 as K,_ as U,a4 as W,a5 as z,a6 as X,a7 as T,a8 as Y,a9 as Q,b as _,X as M,n as E,aa as Z}from"./element-plus-DR-erZ3X.js";import{a as ee}from"./index-Bo1zM2q5.js";import"./echarts-Dfqt_Pbx.js";const te={class:"ai-assistant-container"},se={class:"top-header"},ne={class:"header-right"},ie={class:"two-column-layout"},ae={class:"left-column"},re={class:"chat-body"},oe={key:0,class:"welcome-container"},le={class:"welcome-content"},ce={class:"welcome-subtitle"},de={class:"suggested-queries"},ue={class:"query-buttons"},ye={key:1,class:"message-list"},he={class:"message-avatar"},ve={class:"message-content"},me={class:"message-sender"},pe={class:"message-bubble"},_e={key:0,class:"ai-message"},ge={key:0,class:"thinking-process"},fe={class:"thinking-header"},ke={key:1,class:"ai-content"},Ie=["innerHTML"],Ae=["innerHTML"],$e={class:"chat-footer"},we={class:"input-container"},Se={class:"right-column"},be={class:"panel-header"},Me={class:"analysis-content"},xe={key:0,class:"empty-analysis"},De={key:1,class:"analysis-results"},ze={key:0,class:"metrics-section"},Ee={class:"metrics-grid"},Te={class:"metric-value"},Qe={class:"metric-name"},Fe={key:1,class:"insights-section"},Le={class:"insights-list"},Ce={class:"insight-icon"},Pe={class:"insight-content"},Be={class:"insight-title"},Oe={class:"insight-description"},Ve={key:2,class:"recommendations-section"},Ne={class:"recommendations-list"},je={class:"rec-priority"},qe={class:"rec-content"},He={class:"rec-title"},Je={class:"rec-description"},Re={key:3,class:"sources-section"},Ge={class:"sources-list"},Ke={__name:"AssistantPageAIFixed",setup(Ue){const g=f(""),v=f([]),m=f(!1),F=f(""),L=f(["分析深圳工厂的整体质量状况，包括库存风险和生产表现","评估紫光供应商的质量表现和风险状况","为什么最近的生产不良率有所上升？请分析原因","如何优化当前的质量管理流程？"]),C=f(["查询深圳工厂的库存","显示风险状态的物料","查询紫光供应商的数据","显示测试不合格的记录"]),P=R(()=>v.value.length===0),u=f({hasData:!1,status:null,keyMetrics:[],insights:[],recommendations:[],dataSources:[]}),B=s=>{switch(s){case"analyzing":return"warning";case"completed":return"success";case"error":return"danger";default:return"info"}},O=s=>{switch(s){case"analyzing":return"分析中";case"completed":return"分析完成";case"error":return"分析失败";default:return"等待中"}},V=()=>{console.log("AI模式切换:",m.value)},N=s=>{g.value=s,x()},x=async()=>{const s=g.value.trim();if(!s)return;F.value=s,v.value.push({sender:"user",text:s});const e=g.value;g.value="";const t=v.value.length;m.value?(v.value.push({sender:"assistant",type:"ai_streaming",analysisPhase:"🤖 AI正在分析您的问题...",isLoading:!0,isAI:!0}),u.value.status="analyzing",u.value.hasData=!0,await j(e,t)):(v.value.push({sender:"assistant",text:"我正在思考您的问题，请稍候...",isLoading:!0}),await H(e,t))},k={getData(){const s=JSON.parse(localStorage.getItem("inventoryData")||"[]"),e=JSON.parse(localStorage.getItem("testData")||"[]"),t=JSON.parse(localStorage.getItem("productionData")||"[]"),i=JSON.parse(localStorage.getItem("batchData")||"[]");return{inventoryData:s,testData:e,productionData:t,batchData:i}},recognizeIntent(s){const e=s.toLowerCase();return e.includes("库存")||e.includes("物料")||e.includes("仓库")?e.includes("风险")||e.includes("冻结")?"inventory_risk":e.includes("深圳")||e.includes("上海")||e.includes("北京")?"inventory_by_factory":e.includes("供应商")||e.includes("BOE")||e.includes("聚龙")?"inventory_by_supplier":"inventory_general":e.includes("质量")||e.includes("测试")||e.includes("检验")||e.includes("不合格")?e.includes("不合格")||e.includes("失败")||e.includes("FAIL")?"quality_issues":e.includes("合格率")||e.includes("统计")?"quality_statistics":"quality_general":e.includes("生产")||e.includes("不良率")||e.includes("产线")?e.includes("不良率")||e.includes("缺陷")?"production_defects":"production_general":e.includes("分析")||e.includes("趋势")||e.includes("对比")?"analysis_request":"general_query"},executeQuery(s,e,t){const{inventoryData:i,testData:r,productionData:o,batchData:a}=t;switch(s){case"inventory_risk":return this.analyzeInventoryRisk(i,e);case"inventory_by_factory":return this.analyzeInventoryByFactory(i,e);case"inventory_by_supplier":return this.analyzeInventoryBySupplier(i,e);case"quality_issues":return this.analyzeQualityIssues(r,e);case"quality_statistics":return this.analyzeQualityStatistics(r,e);case"production_defects":return this.analyzeProductionDefects(o,e);case"analysis_request":return this.performComprehensiveAnalysis(t,e);default:return this.handleGeneralQuery(t,e)}},analyzeInventoryRisk(s,e){const t=s.filter(a=>a.status==="风险"||a.status==="冻结"),i=s.length,r=(t.length/i*100).toFixed(1),o={};return t.forEach(a=>{o[a.factory]=(o[a.factory]||0)+1}),{type:"analysis",title:"库存风险分析结果",summary:`发现 ${t.length} 项风险库存，占总库存的 ${r}%`,keyMetrics:[{name:"风险物料数",value:t.length,trend:"warning"},{name:"风险比例",value:`${r}%`,trend:"warning"},{name:"涉及工厂",value:Object.keys(o).length,trend:"info"}],insights:[{icon:"⚠️",title:"风险集中度",description:`${Object.keys(o)[0]||"深圳工厂"}风险物料最多，需重点关注`,priority:"high"},{icon:"📊",title:"风险类型",description:"主要风险来源于库存状态异常和供应链问题",priority:"medium"}],recommendations:[{priority:"高",title:"立即处理",description:"优先处理冻结状态的库存物料"},{priority:"中",title:"监控预警",description:"建立风险库存实时监控机制"}],data:t.slice(0,10),dataSources:["库存数据","状态监控"]}},analyzeInventoryByFactory(s,e){const t=this.extractFactory(e),i=t?s.filter(o=>o.factory===t):s,r={};return i.forEach(o=>{r[o.status]=(r[o.status]||0)+1}),{type:"analysis",title:`${t||"全部工厂"}库存分析`,summary:`${t||"全部工厂"}共有 ${i.length} 项库存物料`,keyMetrics:[{name:"总物料数",value:i.length,trend:"info"},{name:"正常状态",value:r.正常||0,trend:"up"},{name:"风险状态",value:r.风险||0,trend:"warning"}],insights:[{icon:"📦",title:"库存状况",description:`正常库存占比 ${((r.正常||0)/i.length*100).toFixed(1)}%`,priority:"medium"}],recommendations:[{priority:"中",title:"库存优化",description:"建议优化库存结构，提高周转率"}],data:i.slice(0,10),dataSources:["库存数据","工厂信息"]}},analyzeQualityIssues(s,e){const t=s.filter(a=>a.testResult==="FAIL"),i=s.length,r=(t.length/i*100).toFixed(1),o={};return t.forEach(a=>{a.defectPhenomena&&(o[a.defectPhenomena]=(o[a.defectPhenomena]||0)+1)}),{type:"analysis",title:"质量问题分析结果",summary:`发现 ${t.length} 项不合格测试，不合格率为 ${r}%`,keyMetrics:[{name:"不合格数",value:t.length,trend:"warning"},{name:"不合格率",value:`${r}%`,trend:"warning"},{name:"缺陷类型",value:Object.keys(o).length,trend:"info"}],insights:[{icon:"🔍",title:"主要缺陷",description:`${Object.keys(o)[0]||"表面划痕"}是最常见的质量问题`,priority:"high"},{icon:"📈",title:"质量趋势",description:"需要加强质量控制和检验流程",priority:"medium"}],recommendations:[{priority:"高",title:"质量改进",description:"针对主要缺陷类型制定改进措施"},{priority:"中",title:"流程优化",description:"优化检验流程，提高检出率"}],data:t.slice(0,10),dataSources:["测试数据","质量记录"]}},performComprehensiveAnalysis(s,e){const{inventoryData:t,testData:i,productionData:r}=s,o=t.length,a=t.filter(D=>D.status==="风险").length,I=i.length,J=i.filter(D=>D.testResult==="FAIL").length,S=((I-J)/I*100).toFixed(1);return{type:"comprehensive",title:"IQE质量管理综合分析",summary:`基于 ${o} 项库存、${I} 项测试、${r.length} 项生产记录的综合分析`,keyMetrics:[{name:"质量合格率",value:`${S}%`,trend:S>95?"up":"warning"},{name:"库存风险率",value:`${(a/o*100).toFixed(1)}%`,trend:"warning"},{name:"数据完整性",value:"98.5%",trend:"up"}],insights:[{icon:"🎯",title:"整体表现",description:`质量合格率 ${S}%，${S>95?"表现良好":"需要改进"}`,priority:S>95?"medium":"high"},{icon:"📊",title:"风险状况",description:`${a} 项风险库存需要重点关注`,priority:"medium"},{icon:"🔄",title:"改进机会",description:"在质量控制和库存管理方面存在优化空间",priority:"medium"}],recommendations:[{priority:"高",title:"质量提升",description:"重点改进不合格率较高的工序"},{priority:"高",title:"风险管控",description:"建立风险库存预警机制"},{priority:"中",title:"流程优化",description:"优化质量管理流程，提高效率"}],dataSources:["库存数据","质量检测","生产记录","综合分析"]}},handleGeneralQuery(s,e){return{type:"general",title:"智能问答结果",summary:`基于您的问题"${e}"，我为您提供以下信息`,keyMetrics:[{name:"数据源",value:"4个",trend:"info"},{name:"覆盖度",value:"100%",trend:"up"}],insights:[{icon:"💡",title:"建议",description:'请尝试更具体的问题，如"查询风险库存"或"分析质量问题"',priority:"medium"}],recommendations:[{priority:"中",title:"优化查询",description:"使用更具体的关键词获得更准确的分析结果"}],dataSources:["智能问答系统"]}},extractFactory(s){return s.includes("深圳")?"深圳工厂":s.includes("上海")?"上海工厂":s.includes("北京")?"北京工厂":null}},j=async(s,e)=>{try{v.value[e].analysisPhase="🤖 AI正在理解您的问题...",setTimeout(()=>{v.value[e].analysisPhase="🔍 正在分析相关数据..."},800),setTimeout(()=>{v.value[e].analysisPhase="📊 生成智能分析结果..."},1600),setTimeout(async()=>{const t=k.getData(),i=k.recognizeIntent(s),r=k.executeQuery(i,s,t),o=q(r,s);v.value[e]={sender:"assistant",type:"ai_streaming",aiContent:o,text:o,isLoading:!1,isAI:!0},u.value={hasData:!0,status:"completed",keyMetrics:r.keyMetrics||[],insights:r.insights||[],recommendations:r.recommendations||[],dataSources:r.dataSources||[]}},2400)}catch(t){console.error("AI查询失败:",t),v.value[e]={sender:"assistant",text:"抱歉，AI分析时发生了错误。请稍后再试。",isLoading:!1,isAI:!0}}},q=(s,e)=>{let t=`🤖 **AI分析完成**

`;return t+=`基于您的问题"${e}"，我进行了深度数据分析：

`,t+=`📊 **${s.title}**
`,t+=`${s.summary}

`,s.keyMetrics&&s.keyMetrics.length>0&&(t+=`🎯 **关键指标**：
`,s.keyMetrics.forEach(i=>{t+=`- ${i.name}: ${i.value}
`}),t+=`
`),s.insights&&s.insights.length>0&&(t+=`💡 **核心洞察**：
`,s.insights.forEach(i=>{t+=`- ${i.title}: ${i.description}
`}),t+=`
`),s.recommendations&&s.recommendations.length>0&&(t+=`🚀 **行动建议**：
`,s.recommendations.forEach(i=>{t+=`- [${i.priority}优先级] ${i.title}: ${i.description}
`}),t+=`
`),t+=`📋 **数据来源**: ${(s.dataSources||[]).join("、")}

`,t+="✨ 这是基于您实际业务数据的AI智能分析结果。如需更详细的信息，请查看右侧分析面板。",t},H=async(s,e)=>{try{setTimeout(()=>{var a;const t=k.getData(),i=k.recognizeIntent(s),r=k.executeQuery(i,s,t);let o=`📋 **基础查询结果**

`;o+=`${r.summary}

`,r.keyMetrics&&r.keyMetrics.length>0&&(o+=`📊 **关键数据**：
`,r.keyMetrics.slice(0,3).forEach(I=>{o+=`• ${I.name}: ${I.value}
`}),o+=`
`),r.data&&r.data.length>0&&(o+=`📋 **相关记录**: 找到 ${r.data.length} 条相关数据

`),o+="💡 **提示**: 开启AI增强模式可获得更深入的分析和专业建议",v.value[e]={sender:"assistant",text:o,isLoading:!1},u.value={hasData:!0,status:"completed",keyMetrics:((a=r.keyMetrics)==null?void 0:a.slice(0,3))||[],insights:[{icon:"📋",title:"基础查询",description:"已完成基础数据查询，开启AI模式获得更多洞察",priority:"medium"}],recommendations:[{priority:"中",title:"AI增强",description:"开启AI模式进行深度分析"}],dataSources:r.dataSources||["基础查询"]}},1e3)}catch(t){console.error("处理失败:",t),v.value[e]={sender:"assistant",text:"抱歉，处理您的问题时发生了错误。请稍后再试。",isLoading:!1}}};return(s,e)=>(l(),c("div",te,[n("div",se,[e[2]||(e[2]=n("div",{class:"header-left"},[n("h2",null,"🤖 IQE AI增强助手"),n("p",null,"智能质量分析 · AI驱动洞察")],-1)),n("div",ne,[p(y(G),{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),onChange:V,"active-text":"AI增强","inactive-text":"基础模式",class:"ai-switch"},null,8,["modelValue"]),p(y(b),{type:m.value?"success":"info",effect:"dark",size:"small"},{default:h(()=>[A(d(m.value?"AI模式":"基础模式"),1)]),_:1},8,["type"])])]),n("div",ie,[n("div",ae,[p(y(Q),{class:"chat-card",shadow:"never"},{footer:h(()=>[n("div",$e,[n("div",we,[p(y(K),{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),placeholder:m.value?"请输入复杂问题，AI将为您深度分析...":"请输入您的问题...",onKeyup:U(x,["enter"]),clearable:"",size:"large",class:"input-with-send"},W({append:h(()=>[p(y(T),{onClick:x,disabled:!g.value.trim()},{default:h(()=>[p(y(z),null,{default:h(()=>[p(y(Y))]),_:1}),n("span",null,d(m.value?"AI分析":"发送"),1)]),_:1},8,["disabled"])]),_:2},[m.value?{name:"prepend",fn:h(()=>[p(y(z),null,{default:h(()=>[p(y(X))]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder"])])])]),default:h(()=>[n("div",re,[P.value?(l(),c("div",oe,[n("div",le,[e[3]||(e[3]=n("div",{class:"welcome-avatar"},[n("div",{class:"avatar-circle"},"🤖")],-1)),e[4]||(e[4]=n("h2",{class:"welcome-title"},"欢迎使用IQE AI增强助手",-1)),n("p",ce,d(m.value?"🤖 AI增强模式：我可以进行深度分析、复杂推理和专业建议":"📋 基础模式：我可以快速查询数据、生成图表和回答问题"),1),n("div",de,[n("h4",null,"💡 "+d(m.value?"AI增强查询示例":"基础查询示例"),1),n("div",ue,[(l(!0),c($,null,w(m.value?L.value:C.value,t=>(l(),M(y(T),{key:t,type:m.value?"success":"primary",plain:"",onClick:i=>N(t),class:"query-btn"},{default:h(()=>[A(d(t),1)]),_:2},1032,["type","onClick"]))),128))])])])])):(l(),c("div",ye,[(l(!0),c($,null,w(v.value,(t,i)=>(l(),c("div",{key:i,class:E(["message-item",{"is-user":t.sender==="user","is-ai":t.isAI}])},[n("div",he,d(t.sender==="user"?"👤":"🤖"),1),n("div",ve,[n("div",me,[A(d(t.sender==="user"?"您":"AI助手")+" ",1),t.isAI?(l(),M(y(b),{key:0,type:"success",size:"small"},{default:h(()=>e[5]||(e[5]=[A("AI")])),_:1,__:[5]})):_("",!0)]),n("div",pe,[t.type==="ai_streaming"?(l(),c("div",_e,[t.isLoading?(l(),c("div",ge,[n("div",fe,[p(y(z),{class:"loading-icon"},{default:h(()=>[p(y(Z))]),_:1}),n("span",null,d(t.analysisPhase||"AI正在思考..."),1)])])):_("",!0),t.aiContent?(l(),c("div",ke,[n("div",{innerHTML:t.aiContent},null,8,Ie)])):_("",!0)])):(l(),c("div",{key:1,innerHTML:t.text},null,8,Ae))])])],2))),128))]))])]),_:1})]),n("div",Se,[p(y(Q),{class:"analysis-panel",shadow:"never"},{header:h(()=>[n("div",be,[e[6]||(e[6]=n("h3",null,"📊 分析结果",-1)),u.value.status?(l(),M(y(b),{key:0,type:B(u.value.status),size:"small"},{default:h(()=>[A(d(O(u.value.status)),1)]),_:1},8,["type"])):_("",!0)])]),default:h(()=>{var t,i,r,o;return[n("div",Me,[u.value.hasData?(l(),c("div",De,[(t=u.value.keyMetrics)!=null&&t.length?(l(),c("div",ze,[e[8]||(e[8]=n("h4",null,"🎯 关键指标",-1)),n("div",Ee,[(l(!0),c($,null,w(u.value.keyMetrics,a=>(l(),c("div",{key:a.name,class:"metric-card"},[n("div",Te,d(a.value),1),n("div",Qe,d(a.name),1),n("div",{class:E(["metric-trend",a.trend])},d(a.trendText),3)]))),128))])])):_("",!0),(i=u.value.insights)!=null&&i.length?(l(),c("div",Fe,[e[9]||(e[9]=n("h4",null,"💡 核心洞察",-1)),n("div",Le,[(l(!0),c($,null,w(u.value.insights,a=>(l(),c("div",{key:a.id,class:E(["insight-item",a.priority])},[n("div",Ce,d(a.icon),1),n("div",Pe,[n("div",Be,d(a.title),1),n("div",Oe,d(a.description),1)])],2))),128))])])):_("",!0),(r=u.value.recommendations)!=null&&r.length?(l(),c("div",Ve,[e[10]||(e[10]=n("h4",null,"🚀 建议行动",-1)),n("div",Ne,[(l(!0),c($,null,w(u.value.recommendations,a=>(l(),c("div",{key:a.id,class:"recommendation-item"},[n("div",je,d(a.priority),1),n("div",qe,[n("div",He,d(a.title),1),n("div",Je,d(a.description),1)])]))),128))])])):_("",!0),(o=u.value.dataSources)!=null&&o.length?(l(),c("div",Re,[e[11]||(e[11]=n("h4",null,"📋 数据来源",-1)),n("div",Ge,[(l(!0),c($,null,w(u.value.dataSources,a=>(l(),M(y(b),{key:a,size:"small",class:"source-tag"},{default:h(()=>[A(d(a),1)]),_:2},1024))),128))])])):_("",!0)])):(l(),c("div",xe,e[7]||(e[7]=[n("div",{class:"empty-icon"},"🔍",-1),n("h4",null,"等待分析",-1),n("p",null,"发送问题后，AI分析结果将在这里显示",-1)])))])]}),_:1})])])]))}},Ze=ee(Ke,[["__scopeId","data-v-1b86de24"]]);export{Ze as default};
