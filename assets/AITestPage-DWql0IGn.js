import{S as i,T as x,c as h,o as y,a as t,O as r,P as d,e as p,t as l,a0 as u,a7 as $,a9 as S,F as C,r as b,a3 as V,_ as M,V as m,n as L}from"./element-plus-DR-erZ3X.js";import{a as _}from"./aiService-CKXedvtd.js";import{a as B}from"./index-Bo1zM2q5.js";import"./echarts-Dfqt_Pbx.js";const N={class:"ai-test-page"},O={class:"status-section"},U={class:"test-buttons"},j={class:"chat-section"},K={class:"chat-messages"},z={class:"message-header"},F={class:"timestamp"},J={class:"message-content"},R={class:"chat-input"},H={class:"log-section"},q={class:"log-container"},G={class:"log-time"},Q={class:"log-level"},W={class:"log-message"},X={__name:"AITestPage",setup(Y){const w=i("未知"),c=i("未测试"),T=i("从未"),v=i(!1),I=i(!1),g=i(""),A=i([]),f=i([]),a=(o,e)=>{const s=new Date;f.value.push({time:s.toLocaleTimeString(),level:o,message:e}),f.value.length>100&&(f.value=f.value.slice(-50)),console.log(`[${o.toUpperCase()}] ${e}`)},P=async()=>{v.value=!0,a("info","开始测试AI服务...");try{if(a("info",`AI服务实例: ${!!_}`),!_)throw new Error("AI服务未加载");a("info","调用testConnection方法..."),await _.testConnection()?(w.value="正常",c.value="连接成功",a("success","AI服务连接测试成功"),m.success("✅ AI服务连接成功!")):(w.value="异常",c.value="连接失败",a("error","AI服务连接测试失败"),m.error("❌ AI服务连接失败"))}catch(o){w.value="错误",c.value="测试异常",a("error",`AI服务测试异常: ${o.message}`),m.error(`测试失败: ${o.message}`)}finally{v.value=!1,T.value=new Date().toLocaleTimeString()}},D=async()=>{v.value=!0,a("info","开始直接测试DeepSeek API...");try{const o="sk-cab797574abf4288bcfaca253191565d",e="https://api.deepseek.com/chat/completions";a("info",`API地址: ${e}`),a("info",`API密钥长度: ${o.length}`);const s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({model:"deepseek-chat",messages:[{role:"user",content:"Hello, this is a test message."}],max_tokens:50})});if(a("info",`响应状态: ${s.status} ${s.statusText}`),s.ok){const n=await s.json();a("success","直接API测试成功"),a("info",`响应内容: ${n.choices[0].message.content}`),m.success("✅ 直接API测试成功!"),c.value="直接连接成功"}else{const n=await s.json().catch(()=>({}));a("error",`API错误: ${JSON.stringify(n)}`),m.error("❌ 直接API测试失败"),c.value="直接连接失败"}}catch(o){a("error",`直接API测试异常: ${o.message}`),m.error(`直接测试失败: ${o.message}`),c.value="直接测试异常"}finally{v.value=!1,T.value=new Date().toLocaleTimeString()}},k=async()=>{if(!g.value.trim()||I.value)return;const o=g.value.trim();g.value="",A.value.push({type:"user",content:o,timestamp:new Date().toLocaleTimeString()}),I.value=!0,a("info",`发送消息: ${o}`);try{if(!_)throw new Error("AI服务未加载");const e=[{role:"user",content:o}];a("info","调用AI服务chat方法...");const s=await _.chat(e);if(s&&s.choices&&s.choices[0]){const n=s.choices[0].message.content;A.value.push({type:"ai",content:n,timestamp:new Date().toLocaleTimeString()}),a("success",`AI回复: ${n.substring(0,50)}...`)}else throw new Error("AI响应格式异常")}catch(e){a("error",`发送消息失败: ${e.message}`),A.value.push({type:"ai",content:`❌ 错误: ${e.message}`,timestamp:new Date().toLocaleTimeString()}),m.error(`发送失败: ${e.message}`)}finally{I.value=!1}},E=()=>{f.value=[],A.value=[],a("info","日志已清空")};return x(()=>{a("info","AI测试页面已加载"),a("info",`AI服务状态: ${!!_}`),setTimeout(()=>{P()},1e3)}),(o,e)=>(y(),h("div",N,[e[11]||(e[11]=t("h1",null,"🤖 AI功能测试页面",-1)),t("div",O,[r(u(S),null,{default:d(()=>[e[7]||(e[7]=t("h3",null,"📊 AI服务状态",-1)),t("p",null,[e[1]||(e[1]=t("strong",null,"服务状态:",-1)),p(" "+l(w.value),1)]),t("p",null,[e[2]||(e[2]=t("strong",null,"API连接:",-1)),p(" "+l(c.value),1)]),t("p",null,[e[3]||(e[3]=t("strong",null,"最后测试:",-1)),p(" "+l(T.value),1)]),t("div",U,[r(u($),{onClick:P,type:"primary",loading:v.value},{default:d(()=>e[4]||(e[4]=[p(" 🔗 测试AI连接 ")])),_:1,__:[4]},8,["loading"]),r(u($),{onClick:D,type:"success",loading:v.value},{default:d(()=>e[5]||(e[5]=[p(" 🧪 直接测试API ")])),_:1,__:[5]},8,["loading"]),r(u($),{onClick:E,type:"warning"},{default:d(()=>e[6]||(e[6]=[p(" 🗑️ 清空日志 ")])),_:1,__:[6]})])]),_:1,__:[7]})]),t("div",j,[r(u(S),null,{default:d(()=>[e[9]||(e[9]=t("h3",null,"💬 AI对话测试",-1)),t("div",K,[(y(!0),h(C,null,b(A.value,(s,n)=>(y(),h("div",{key:n,class:L(["chat-message",s.type])},[t("div",z,[t("strong",null,l(s.type==="user"?"👤 用户":"🤖 AI"),1),t("span",F,l(s.timestamp),1)]),t("div",J,l(s.content),1)],2))),128))]),t("div",R,[r(u(V),{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=s=>g.value=s),placeholder:"输入测试消息...",onKeyup:M(k,["enter"]),disabled:I.value},null,8,["modelValue","disabled"]),r(u($),{onClick:k,type:"primary",loading:I.value,disabled:!g.value.trim()},{default:d(()=>e[8]||(e[8]=[p(" 发送 ")])),_:1,__:[8]},8,["loading","disabled"])])]),_:1,__:[9]})]),t("div",H,[r(u(S),null,{default:d(()=>[e[10]||(e[10]=t("h3",null,"📋 调试日志",-1)),t("div",q,[(y(!0),h(C,null,b(f.value,(s,n)=>(y(),h("div",{key:n,class:L(["log-item",s.level])},[t("span",G,l(s.time),1),t("span",Q,l(s.level.toUpperCase()),1),t("span",W,l(s.message),1)],2))),128))])]),_:1,__:[10]})])]))}},ae=B(X,[["__scopeId","data-v-4207466a"]]);export{ae as default};
