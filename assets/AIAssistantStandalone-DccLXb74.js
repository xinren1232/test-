import{S as d,aj as X,T as Y,c as a,o as n,a as e,O as g,Q as S,P as D,e as x,F as k,r as I,b as $,_ as Z,ai as ee,t as i,n as E,X as te,V as P,W as se}from"./element-plus-DR-erZ3X.js";import{a as oe,ax as ne}from"./index-Bo1zM2q5.js";import"./echarts-Dfqt_Pbx.js";const ae={class:"standalone-ai-container"},ie={class:"top-header"},le={class:"header-controls"},ce={class:"three-column-layout"},re={class:"left-column"},ue={class:"tools-section"},de=["onClick"],pe={class:"tool-icon"},me={class:"tool-details"},ve={class:"tool-name"},_e={class:"tool-desc"},he={class:"middle-column"},ye={class:"column-header"},ge={class:"quick-examples"},ke={class:"message-avatar"},Ie={key:0},fe={key:1},Ae={class:"message-body"},we={class:"message-text"},Ce={class:"message-timestamp"},Se={key:0,class:"chat-message ai loading-message"},De={class:"input-area"},xe={class:"input-controls"},$e={class:"right-column"},be={class:"thinking-area"},Te={key:0,class:"empty-thinking"},Ee={class:"step-header"},Pe={class:"step-icon"},Ve={class:"step-title"},Qe={class:"step-status"},Me={key:0,class:"step-result"},Ne={class:"result-content"},Oe={__name:"AIAssistantStandalone",setup(Be){const M=ne(),u=d(""),y=d([{type:"ai",content:"您好！我是IQE AI智能助手。我已接入DeepSeek大语言模型，可以为您提供专业的质量管理问答服务。",timestamp:new Date}]),p=d(!1),f=d(!0),l=d([]),A=d(null),w=d(""),V=d("info"),C={apiKey:"sk-cab797574abf4288bcfaca253191565d",baseURL:"https://api.deepseek.com",endpoint:"/chat/completions",model:"deepseek-chat"},N=d(["查询工厂A的库存情况","分析最近的质量趋势","生成质量报告","统计不合格品数量","查看生产线状态","检测异常物料批次"]),O=X([{name:"数据分析工具",icon:"📊",tools:[{name:"数据分析",icon:"📊",description:"分析质量管理数据"},{name:"统计分析",icon:"📈",description:"执行统计分析"},{name:"数值计算",icon:"🔢",description:"执行数值计算分析"},{name:"数据验证",icon:"✅",description:"验证数据完整性"}]},{name:"可视化工具",icon:"📈",tools:[{name:"图表生成",icon:"📊",description:"生成数据可视化图表"},{name:"趋势分析",icon:"📈",description:"分析数据趋势变化"},{name:"报表生成",icon:"📄",description:"生成质量分析报表"}]},{name:"联网工具",icon:"🌐",tools:[{name:"网络搜索",icon:"🔍",description:"搜索相关信息"},{name:"API调用",icon:"🔗",description:"调用外部API接口"}]},{name:"质量管理",icon:"🎯",tools:[{name:"生产管理",icon:"🏭",description:"管理生产流程数据"}]}]),B=t=>t?new Date(t).toLocaleTimeString():"",K=t=>({thinking:"🤔",analysis:"🔍",data_query:"📊",ai_call:"🤖",response:"💬"})[t]||"⚙️",L=t=>({processing:"处理中...",completed:"完成",error:"错误"})[t]||t,_=(t,s="info")=>{w.value=t,V.value=s,setTimeout(()=>{w.value=""},3e3)},Q=()=>{se(()=>{A.value&&(A.value.scrollTop=A.value.scrollHeight)})},U=()=>{M.push("/")},j=t=>{const s=`请使用${t.name}工具帮我${t.description}`;u.value=s,P.success(`已选择工具：${t.name}`)},z=t=>{u.value=t,b()},J=()=>{const t=f.value?"AI增强模式":"基础模式";P.info(`已切换到${t}`),_(`已切换到${t}`,"success")},R=()=>{y.value=[{type:"ai",content:"对话已清空。您好！我是IQE AI智能助手，已接入DeepSeek大语言模型。",timestamp:new Date}],l.value=[],P.success("对话已清空")},b=async()=>{if(!u.value.trim()||p.value)return;const t={type:"user",content:u.value,timestamp:new Date};y.value.push(t);const s=u.value;u.value="",Q();try{await q(s)}catch(c){console.error("AI处理错误:",c),y.value.push({type:"ai",content:"抱歉，处理您的问题时出现了错误。请稍后重试。",timestamp:new Date}),_("处理失败，请稍后重试","error")}Q()},q=async t=>{p.value=!0,l.value=[];try{l.value.push({type:"thinking",title:"理解问题",status:"processing"}),await T(500),l.value[0].status="completed",l.value.push({type:"data_query",title:"获取业务数据",status:"processing"});const s=await W();await T(400),l.value[1].status="completed",l.value.push({type:"ai_call",title:"调用AI大模型",status:"processing"});let c;if(f.value)try{c=await F(t,s),_("AI响应成功","success")}catch(m){console.error("AI调用失败:",m),c=`抱歉，AI服务暂时不可用。基于您的问题"${t}"，我为您提供基础分析...`,_("AI服务不可用，已切换到基础模式","error")}else c=`基础模式回复：我收到了您的问题"${t}"。这是一个关于质量管理的问题，我正在为您分析相关数据...`;l.value[2].status="completed",l.value.push({type:"response",title:"生成回答",status:"processing"}),await T(200),l.value[3].status="completed",y.value.push({type:"ai",content:c,timestamp:new Date})}catch(s){throw console.error("处理AI响应时出错:",s),_("处理失败","error"),s}finally{p.value=!1}},F=async(t,s)=>{var o;const c=G(s),m=H(t),v=await fetch(`${C.baseURL}${C.endpoint}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C.apiKey}`},body:JSON.stringify({model:C.model,messages:[{role:"system",content:c},{role:"user",content:m}],temperature:.7,max_tokens:2e3,stream:!1})});if(!v.ok){const r=await v.json().catch(()=>({}));throw new Error(`DeepSeek API错误 ${v.status}: ${((o=r.error)==null?void 0:o.message)||v.statusText}`)}const h=await v.json();if(!h.choices||!h.choices[0]||!h.choices[0].message)throw new Error("DeepSeek API响应格式异常");return h.choices[0].message.content},G=t=>`你是IQE质量管理系统的AI智能助手，专门负责质量管理数据分析和问答。

系统能力：
1. 物料库存管理分析
2. 生产线质量跟踪
3. 检测结果分析
4. 质量趋势预测
5. 异常问题诊断

当前业务数据概况：
- 库存记录：${t.inventoryCount||0}条
- 生产记录：${t.productionCount||0}条
- 检测记录：${t.testCount||0}条
- 工厂数量：${t.factoryCount||0}个

请基于用户问题提供专业、准确、有用的回答。回答要简洁明了，重点突出。`,H=(t,s)=>`用户问题：${t}

请基于IQE质量管理系统的业务场景，为用户提供专业的回答。如果问题涉及具体数据查询，请说明查询方法和关键指标。`,W=async()=>{try{const t=JSON.parse(localStorage.getItem("inventoryData")||"[]"),s=JSON.parse(localStorage.getItem("productionData")||"[]"),c=JSON.parse(localStorage.getItem("testData")||"[]");return{inventoryCount:t.length,productionCount:s.length,testCount:c.length,factoryCount:3,timestamp:new Date().toISOString()}}catch(t){return console.error("获取业务数据失败:",t),{inventoryCount:132,productionCount:1056,testCount:396,factoryCount:3,timestamp:new Date().toISOString()}}},T=t=>new Promise(s=>setTimeout(s,t));return Y(()=>{console.log("🤖 IQE AI智能助手已加载"),_("AI智能助手已就绪，DeepSeek模型已连接","success")}),(t,s)=>{const c=S("el-switch"),m=S("el-button"),v=S("el-tag"),h=S("el-input");return n(),a("div",ae,[e("div",ie,[s[4]||(s[4]=e("h1",null,"🤖 IQE AI 智能助手",-1)),e("div",le,[g(c,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=o=>f.value=o),onChange:J,"active-text":"AI增强模式","inactive-text":"基础模式",size:"large"},null,8,["modelValue"]),g(m,{onClick:R,type:"primary",plain:""},{default:D(()=>s[2]||(s[2]=[x("清空对话")])),_:1,__:[2]}),g(m,{onClick:U,type:"info",plain:""},{default:D(()=>s[3]||(s[3]=[x("返回系统")])),_:1,__:[3]})])]),e("div",ce,[e("div",re,[s[5]||(s[5]=e("div",{class:"column-header"},[e("h3",null,"🛠️ 可用工具")],-1)),e("div",ue,[(n(!0),a(k,null,I(O,o=>(n(),a("div",{class:"tool-category",key:o.name},[e("h4",null,i(o.icon)+" "+i(o.name),1),(n(!0),a(k,null,I(o.tools,r=>(n(),a("div",{class:"tool-item",key:r.name,onClick:Ke=>j(r)},[e("span",pe,i(r.icon),1),e("div",me,[e("div",ve,i(r.name),1),e("div",_e,i(r.description),1)])],8,de))),128))]))),128))])]),e("div",he,[e("div",ye,[s[6]||(s[6]=e("h3",null,"💬 智能问答",-1)),e("div",ge,[(n(!0),a(k,null,I(N.value,o=>(n(),te(v,{key:o,onClick:r=>z(o),class:"example-tag",type:"info",effect:"plain"},{default:D(()=>[x(i(o),1)]),_:2},1032,["onClick"]))),128))])]),e("div",{class:"messages-area",ref_key:"messagesArea",ref:A},[(n(!0),a(k,null,I(y.value,(o,r)=>(n(),a("div",{key:r,class:E(["chat-message",o.type])},[e("div",ke,[o.type==="user"?(n(),a("span",Ie,"👤")):(n(),a("span",fe,"🤖"))]),e("div",Ae,[e("div",we,i(o.content),1),e("div",Ce,i(B(o.timestamp)),1)])],2))),128)),p.value?(n(),a("div",Se,s[7]||(s[7]=[e("div",{class:"message-avatar"},"🤖",-1),e("div",{class:"message-body"},[e("div",{class:"typing-animation"},[e("span"),e("span"),e("span")]),e("div",{class:"loading-text"},"AI正在思考中...")],-1)]))):$("",!0)],512),e("div",De,[g(h,{modelValue:u.value,"onUpdate:modelValue":s[1]||(s[1]=o=>u.value=o),type:"textarea",rows:3,placeholder:"请输入您的问题...",onKeydown:Z(ee(b,["ctrl"]),["enter"]),disabled:p.value,resize:"none"},null,8,["modelValue","onKeydown","disabled"]),e("div",xe,[g(m,{onClick:b,type:"primary",loading:p.value,disabled:!u.value.trim()},{default:D(()=>[x(i(p.value?"发送中...":"发送 (Ctrl+Enter)"),1)]),_:1},8,["loading","disabled"])]),w.value?(n(),a("div",{key:0,class:E(["status-message",V.value])},i(w.value),3)):$("",!0)])]),e("div",$e,[s[9]||(s[9]=e("div",{class:"column-header"},[e("h3",null,"🧠 AI思考过程")],-1)),e("div",be,[l.value.length===0?(n(),a("div",Te,s[8]||(s[8]=[e("div",{class:"empty-icon"},"🤔",-1),e("div",{class:"empty-text"},"AI正在等待您的问题...",-1)]))):$("",!0),(n(!0),a(k,null,I(l.value,(o,r)=>(n(),a("div",{key:r,class:E(["thinking-step",o.status])},[e("div",Ee,[e("span",Pe,i(K(o.type)),1),e("span",Ve,i(o.title),1),e("span",Qe,i(L(o.status)),1)]),o.result?(n(),a("div",Me,[e("div",Ne,i(o.result),1)])):$("",!0)],2))),128))])])])])}}},ze=oe(Oe,[["__scopeId","data-v-913ef58e"]]);export{ze as default};
