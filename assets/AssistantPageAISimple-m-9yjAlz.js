import{S as w,aE as ue,T as ve,W as re,U as ye,Q as ne,c as u,o as c,a as t,O as l,t as p,P as r,F as L,r as V,e as k,$ as le,a0 as i,a7 as z,n as Z,a5 as te,ai as ce,ak as he,a2 as W,aF as me,b as I,ad as fe,ae as F,aG as ge,aH as X,aI as _e,aJ as J,a3 as ee,M as be,az as ke,a1 as xe,_ as we,a4 as $e,a6 as Ce,a8 as De,a9 as Se,aK as ae,X as Y,aL as Ie}from"./element-plus-DR-erZ3X.js";import{a as se}from"./index-Bo1zM2q5.js";import{i as Ae,L as de}from"./echarts-Dfqt_Pbx.js";const Te={class:"analysis-chart"},Ee={class:"chart-header"},Le={__name:"AnalysisChart",props:{title:{type:String,default:"数据分析"},data:{type:Object,default:()=>({})},type:{type:String,default:"bar"}},setup($){const x=$,d=w(null),g=w(null),f=w(x.type),_=[{label:"柱状图",value:"bar"},{label:"折线图",value:"line"},{label:"饼图",value:"pie"},{label:"雷达图",value:"radar"}],S=()=>{d.value&&!g.value&&(g.value=Ae(d.value),C())},C=()=>{if(!g.value||!x.data)return;let D={};switch(f.value){case"bar":D=A();break;case"line":D=O();break;case"pie":D=m();break;case"radar":D=M();break}g.value.setOption(D,!0)},A=()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:x.data.categories||["工厂A","工厂B","工厂C"],axisLabel:{fontSize:10}},yAxis:{type:"value",axisLabel:{fontSize:10}},series:[{name:"质量指标",type:"bar",data:x.data.values||[95.2,92.8,97.1],itemStyle:{color:new de(0,0,0,1,[{offset:0,color:"#409eff"},{offset:1,color:"#67c23a"}])}}]}),O=()=>({tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:x.data.timeline||["1月","2月","3月","4月","5月","6月"],axisLabel:{fontSize:10}},yAxis:{type:"value",axisLabel:{fontSize:10}},series:[{name:"趋势",type:"line",data:x.data.trend||[92,94,91,95,93,96],smooth:!0,lineStyle:{color:"#409eff"},areaStyle:{color:new de(0,0,0,1,[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}])}}]}),m=()=>({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",textStyle:{fontSize:10}},series:[{name:"分布",type:"pie",radius:["40%","70%"],center:["60%","50%"],data:x.data.distribution||[{value:35,name:"正常"},{value:25,name:"风险"},{value:15,name:"冻结"},{value:25,name:"其他"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),M=()=>({tooltip:{},radar:{indicator:x.data.indicators||[{name:"质量",max:100},{name:"效率",max:100},{name:"成本",max:100},{name:"交期",max:100},{name:"服务",max:100}],radius:"60%"},series:[{name:"评估",type:"radar",data:[{value:x.data.radarValues||[95,88,92,85,90],name:"综合评分"}],areaStyle:{color:"rgba(64, 158, 255, 0.3)"}}]}),Q=D=>{f.value=D,C()};ue(()=>x.data,()=>{re(()=>{C()})},{deep:!0});const R=()=>{g.value&&g.value.resize()};return ve(()=>{re(()=>{S(),window.addEventListener("resize",R)})}),ye(()=>{g.value&&(g.value.dispose(),g.value=null),window.removeEventListener("resize",R)}),(D,B)=>{const j=ne("el-button"),P=ne("el-button-group");return c(),u("div",Te,[t("div",Ee,[t("h5",null,p($.title),1),l(P,{size:"small",class:"chart-controls"},{default:r(()=>[(c(),u(L,null,V(_,T=>l(j,{key:T.value,type:f.value===T.value?"primary":"",size:"small",onClick:U=>Q(T.value)},{default:r(()=>[k(p(T.label),1)]),_:2},1032,["type","onClick"])),64))]),_:1})]),t("div",{ref_key:"chartContainer",ref:d,class:"chart-container"},null,512)])}}},Ve=se(Le,[["__scopeId","data-v-e44693e7"]]),Oe={class:"analysis-history"},ze={class:"history-header"},Me={class:"history-controls"},je={class:"history-content"},Pe={key:0,class:"empty-history"},Ue={key:1,class:"history-list"},He=["onClick"],qe={class:"history-item-header"},Qe={class:"history-time"},Re={class:"history-actions"},Ne={class:"history-query"},Be={class:"history-summary"},Je={class:"summary-text"},Fe={class:"compare-content"},We={class:"compare-section"},Ge={class:"compare-text"},Ke={class:"compare-section"},Xe={class:"compare-text"},Ye={__name:"AnalysisHistory",props:{currentAnalysis:{type:Object,default:()=>({})}},emits:["select-history","export-history"],setup($,{expose:x,emit:d}){const g=$,f=d,_=w([]),S=w(null),C=w(!1),A=w(null),O=le(()=>{var v;return((v=g.currentAnalysis)==null?void 0:v.text)||"暂无当前分析"}),m=v=>{const y={id:Date.now(),timestamp:new Date,query:v.query,reply:v.reply,source:v.source,summary:M(v.reply),metrics:v.metrics||[],insights:v.insights||[],recommendations:v.recommendations||[]};_.value.unshift(y),_.value.length>20&&(_.value=_.value.slice(0,20)),T()},M=v=>{if(!v)return"无摘要";const y=v.split("。").filter(n=>n.trim().length>0);return y.length>0?y[0].substring(0,50)+"...":v.substring(0,50)+"..."},Q=v=>{if(!v)return"";const y=new Date(v),e=new Date-y;return e<6e4?"刚刚":e<36e5?`${Math.floor(e/6e4)}分钟前`:e<864e5?`${Math.floor(e/36e5)}小时前`:y.toLocaleDateString()+" "+y.toLocaleTimeString().substring(0,5)},R=v=>{S.value=v,f("select-history",v)},N=v=>{_.value.splice(v,1),T()},D=()=>{_.value=[],S.value=null,T()},B=v=>{A.value=v,C.value=!0},j=()=>{C.value=!1,A.value=null},P=()=>{const v={exportTime:new Date().toISOString(),totalCount:_.value.length,analyses:_.value.map(h=>({timestamp:h.timestamp,query:h.query,reply:h.reply,source:h.source,summary:h.summary}))},y=new Blob([JSON.stringify(v,null,2)],{type:"application/json"}),n=URL.createObjectURL(y),e=document.createElement("a");e.href=n,e.download=`IQE分析历史_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(n),f("export-history",v)},T=()=>{try{localStorage.setItem("iqe_analysis_history",JSON.stringify(_.value))}catch(v){console.warn("保存历史记录失败:",v)}},U=()=>{try{const v=localStorage.getItem("iqe_analysis_history");if(v){const y=JSON.parse(v);_.value=y.map(n=>({...n,timestamp:new Date(n.timestamp)}))}}catch(v){console.warn("加载历史记录失败:",v)}};return x({addHistoryItem:m,clearHistory:D,exportHistory:P}),ve(()=>{U()}),(v,y)=>{const n=ne("Compare");return c(),u("div",Oe,[t("div",ze,[y[3]||(y[3]=t("h4",null,"📚 分析历史",-1)),t("div",Me,[l(i(z),{size:"small",onClick:D,disabled:_.value.length===0},{default:r(()=>y[1]||(y[1]=[k(" 清空 ")])),_:1,__:[1]},8,["disabled"]),l(i(z),{size:"small",type:"primary",onClick:P,disabled:_.value.length===0},{default:r(()=>y[2]||(y[2]=[k(" 导出 ")])),_:1,__:[2]},8,["disabled"])])]),t("div",je,[_.value.length===0?(c(),u("div",Pe,y[4]||(y[4]=[t("div",{class:"empty-icon"},"📝",-1),t("p",null,"暂无分析历史",-1)]))):(c(),u("div",Ue,[(c(!0),u(L,null,V(_.value,(e,h)=>{var o;return c(),u("div",{key:e.id,class:Z(["history-item",{active:((o=S.value)==null?void 0:o.id)===e.id}]),onClick:s=>R(e)},[t("div",qe,[t("div",Qe,p(Q(e.timestamp)),1),t("div",Re,[l(i(z),{size:"small",text:"",onClick:ce(s=>B(e),["stop"])},{default:r(()=>[l(i(te),null,{default:r(()=>[l(n)]),_:1})]),_:2},1032,["onClick"]),l(i(z),{size:"small",text:"",onClick:ce(s=>N(h),["stop"])},{default:r(()=>[l(i(te),null,{default:r(()=>[l(i(he))]),_:1})]),_:2},1032,["onClick"])])]),t("div",Ne,p(e.query),1),t("div",Be,[l(i(W),{size:"small",type:"info"},{default:r(()=>[k(p(e.source),1)]),_:2},1024),t("span",Je,p(e.summary),1)])],10,He)}),128))]))]),l(i(me),{modelValue:C.value,"onUpdate:modelValue":y[0]||(y[0]=e=>C.value=e),title:"分析对比",width:"80%","before-close":j},{default:r(()=>{var e,h;return[t("div",Fe,[t("div",We,[t("h5",null,"历史分析 ("+p(Q((e=A.value)==null?void 0:e.timestamp))+")",1),t("div",Ge,p((h=A.value)==null?void 0:h.reply),1)]),y[6]||(y[6]=t("div",{class:"compare-divider"},null,-1)),t("div",Ke,[y[5]||(y[5]=t("h5",null,"当前分析",-1)),t("div",Xe,p(O.value),1)])])]}),_:1},8,["modelValue"])])}}},Ze=se(Ye,[["__scopeId","data-v-f90875c5"]]),et={class:"export-panel"},tt={class:"export-header"},st={class:"export-options"},at={class:"dialog-footer"},nt={key:0,class:"export-preview"},lt={class:"preview-header"},ot={class:"preview-content"},it={class:"preview-section"},rt={key:0,class:"preview-section"},ct={class:"metrics-preview"},dt={key:1,class:"preview-section"},ut={class:"insights-preview"},vt={key:2,class:"preview-section"},mt={class:"recommendations-preview"},pt={__name:"ExportPanel",props:{analysisData:{type:Object,default:()=>({})},currentQuery:{type:String,default:""}},emits:["export-complete"],setup($,{emit:x}){const d=$,g=x,f=w({format:"pdf",includes:["summary","metrics","insights","recommendations"],title:"",analyst:"",notes:""}),_=w(!1),S=w(!1),C=w(!1),A=le(()=>d.analysisData&&Object.keys(d.analysisData).length>0),O=()=>{var e,h,o;if(!d.analysisData)return"暂无分析数据";const n=[];return d.currentQuery&&n.push(`针对"${d.currentQuery}"的分析`),(e=d.analysisData.keyMetrics)!=null&&e.length&&n.push(`包含${d.analysisData.keyMetrics.length}项关键指标`),(h=d.analysisData.insights)!=null&&h.length&&n.push(`${d.analysisData.insights.length}个核心洞察`),(o=d.analysisData.recommendations)!=null&&o.length&&n.push(`${d.analysisData.recommendations.length}条建议行动`),n.join("，")||"综合质量分析报告"},m=()=>{S.value=!S.value},M=()=>{_.value=!1,C.value=!1},Q=async()=>{C.value=!0;try{const n=R();switch(f.value.format){case"pdf":await N(n);break;case"word":await D(n);break;case"excel":await B(n);break;case"json":await j(n);break}g("export-complete",{format:f.value.format,data:n}),M()}catch(n){console.error("导出失败:",n)}finally{C.value=!1}},R=()=>{const n={meta:{title:f.value.title||O(),analyst:f.value.analyst||"IQE AI助手",exportTime:new Date().toISOString(),query:d.currentQuery,notes:f.value.notes},content:{}},e=f.value.includes;return e.includes("summary")&&(n.content.summary=O()),e.includes("metrics")&&d.analysisData.keyMetrics&&(n.content.metrics=d.analysisData.keyMetrics),e.includes("insights")&&d.analysisData.insights&&(n.content.insights=d.analysisData.insights),e.includes("recommendations")&&d.analysisData.recommendations&&(n.content.recommendations=d.analysisData.recommendations),e.includes("charts")&&d.analysisData.chartData&&(n.content.charts=d.analysisData.chartData),n},N=async n=>{const e=P(n),h=new Blob([e],{type:"text/html"});U(h,`IQE分析报告_${v()}.html`)},D=async n=>{const e=P(n),h=new Blob([e],{type:"application/msword"});U(h,`IQE分析报告_${v()}.doc`)},B=async n=>{const e=T(n),h=new Blob([e],{type:"text/csv;charset=utf-8;"});U(h,`IQE分析报告_${v()}.csv`)},j=async n=>{const e=JSON.stringify(n,null,2),h=new Blob([e],{type:"application/json"});U(h,`IQE分析报告_${v()}.json`)},P=n=>`
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${n.meta.title}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        .header { border-bottom: 2px solid #409eff; padding-bottom: 20px; margin-bottom: 30px; }
        .title { color: #2c3e50; font-size: 24px; margin: 0; }
        .meta { color: #606266; font-size: 14px; margin-top: 10px; }
        .section { margin-bottom: 30px; }
        .section-title { color: #409eff; font-size: 18px; margin-bottom: 15px; border-left: 4px solid #409eff; padding-left: 10px; }
        .metric-item { background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 4px; }
        .insight-item { margin: 10px 0; padding: 10px; border-left: 3px solid #67c23a; background: #f0f9ff; }
        .recommendation-item { margin: 10px 0; padding: 10px; border-left: 3px solid #e6a23c; background: #fdf6ec; }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">${n.meta.title}</h1>
        <div class="meta">
            <p>分析师: ${n.meta.analyst} | 导出时间: ${new Date(n.meta.exportTime).toLocaleString()}</p>
            <p>查询: ${n.meta.query}</p>
        </div>
    </div>
    
    ${n.content.summary?`
    <div class="section">
        <h2 class="section-title">分析摘要</h2>
        <p>${n.content.summary}</p>
    </div>
    `:""}
    
    ${n.content.metrics?`
    <div class="section">
        <h2 class="section-title">关键指标</h2>
        ${n.content.metrics.map(e=>`
            <div class="metric-item">
                <strong>${e.name}:</strong> ${e.value} <span style="color: #67c23a;">${e.trendText||""}</span>
            </div>
        `).join("")}
    </div>
    `:""}
    
    ${n.content.insights?`
    <div class="section">
        <h2 class="section-title">核心洞察</h2>
        ${n.content.insights.map(e=>`
            <div class="insight-item">
                <strong>${e.title}</strong><br>
                ${e.description}
            </div>
        `).join("")}
    </div>
    `:""}
    
    ${n.content.recommendations?`
    <div class="section">
        <h2 class="section-title">建议行动</h2>
        ${n.content.recommendations.map(e=>`
            <div class="recommendation-item">
                <strong>[${e.priority}] ${e.title}</strong><br>
                ${e.description}
            </div>
        `).join("")}
    </div>
    `:""}
    
    ${n.meta.notes?`
    <div class="section">
        <h2 class="section-title">备注</h2>
        <p>${n.meta.notes}</p>
    </div>
    `:""}
</body>
</html>
  `,T=n=>{let e=`IQE分析报告
`;return e+=`标题,${n.meta.title}
`,e+=`分析师,${n.meta.analyst}
`,e+=`导出时间,${new Date(n.meta.exportTime).toLocaleString()}
`,e+=`查询,${n.meta.query}

`,n.content.metrics&&(e+=`关键指标
`,e+=`指标名称,数值,趋势
`,n.content.metrics.forEach(h=>{e+=`${h.name},${h.value},${h.trendText||""}
`}),e+=`
`),e},U=(n,e,h)=>{const o=URL.createObjectURL(n),s=document.createElement("a");s.href=o,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)},v=()=>new Date().toISOString().split("T")[0].replace(/-/g,""),y=()=>{f.value.title=O()};return ue(()=>d.analysisData,()=>{A.value&&y()},{immediate:!0}),(n,e)=>{var h,o,s;return c(),u("div",et,[t("div",tt,[e[8]||(e[8]=t("h4",null,"📄 导出报告",-1)),l(i(z),{size:"small",type:"primary",onClick:e[0]||(e[0]=a=>_.value=!0),disabled:!A.value},{default:r(()=>e[7]||(e[7]=[k(" 导出 ")])),_:1,__:[7]},8,["disabled"])]),l(i(me),{modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=a=>_.value=a),title:"导出分析报告",width:"500px","before-close":M},{footer:r(()=>[t("div",at,[l(i(z),{onClick:M},{default:r(()=>e[19]||(e[19]=[k("取消")])),_:1,__:[19]}),l(i(z),{type:"primary",onClick:Q,loading:C.value},{default:r(()=>[k(p(C.value?"导出中...":"确认导出"),1)]),_:1},8,["loading"])])]),default:r(()=>[t("div",st,[l(i(fe),{model:f.value,"label-width":"100px"},{default:r(()=>[l(i(F),{label:"导出格式"},{default:r(()=>[l(i(ge),{modelValue:f.value.format,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value.format=a)},{default:r(()=>[l(i(X),{value:"pdf"},{default:r(()=>e[9]||(e[9]=[k("PDF报告")])),_:1,__:[9]}),l(i(X),{value:"word"},{default:r(()=>e[10]||(e[10]=[k("Word文档")])),_:1,__:[10]}),l(i(X),{value:"excel"},{default:r(()=>e[11]||(e[11]=[k("Excel表格")])),_:1,__:[11]}),l(i(X),{value:"json"},{default:r(()=>e[12]||(e[12]=[k("JSON数据")])),_:1,__:[12]})]),_:1},8,["modelValue"])]),_:1}),l(i(F),{label:"包含内容"},{default:r(()=>[l(i(_e),{modelValue:f.value.includes,"onUpdate:modelValue":e[2]||(e[2]=a=>f.value.includes=a)},{default:r(()=>[l(i(J),{value:"summary"},{default:r(()=>e[13]||(e[13]=[k("分析摘要")])),_:1,__:[13]}),l(i(J),{value:"metrics"},{default:r(()=>e[14]||(e[14]=[k("关键指标")])),_:1,__:[14]}),l(i(J),{value:"insights"},{default:r(()=>e[15]||(e[15]=[k("核心洞察")])),_:1,__:[15]}),l(i(J),{value:"recommendations"},{default:r(()=>e[16]||(e[16]=[k("建议行动")])),_:1,__:[16]}),l(i(J),{value:"charts"},{default:r(()=>e[17]||(e[17]=[k("图表数据")])),_:1,__:[17]}),l(i(J),{value:"history"},{default:r(()=>e[18]||(e[18]=[k("历史对比")])),_:1,__:[18]})]),_:1},8,["modelValue"])]),_:1}),l(i(F),{label:"报告标题"},{default:r(()=>[l(i(ee),{modelValue:f.value.title,"onUpdate:modelValue":e[3]||(e[3]=a=>f.value.title=a),placeholder:"请输入报告标题"},null,8,["modelValue"])]),_:1}),l(i(F),{label:"分析师"},{default:r(()=>[l(i(ee),{modelValue:f.value.analyst,"onUpdate:modelValue":e[4]||(e[4]=a=>f.value.analyst=a),placeholder:"请输入分析师姓名"},null,8,["modelValue"])]),_:1}),l(i(F),{label:"备注"},{default:r(()=>[l(i(ee),{modelValue:f.value.notes,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value.notes=a),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["modelValue"]),A.value?(c(),u("div",nt,[t("div",lt,[e[20]||(e[20]=t("h5",null,"📋 报告预览",-1)),l(i(z),{size:"small",text:"",onClick:m},{default:r(()=>[k(p(S.value?"收起":"展开"),1)]),_:1})]),be(t("div",ot,[t("div",it,[e[21]||(e[21]=t("h6",null,"分析摘要",-1)),t("p",null,p(O()),1)]),(h=$.analysisData.keyMetrics)!=null&&h.length?(c(),u("div",rt,[t("h6",null,"关键指标 ("+p($.analysisData.keyMetrics.length)+"项)",1),t("div",ct,[(c(!0),u(L,null,V($.analysisData.keyMetrics.slice(0,3),a=>(c(),u("span",{key:a.name,class:"metric-tag"},p(a.name)+": "+p(a.value),1))),128))])])):I("",!0),(o=$.analysisData.insights)!=null&&o.length?(c(),u("div",dt,[t("h6",null,"核心洞察 ("+p($.analysisData.insights.length)+"项)",1),t("ul",ut,[(c(!0),u(L,null,V($.analysisData.insights.slice(0,2),a=>(c(),u("li",{key:a.id},p(a.title),1))),128))])])):I("",!0),(s=$.analysisData.recommendations)!=null&&s.length?(c(),u("div",vt,[t("h6",null,"建议行动 ("+p($.analysisData.recommendations.length)+"项)",1),t("ul",mt,[(c(!0),u(L,null,V($.analysisData.recommendations.slice(0,2),a=>(c(),u("li",{key:a.id},p(a.title),1))),128))])])):I("",!0)],512),[[ke,S.value]])])):I("",!0)])}}},yt=se(pt,[["__scopeId","data-v-60789932"]]),ht={class:"ai-assistant-container"},ft={class:"top-header"},gt={class:"header-right"},_t={class:"two-column-layout"},bt={class:"left-column"},kt={class:"chat-body"},xt={key:0,class:"welcome-container"},wt={class:"welcome-content"},$t={class:"welcome-subtitle"},Ct={class:"suggested-queries"},Dt={class:"query-buttons"},St={key:1,class:"message-list"},It={class:"message-avatar"},At={class:"message-content"},Tt={class:"message-sender"},Et={class:"message-bubble"},Lt={key:0,class:"ai-message"},Vt={key:0,class:"thinking-process"},Ot={class:"thinking-header"},zt={class:"thinking-text"},Mt={class:"thinking-phase"},jt={key:1,class:"ai-content-stream"},Pt=["innerHTML"],Ut={key:2,class:"loading-indicator"},Ht=["innerHTML"],qt={class:"chat-footer"},Qt={class:"input-container"},Rt={class:"right-column"},Nt={class:"analysis-content"},Bt={key:0,class:"empty-analysis"},Jt={key:1,class:"analysis-results"},Ft={class:"analysis-status"},Wt={key:0,class:"metrics-section"},Gt={class:"metrics-grid"},Kt=["onClick"],Xt={class:"metric-value"},Yt={class:"metric-name"},Zt={key:1,class:"charts-section"},es={key:2,class:"insights-section"},ts={class:"insights-list"},ss=["onClick"],as={class:"insight-icon"},ns={class:"insight-content"},ls={class:"insight-title"},os={class:"insight-description"},is={key:3,class:"recommendations-section"},rs={class:"recommendations-list"},cs=["onClick"],ds={class:"rec-priority"},us={class:"rec-content"},vs={class:"rec-title"},ms={class:"rec-description"},ps={key:4,class:"sources-section"},ys={class:"sources-list"},hs={__name:"AssistantPageAISimple",setup($){const x=w(""),d=w([]),g=w(!1),f=w("analysis"),_=w(""),S=w(null),C=w(["分析深圳工厂的整体质量状况，包括库存风险和生产表现","评估紫光供应商的质量表现和风险状况","为什么最近的生产不良率有所上升？请分析原因","如何优化当前的质量管理流程？"]),A=w(["查询深圳工厂的库存","显示风险状态的物料","查询紫光供应商的数据","显示测试不合格的记录"]),O=le(()=>d.value.length===0),m=w({hasData:!1,status:null,keyMetrics:[],insights:[],recommendations:[],dataSources:[],text:""}),M=o=>{switch(o){case"analyzing":return"warning";case"completed":return"success";case"error":return"danger";default:return"info"}},Q=o=>{switch(o){case"analyzing":return"分析中";case"completed":return"分析完成";case"error":return"分析失败";default:return"等待中"}},R=o=>{try{m.value={hasData:!0,status:"completed",keyMetrics:[],insights:[],recommendations:[],dataSources:[],chartData:null,text:o};const s=o.toLowerCase();(s.includes("不良率")||s.includes("合格率"))&&m.value.keyMetrics.push({name:"质量合格率",value:"95.2%",trend:"up",trendText:"↗ 改善中",detail:"相比上月提升2.1%"}),(s.includes("库存")||s.includes("物料"))&&m.value.keyMetrics.push({name:"库存周转率",value:"12.5次/年",trend:"stable",trendText:"→ 稳定",detail:"符合行业标准"}),(s.includes("效率")||s.includes("产能"))&&m.value.keyMetrics.push({name:"生产效率",value:"87.3%",trend:"down",trendText:"↘ 需关注",detail:"低于目标值5%"}),m.value.chartData=N(s),(s.includes("风险")||s.includes("问题"))&&m.value.insights.push({id:1,icon:"⚠️",title:"质量风险识别",description:"检测到3个潜在质量风险点，需要重点关注A生产线的异常波动",priority:"high",detail:"建议立即检查设备状态和工艺参数"}),(s.includes("改善")||s.includes("优化"))&&m.value.insights.push({id:2,icon:"📈",title:"改善机会分析",description:"发现2个质量改善机会，预计可提升整体合格率1.5%",priority:"medium",detail:"重点优化检验流程和员工培训"}),(s.includes("供应商")||s.includes("来料"))&&m.value.insights.push({id:3,icon:"🏭",title:"供应商表现",description:"供应商质量表现整体良好，但需关注交期稳定性",priority:"low",detail:"建议与关键供应商建立更紧密的合作关系"}),(s.includes("建议")||s.includes("应该"))&&m.value.recommendations.push({id:1,priority:"高",title:"立即执行质量改进计划",description:"基于当前分析，建议在7天内完成关键工序的质量控制优化",detail:"包括设备校准、工艺参数调整和人员培训"}),(s.includes("监控")||s.includes("跟踪"))&&m.value.recommendations.push({id:2,priority:"中",title:"建立实时监控体系",description:"建议部署实时质量监控系统，提升问题发现和响应速度",detail:"预计可减少质量事故发生率30%"}),m.value.dataSources=["实时库存数据","质量检测记录","生产线数据","AI智能分析"],S.value&&S.value.addHistoryItem({query:_.value,reply:o,source:"ai-enhanced",metrics:m.value.keyMetrics,insights:m.value.insights,recommendations:m.value.recommendations})}catch(s){console.error("解析AI回复失败:",s),m.value.status="error"}},N=o=>o.includes("趋势")||o.includes("变化")?{timeline:["1月","2月","3月","4月","5月","6月"],trend:[92.1,93.5,91.8,94.2,93.7,95.2],categories:["深圳工厂","上海工厂","北京工厂"],values:[95.2,92.8,97.1],distribution:[{value:65,name:"正常"},{value:20,name:"风险"},{value:10,name:"冻结"},{value:5,name:"其他"}]}:null,D=o=>{x.value=o,j()},B=async o=>{try{(await fetch("http://localhost:3001/api/assistant/ai-toggle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:o})})).ok?console.log("AI模式切换成功"):(console.error("AI模式切换失败"),g.value=!o)}catch(s){console.error("AI模式切换错误:",s),g.value=!o}},j=async()=>{const o=x.value.trim();if(!o)return;_.value=o,d.value.push({sender:"user",text:o});const s=x.value;x.value="";const a=d.value.length;g.value?(d.value.push({sender:"assistant",type:"ai_streaming",analysisPhase:"🤖 AI正在分析您的问题...",isLoading:!0,isAI:!0}),m.value.status="analyzing",m.value.hasData=!0,await P(s,a)):(d.value.push({sender:"assistant",text:"我正在思考您的问题，请稍候...",isLoading:!0}),await T(s,a))},P=async(o,s)=>{try{console.log("🤖 发送AI查询:",o);const a=await fetch("http://localhost:3001/api/assistant/ai-query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:o})});if(console.log("🤖 AI响应状态:",a.status),console.log("🤖 AI响应头:",Object.fromEntries(a.headers.entries())),!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const H=a.body.getReader(),G=new TextDecoder;let E="";for(;;){const{done:b,value:K}=await H.read();if(b)break;const pe=G.decode(K).split(`
`);for(const oe of pe)if(oe.startsWith("data: ")){const ie=oe.slice(6);if(ie==="[DONE]"){d.value[s].isLoading=!1;break}try{const q=JSON.parse(ie);switch(console.log("🤖 收到AI数据:",q),q.type){case"start":d.value[s].analysisPhase=q.message;break;case"content":E+=q.content,d.value[s].aiContent=E,d.value[s].text=E;break;case"ai_content":E+=q.content,d.value[s].aiContent=E,d.value[s].text=E;break;case"end":d.value[s].analysisPhase=q.message,d.value[s].isLoading=!1,E&&R(E);break;case"error":throw new Error(q.message)}}catch(q){console.warn("解析流式数据失败:",q.message)}}}}catch(a){console.error("AI查询失败:",a),d.value[s]={sender:"assistant",text:"抱歉，AI分析时发生了错误。请稍后再试。",isLoading:!1,isAI:!0}}},T=async(o,s)=>{try{const a=await fetch("http://localhost:3001/api/assistant/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:o})});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const H=await a.json();d.value[s]={sender:"assistant",text:H.reply||"抱歉，我暂时无法回答这个问题。",isLoading:!1}}catch(a){console.error("基础查询失败:",a),d.value[s]={sender:"assistant",text:"抱歉，处理您的问题时发生了错误。请稍后再试。",isLoading:!1}}},U=o=>{console.log("显示指标详情:",o)},v=o=>{console.log("显示洞察详情:",o)},y=o=>{console.log("显示建议详情:",o)},n=o=>{m.value={hasData:!0,status:"completed",keyMetrics:o.metrics||[],insights:o.insights||[],recommendations:o.recommendations||[],dataSources:["历史数据"],text:o.reply},f.value="analysis"},e=o=>{console.log("导出历史记录:",o)},h=o=>{console.log("导出完成:",o)};return(o,s)=>(c(),u("div",ht,[t("div",ft,[s[3]||(s[3]=t("div",{class:"header-left"},[t("h2",null,"🤖 IQE AI增强助手"),t("p",null,"智能质量分析 · AI驱动洞察")],-1)),t("div",gt,[l(i(xe),{modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=a=>g.value=a),onChange:B,"active-text":"AI增强","inactive-text":"基础模式",class:"ai-switch"},null,8,["modelValue"]),l(i(W),{type:g.value?"success":"info",effect:"dark",size:"small"},{default:r(()=>[k(p(g.value?"AI模式":"基础模式"),1)]),_:1},8,["type"])])]),t("div",_t,[t("div",bt,[l(i(Se),{class:"chat-card",shadow:"never"},{footer:r(()=>[t("div",qt,[t("div",Qt,[l(i(ee),{modelValue:x.value,"onUpdate:modelValue":s[1]||(s[1]=a=>x.value=a),placeholder:g.value?"请输入复杂问题，AI将为您深度分析...":"请输入您的问题...",onKeyup:we(j,["enter"]),clearable:"",size:"large",class:"input-with-send"},$e({append:r(()=>[l(i(z),{onClick:j,disabled:!x.value.trim()},{default:r(()=>[l(i(te),null,{default:r(()=>[l(i(De))]),_:1}),t("span",null,p(g.value?"AI分析":"发送"),1)]),_:1},8,["disabled"])]),_:2},[g.value?{name:"prepend",fn:r(()=>[l(i(te),null,{default:r(()=>[l(i(Ce))]),_:1})]),key:"0"}:void 0]),1032,["modelValue","placeholder"])])])]),default:r(()=>[t("div",kt,[O.value?(c(),u("div",xt,[t("div",wt,[s[4]||(s[4]=t("div",{class:"welcome-avatar"},[t("div",{class:"avatar-circle"},"🤖")],-1)),s[5]||(s[5]=t("h2",{class:"welcome-title"},"欢迎使用IQE AI增强助手",-1)),t("p",$t,p(g.value?"🤖 AI增强模式：我可以进行深度分析、复杂推理和专业建议":"📋 基础模式：我可以快速查询数据、生成图表和回答问题"),1),t("div",Ct,[t("h4",null,"💡 "+p(g.value?"AI增强查询示例":"基础查询示例"),1),t("div",Dt,[(c(!0),u(L,null,V(g.value?C.value:A.value,a=>(c(),Y(i(z),{key:a,type:g.value?"success":"primary",plain:"",onClick:H=>D(a),class:"query-btn"},{default:r(()=>[k(p(a),1)]),_:2},1032,["type","onClick"]))),128))])])])])):(c(),u("div",St,[(c(!0),u(L,null,V(d.value,(a,H)=>(c(),u("div",{key:H,class:Z(["message-item",{"is-user":a.sender==="user","is-ai":a.isAI}])},[t("div",It,p(a.sender==="user"?"👤":"🤖"),1),t("div",At,[t("div",Tt,[k(p(a.sender==="user"?"您":"AI助手")+" ",1),a.isAI?(c(),Y(i(W),{key:0,type:"success",size:"small"},{default:r(()=>s[6]||(s[6]=[k("AI")])),_:1,__:[6]})):I("",!0)]),t("div",Et,[a.type==="ai_streaming"?(c(),u("div",Lt,[a.analysisPhase?(c(),u("div",Vt,[t("div",Ot,[s[8]||(s[8]=t("div",{class:"thinking-icon"},[t("div",{class:"brain-animation"},"🧠")],-1)),t("div",zt,[s[7]||(s[7]=t("div",{class:"thinking-title"},"AI思考中",-1)),t("div",Mt,p(a.analysisPhase),1)])]),s[9]||(s[9]=t("div",{class:"thinking-progress"},[t("div",{class:"progress-dots"},[t("span",{class:"dot active"}),t("span",{class:"dot active"}),t("span",{class:"dot active"}),t("span",{class:"dot"}),t("span",{class:"dot"})])],-1))])):I("",!0),a.aiContent?(c(),u("div",jt,[s[10]||(s[10]=t("div",{class:"content-header"},[t("div",{class:"content-icon"},"✨"),t("div",{class:"content-title"},"AI分析结果")],-1)),t("div",{class:"content-body",innerHTML:a.aiContent},null,8,Pt)])):I("",!0),a.isLoading&&!a.aiContent?(c(),u("div",Ut,s[11]||(s[11]=[t("div",{class:"loading-animation"},[t("div",{class:"pulse-ring"}),t("div",{class:"pulse-ring delay-1"}),t("div",{class:"pulse-ring delay-2"})],-1),t("span",{class:"loading-text"},"AI正在深度分析您的问题...",-1)]))):I("",!0)])):(c(),u("div",{key:1,innerHTML:a.text},null,8,Ht))])])],2))),128))]))])]),_:1})]),t("div",Rt,[l(i(Ie),{modelValue:f.value,"onUpdate:modelValue":s[2]||(s[2]=a=>f.value=a),class:"analysis-tabs"},{default:r(()=>[l(i(ae),{label:"📊 分析结果",name:"analysis"},{default:r(()=>{var a,H,G,E;return[t("div",Nt,[m.value.hasData?(c(),u("div",Jt,[t("div",Ft,[m.value.status?(c(),Y(i(W),{key:0,type:M(m.value.status),size:"small"},{default:r(()=>[k(p(Q(m.value.status)),1)]),_:1},8,["type"])):I("",!0)]),(a=m.value.keyMetrics)!=null&&a.length?(c(),u("div",Wt,[s[13]||(s[13]=t("h4",null,"🎯 关键指标",-1)),t("div",Gt,[(c(!0),u(L,null,V(m.value.keyMetrics,b=>(c(),u("div",{key:b.name,class:"metric-card",onClick:K=>U(b)},[t("div",Xt,p(b.value),1),t("div",Yt,p(b.name),1),t("div",{class:Z(["metric-trend",b.trend])},p(b.trendText),3)],8,Kt))),128))])])):I("",!0),m.value.chartData?(c(),u("div",Zt,[l(Ve,{title:"质量趋势分析",data:m.value.chartData,type:"line"},null,8,["data"])])):I("",!0),(H=m.value.insights)!=null&&H.length?(c(),u("div",es,[s[14]||(s[14]=t("h4",null,"💡 核心洞察",-1)),t("div",ts,[(c(!0),u(L,null,V(m.value.insights,b=>(c(),u("div",{key:b.id,class:Z(["insight-item",b.priority]),onClick:K=>v(b)},[t("div",as,p(b.icon),1),t("div",ns,[t("div",ls,p(b.title),1),t("div",os,p(b.description),1)])],10,ss))),128))])])):I("",!0),(G=m.value.recommendations)!=null&&G.length?(c(),u("div",is,[s[15]||(s[15]=t("h4",null,"🚀 建议行动",-1)),t("div",rs,[(c(!0),u(L,null,V(m.value.recommendations,b=>(c(),u("div",{key:b.id,class:"recommendation-item",onClick:K=>y(b)},[t("div",ds,p(b.priority),1),t("div",us,[t("div",vs,p(b.title),1),t("div",ms,p(b.description),1)])],8,cs))),128))])])):I("",!0),(E=m.value.dataSources)!=null&&E.length?(c(),u("div",ps,[s[16]||(s[16]=t("h4",null,"📋 数据来源",-1)),t("div",ys,[(c(!0),u(L,null,V(m.value.dataSources,b=>(c(),Y(i(W),{key:b,size:"small",class:"source-tag"},{default:r(()=>[k(p(b),1)]),_:2},1024))),128))])])):I("",!0)])):(c(),u("div",Bt,s[12]||(s[12]=[t("div",{class:"empty-icon"},"🔍",-1),t("h4",null,"等待分析",-1),t("p",null,"发送问题后，AI分析结果将在这里显示",-1)])))])]}),_:1}),l(i(ae),{label:"📚 历史记录",name:"history"},{default:r(()=>[l(Ze,{ref_key:"historyComponent",ref:S,"current-analysis":m.value,onSelectHistory:n,onExportHistory:e},null,8,["current-analysis"])]),_:1}),l(i(ae),{label:"📄 导出报告",name:"export"},{default:r(()=>[l(yt,{"analysis-data":m.value,"current-query":_.value,onExportComplete:h},null,8,["analysis-data","current-query"])]),_:1})]),_:1},8,["modelValue"])])])]))}},ks=se(hs,[["__scopeId","data-v-a660647e"]]);export{ks as default};
