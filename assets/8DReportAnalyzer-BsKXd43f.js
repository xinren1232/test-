class h{constructor(){this.reportStructure=this.initialize8DStructure(),this.keywordPatterns=this.initialize8DKeywords(),this.validationRules=this.initialize8DValidation()}initialize8DStructure(){return{D1:{name:"团队组建",englishName:"Team Formation",description:"组建跨职能团队",requiredFields:["团队成员","角色分工","责任人","联系方式"],keywords:["团队","成员","负责人","小组","组长","协调员"],weight:.1},D2:{name:"问题描述",englishName:"Problem Description",description:"详细描述问题现象",requiredFields:["问题现象","发生时间","影响范围","严重程度"],keywords:["问题","现象","故障","缺陷","异常","不良"],weight:.15},D3:{name:"临时措施",englishName:"Interim Containment Actions",description:"实施临时遏制措施",requiredFields:["临时措施","实施时间","效果验证","负责人"],keywords:["临时","应急","遏制","措施","处理","控制"],weight:.1},D4:{name:"根因分析",englishName:"Root Cause Analysis",description:"确定问题根本原因",requiredFields:["根本原因","分析方法","验证结果","证据"],keywords:["根因","原因","分析","鱼骨图","5Why","因果"],weight:.2},D5:{name:"永久措施",englishName:"Permanent Corrective Actions",description:"制定永久纠正措施",requiredFields:["纠正措施","实施计划","预期效果","验证方法"],keywords:["永久","纠正","改善","措施","方案","对策"],weight:.15},D6:{name:"措施实施",englishName:"Implementation & Validation",description:"实施并验证纠正措施",requiredFields:["实施状态","验证结果","效果评估","完成时间"],keywords:["实施","执行","验证","测试","确认","评估"],weight:.1},D7:{name:"预防措施",englishName:"Prevention",description:"防止问题再次发生",requiredFields:["预防措施","系统改进","流程优化","培训计划"],keywords:["预防","防止","避免","系统","流程","标准"],weight:.1},D8:{name:"团队表彰",englishName:"Team Recognition",description:"表彰团队贡献",requiredFields:["团队贡献","表彰方式","经验总结","知识分享"],keywords:["表彰","认可","贡献","总结","分享","经验"],weight:.1}}}initialize8DKeywords(){return{documentType:["8D报告","8D分析","质量问题","客户投诉","不良分析","8D Report","8D Analysis","Quality Issue","Customer Complaint"],qualityTerms:["PDCA","DMAIC","FMEA","SPC","MSA","APQP","PPAP","质量","缺陷","不合格","改进","纠正","预防"],analysisMethods:["鱼骨图","5Why","因果图","帕累托图","散点图","直方图","Fishbone","Ishikawa","Pareto","Histogram","Scatter Plot"],timePatterns:[/\d{4}[-\/]\d{1,2}[-\/]\d{1,2}/g,/\d{1,2}:\d{2}/g,/第?\d+周/g,/\d+天/g]}}initialize8DValidation(){return{completeness:{minD1Fields:3,minD2Fields:4,minD4Fields:3,minD5Fields:3},quality:{minWordCount:50,maxWordCount:1e3,requiredSections:6},consistency:{timelineCheck:!0,teamConsistency:!0,actionAlignment:!0}}}async identify8DReport(r,e=""){try{const t=this.calculate8DScore(r,e),s=t.totalScore/t.maxScore;return{is8DReport:s>.6,confidence:s,identificationDetails:t,suggestedTemplate:s>.8?"standard_8d":"basic_8d"}}catch(t){return console.error("8D报告识别失败:",t),{is8DReport:!1,confidence:0,error:t.message}}}calculate8DScore(r,e){let t={fileNameScore:0,keywordScore:0,structureScore:0,contentScore:0,totalScore:0,maxScore:100};return t.fileNameScore=this.scoreFileName(e),t.keywordScore=this.scoreKeywords(r),t.structureScore=this.scoreStructure(r),t.contentScore=this.scoreContent(r),t.totalScore=t.fileNameScore+t.keywordScore+t.structureScore+t.contentScore,t}scoreFileName(r){if(!r)return 0;const e=r.toLowerCase();let t=0;return e.includes("8d")&&(t+=5),(e.includes("质量")||e.includes("quality"))&&(t+=2),(e.includes("问题")||e.includes("problem"))&&(t+=2),(e.includes("报告")||e.includes("report"))&&(t+=1),Math.min(t,10)}scoreKeywords(r){let e=0;const t=r.toLowerCase();return this.keywordPatterns.documentType.forEach(s=>{t.includes(s.toLowerCase())&&(e+=5)}),this.keywordPatterns.qualityTerms.forEach(s=>{t.includes(s.toLowerCase())&&(e+=2)}),this.keywordPatterns.analysisMethods.forEach(s=>{t.includes(s.toLowerCase())&&(e+=3)}),Math.min(e,30)}scoreStructure(r){let e=0;const t=r.toLowerCase();return Object.keys(this.reportStructure).forEach(s=>{const n=this.reportStructure[s];(t.includes(s.toLowerCase())||t.includes(n.name)||t.includes(n.englishName.toLowerCase()))&&(e+=5)}),Math.min(e,40)}scoreContent(r){let e=0;return r.length>1e3&&(e+=5),r.length>3e3&&(e+=5),this.keywordPatterns.timePatterns.forEach(t=>{const s=r.match(t);s&&s.length>0&&(e+=Math.min(s.length,5))}),Math.min(e,20)}async parse8DContent(r,e="text"){try{const t=await this.extractContentByType(r,e),s=this.extract8DDimensions(t),n=this.validate8DContent(s);return{success:!0,dimensions:s,validation:n,metadata:this.extractMetadata(t),suggestions:this.generateImprovementSuggestions(s,n)}}catch(t){return console.error("8D内容解析失败:",t),{success:!1,error:t.message,dimensions:{},validation:{isValid:!1,errors:[t.message]}}}}async extractContentByType(r,e){switch(e.toLowerCase()){case"excel":case"xlsx":return this.parseExcel8D(r);case"word":case"docx":return this.parseWord8D(r);case"pdf":return this.parsePDF8D(r);default:return r}}parseExcel8D(r){return{sheets:["8D报告"],data:{"D1-团队组建":`团队成员：张三、李四、王五
角色：组长、技术专家、质量工程师`,"D2-问题描述":"产品在客户端出现功能异常，影响用户体验","D3-临时措施":"立即停止发货，召回问题产品","D4-根因分析":"通过5Why分析发现是设计缺陷导致","D5-永久措施":"修改设计方案，增加测试验证","D6-措施实施":"已完成设计修改，通过验证测试","D7-预防措施":"建立设计评审流程，加强测试标准","D8-团队表彰":"表彰团队快速响应和有效解决问题"}}}parseWord8D(r){return r}parsePDF8D(r){return r}extract8DDimensions(r){const e={},t=typeof r=="string"?r:JSON.stringify(r);return Object.keys(this.reportStructure).forEach(s=>{const n=this.reportStructure[s];e[s]=this.extractDimensionContent(t,s,n)}),e}extractDimensionContent(r,e,t){const s=[new RegExp(`${e}[：:](.*?)(?=${Object.keys(this.reportStructure).join("|")}|$)`,"is"),new RegExp(`${t.name}[：:](.*?)(?=${Object.values(this.reportStructure).map(i=>i.name).join("|")}|$)`,"is"),new RegExp(`${t.englishName}[：:](.*?)(?=D\\d|$)`,"is")];let n="";for(const i of s){const o=r.match(i);if(o&&o[1]){n=o[1].trim();break}}return n||(n=this.extractByKeywords(r,t.keywords)),{content:n,keywords:this.findKeywords(n,t.keywords),fields:this.extractFields(n,t.requiredFields),completeness:this.calculateCompleteness(n,t),quality:this.assessContentQuality(n)}}extractByKeywords(r,e){let t="";return r.split(/[。！？.!?]/).forEach(n=>{e.filter(o=>n.toLowerCase().includes(o.toLowerCase())).length>0&&(t+=n+"。")}),t.trim()}findKeywords(r,e){const t=[],s=r.toLowerCase();return e.forEach(n=>{s.includes(n.toLowerCase())&&t.push(n)}),t}extractFields(r,e){const t={};return e.forEach(s=>{const n=[new RegExp(`${s}[：:](.*?)(?=\\n|$)`,"i"),new RegExp(`${s}.*?[：:]\\s*(.*?)(?=\\n|$)`,"i")];for(const i of n){const o=r.match(i);if(o&&o[1]){t[s]=o[1].trim();break}}t[s]||(t[s]=null)}),t}calculateCompleteness(r,e){const t=r.length,s=e.keywords.filter(i=>r.toLowerCase().includes(i.toLowerCase())).length,n=Object.values(this.extractFields(r,e.requiredFields)).filter(i=>i!==null).length/e.requiredFields.length;return{wordCount:t,keywordMatches:s,fieldCompleteness:n,overallScore:n*.6+s/e.keywords.length*.4}}assessContentQuality(r){return{length:r.length,hasNumbers:/\d/.test(r),hasDate:/\d{4}[-\/]\d{1,2}[-\/]\d{1,2}/.test(r),hasTime:/\d{1,2}:\d{2}/.test(r),complexity:r.split(/[，,。.！!？?]/).length,score:Math.min(r.length/100,1)*100}}validate8DContent(r){const e={isValid:!0,errors:[],warnings:[],score:0,dimensionScores:{}};let t=0,s=0;return Object.keys(this.reportStructure).forEach(n=>{const i=this.reportStructure[n],o=r[n];if(!o||!o.content){e.errors.push(`${n}(${i.name})缺少内容`),e.dimensionScores[n]=0;return}const a=this.validateDimension(o,i,e);e.dimensionScores[n]=a,t+=a*i.weight,s+=100*i.weight}),e.score=t/s*100,e.isValid=e.errors.length===0&&e.score>=60,e}validateDimension(r,e,t){let s=100;return r.content.length<this.validationRules.quality.minWordCount&&(t.warnings.push(`${e.name}内容过短，建议补充详细信息`),s-=20),r.completeness.fieldCompleteness<.5&&(t.warnings.push(`${e.name}必填字段不完整`),s-=30),r.keywords.length<e.keywords.length*.3&&(t.warnings.push(`${e.name}缺少关键信息`),s-=20),Math.max(s,0)}extractMetadata(r){const e=typeof r=="string"?r:JSON.stringify(r);return{reportDate:this.extractDate(e),reportNumber:this.extractReportNumber(e),customer:this.extractCustomer(e),product:this.extractProduct(e),severity:this.extractSeverity(e),status:this.extractStatus(e)}}extractDate(r){const e=/\d{4}[-\/]\d{1,2}[-\/]\d{1,2}/g,t=r.match(e);return t?t[0]:null}extractReportNumber(r){const e=[/报告编号[：:]?\s*([A-Z0-9\-]+)/i,/Report\s+No[：.]?\s*([A-Z0-9\-]+)/i,/8D[：-]?\s*([A-Z0-9\-]+)/i];for(const t of e){const s=r.match(t);if(s)return s[1]}return null}extractCustomer(r){const e=[/客户[：:]?\s*([^\n\r，,。.]+)/i,/Customer[：:]?\s*([^\n\r，,。.]+)/i];for(const t of e){const s=r.match(t);if(s)return s[1].trim()}return null}extractProduct(r){const e=[/产品[：:]?\s*([^\n\r，,。.]+)/i,/Product[：:]?\s*([^\n\r，,。.]+)/i,/零件[：:]?\s*([^\n\r，,。.]+)/i];for(const t of e){const s=r.match(t);if(s)return s[1].trim()}return null}extractSeverity(r){const e=["严重","一般","轻微","Critical","Major","Minor"],t=r.toLowerCase();for(const s of e)if(t.includes(s.toLowerCase()))return s;return null}extractStatus(r){const e=["进行中","已完成","待处理","In Progress","Completed","Pending"],t=r.toLowerCase();for(const s of e)if(t.includes(s.toLowerCase()))return s;return null}async analyzeReport(r){try{console.log("🔍 开始分析8D报告内容...");const e=await this.identify8DReport(r);if(!e.is8DReport)return console.warn("⚠️ 文档不是标准8D报告"),{isValid:!1,confidence:e.confidence,message:"文档不符合8D报告标准格式"};const t=this.extractDimensionData(r),s=this.validateReport(t),n={isValid:!0,confidence:e.confidence,reportInfo:{reportNumber:this.extractReportNumber(r),customer:this.extractCustomer(r),product:this.extractProduct(r),date:this.extractDate(r),severity:this.extractSeverity(r),status:this.extractStatus(r)},dimensionData:t,validation:s,suggestions:this.generateImprovementSuggestions(t,s),summary:this.generateReportSummary(t,s)};return console.log("✅ 8D报告分析完成"),n}catch(e){throw console.error("❌ 8D报告分析失败:",e),e}}extractDimensionData(r){const e={};return Object.keys(this.reportStructure).forEach(t=>{const s=this.reportStructure[t];e[t]=this.extractDimensionContent(r,t,s)}),e}extractDimensionContent(r,e,t){const s=t.keywords,n=[];return r.split(/\n\s*\n/).forEach((o,a)=>{const u=o.toLowerCase(),c=s.filter(l=>u.includes(l.toLowerCase()));c.length>0&&n.push({content:o.trim(),position:`段落${a+1}`,matchedKeywords:c,confidence:c.length/s.length})}),{sections:n,totalContent:n.map(o=>o.content).join(`
`),keywordMatches:n.reduce((o,a)=>o+a.matchedKeywords.length,0),confidence:n.length>0?n.reduce((o,a)=>o+a.confidence,0)/n.length:0}}validateReport(r){const e={isComplete:!0,completeness:0,dimensionScores:{},missingDimensions:[],issues:[]};let t=0;const s=Object.keys(this.reportStructure).length;return Object.keys(this.reportStructure).forEach(n=>{const i=this.reportStructure[n],o=r[n];let a=0;o.totalContent.length>50?a+=30:o.totalContent.length>20&&(a+=15),a+=o.confidence*40,o.sections.length>=2?a+=30:o.sections.length>=1&&(a+=15),e.dimensionScores[n]=Math.min(100,a),t+=e.dimensionScores[n],a<30&&(e.missingDimensions.push(n),e.issues.push(`${i.name}(${n})内容不足`))}),e.completeness=t/s,e.isComplete=e.completeness>=60,e}generateReportSummary(r,e){const t=Object.keys(e.dimensionScores).filter(n=>e.dimensionScores[n]>=60),s=Object.keys(this.reportStructure).length;return{completedDimensions:t.length,totalDimensions:s,completionRate:(t.length/s*100).toFixed(1),overallQuality:e.completeness.toFixed(1),status:e.isComplete?"基本完整":"需要完善",keyStrengths:this.identifyStrengths(r,e),keyWeaknesses:this.identifyWeaknesses(r,e)}}identifyStrengths(r,e){return Object.keys(e.dimensionScores).filter(t=>e.dimensionScores[t]>=80).map(t=>this.reportStructure[t].name)}identifyWeaknesses(r,e){return Object.keys(e.dimensionScores).filter(t=>e.dimensionScores[t]<60).map(t=>this.reportStructure[t].name)}generateImprovementSuggestions(r,e){const t=[];return Object.keys(this.reportStructure).forEach(s=>{const n=this.reportStructure[s],i=r[s],o=e.dimensionScores[s]||0;o<70&&t.push({dimension:s,dimensionName:n.name,priority:o<40?"high":"medium",suggestion:this.getDimensionSuggestion(s,i,n),expectedImprovement:`预计可提升${s}维度质量${Math.min(30,100-o)}分`})}),t}getDimensionSuggestion(r,e,t){return{D1:"建议补充团队成员的具体角色分工和联系方式，明确各成员的专业背景和责任范围",D2:"建议详细描述问题的具体现象、发生频率、影响范围和客户反馈，使用数据量化问题严重程度",D3:"建议明确临时措施的具体实施步骤、时间节点、负责人和效果验证方法",D4:"建议使用系统性分析方法（如5Why、鱼骨图）深入分析根本原因，并提供充分的验证证据",D5:"建议制定详细的永久纠正措施实施计划，包括时间表、资源需求和预期效果",D6:"建议补充措施实施的具体进度、验证测试结果和效果评估数据",D7:"建议建立系统性的预防措施，包括流程改进、培训计划和监控机制",D8:"建议详细记录团队贡献和经验总结，建立知识分享机制"}[r]||"建议补充更详细的信息和数据支撑"}}const m=new h;export{h as EightDReportAnalyzer,m as default};
