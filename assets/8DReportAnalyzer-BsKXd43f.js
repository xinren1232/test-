class h{constructor(){this.reportStructure=this.initialize8DStructure(),this.keywordPatterns=this.initialize8DKeywords(),this.validationRules=this.initialize8DValidation()}initialize8DStructure(){return{D1:{name:"å›¢é˜Ÿç»„å»º",englishName:"Team Formation",description:"ç»„å»ºè·¨èŒèƒ½å›¢é˜Ÿ",requiredFields:["å›¢é˜Ÿæˆå‘˜","è§’è‰²åˆ†å·¥","è´£ä»»äºº","è”ç³»æ–¹å¼"],keywords:["å›¢é˜Ÿ","æˆå‘˜","è´Ÿè´£äºº","å°ç»„","ç»„é•¿","åè°ƒå‘˜"],weight:.1},D2:{name:"é—®é¢˜æè¿°",englishName:"Problem Description",description:"è¯¦ç»†æè¿°é—®é¢˜çŽ°è±¡",requiredFields:["é—®é¢˜çŽ°è±¡","å‘ç”Ÿæ—¶é—´","å½±å“èŒƒå›´","ä¸¥é‡ç¨‹åº¦"],keywords:["é—®é¢˜","çŽ°è±¡","æ•…éšœ","ç¼ºé™·","å¼‚å¸¸","ä¸è‰¯"],weight:.15},D3:{name:"ä¸´æ—¶æŽªæ–½",englishName:"Interim Containment Actions",description:"å®žæ–½ä¸´æ—¶éåˆ¶æŽªæ–½",requiredFields:["ä¸´æ—¶æŽªæ–½","å®žæ–½æ—¶é—´","æ•ˆæžœéªŒè¯","è´Ÿè´£äºº"],keywords:["ä¸´æ—¶","åº”æ€¥","éåˆ¶","æŽªæ–½","å¤„ç†","æŽ§åˆ¶"],weight:.1},D4:{name:"æ ¹å› åˆ†æž",englishName:"Root Cause Analysis",description:"ç¡®å®šé—®é¢˜æ ¹æœ¬åŽŸå› ",requiredFields:["æ ¹æœ¬åŽŸå› ","åˆ†æžæ–¹æ³•","éªŒè¯ç»“æžœ","è¯æ®"],keywords:["æ ¹å› ","åŽŸå› ","åˆ†æž","é±¼éª¨å›¾","5Why","å› æžœ"],weight:.2},D5:{name:"æ°¸ä¹…æŽªæ–½",englishName:"Permanent Corrective Actions",description:"åˆ¶å®šæ°¸ä¹…çº æ­£æŽªæ–½",requiredFields:["çº æ­£æŽªæ–½","å®žæ–½è®¡åˆ’","é¢„æœŸæ•ˆæžœ","éªŒè¯æ–¹æ³•"],keywords:["æ°¸ä¹…","çº æ­£","æ”¹å–„","æŽªæ–½","æ–¹æ¡ˆ","å¯¹ç­–"],weight:.15},D6:{name:"æŽªæ–½å®žæ–½",englishName:"Implementation & Validation",description:"å®žæ–½å¹¶éªŒè¯çº æ­£æŽªæ–½",requiredFields:["å®žæ–½çŠ¶æ€","éªŒè¯ç»“æžœ","æ•ˆæžœè¯„ä¼°","å®Œæˆæ—¶é—´"],keywords:["å®žæ–½","æ‰§è¡Œ","éªŒè¯","æµ‹è¯•","ç¡®è®¤","è¯„ä¼°"],weight:.1},D7:{name:"é¢„é˜²æŽªæ–½",englishName:"Prevention",description:"é˜²æ­¢é—®é¢˜å†æ¬¡å‘ç”Ÿ",requiredFields:["é¢„é˜²æŽªæ–½","ç³»ç»Ÿæ”¹è¿›","æµç¨‹ä¼˜åŒ–","åŸ¹è®­è®¡åˆ’"],keywords:["é¢„é˜²","é˜²æ­¢","é¿å…","ç³»ç»Ÿ","æµç¨‹","æ ‡å‡†"],weight:.1},D8:{name:"å›¢é˜Ÿè¡¨å½°",englishName:"Team Recognition",description:"è¡¨å½°å›¢é˜Ÿè´¡çŒ®",requiredFields:["å›¢é˜Ÿè´¡çŒ®","è¡¨å½°æ–¹å¼","ç»éªŒæ€»ç»“","çŸ¥è¯†åˆ†äº«"],keywords:["è¡¨å½°","è®¤å¯","è´¡çŒ®","æ€»ç»“","åˆ†äº«","ç»éªŒ"],weight:.1}}}initialize8DKeywords(){return{documentType:["8DæŠ¥å‘Š","8Dåˆ†æž","è´¨é‡é—®é¢˜","å®¢æˆ·æŠ•è¯‰","ä¸è‰¯åˆ†æž","8D Report","8D Analysis","Quality Issue","Customer Complaint"],qualityTerms:["PDCA","DMAIC","FMEA","SPC","MSA","APQP","PPAP","è´¨é‡","ç¼ºé™·","ä¸åˆæ ¼","æ”¹è¿›","çº æ­£","é¢„é˜²"],analysisMethods:["é±¼éª¨å›¾","5Why","å› æžœå›¾","å¸•ç´¯æ‰˜å›¾","æ•£ç‚¹å›¾","ç›´æ–¹å›¾","Fishbone","Ishikawa","Pareto","Histogram","Scatter Plot"],timePatterns:[/\d{4}[-\/]\d{1,2}[-\/]\d{1,2}/g,/\d{1,2}:\d{2}/g,/ç¬¬?\d+å‘¨/g,/\d+å¤©/g]}}initialize8DValidation(){return{completeness:{minD1Fields:3,minD2Fields:4,minD4Fields:3,minD5Fields:3},quality:{minWordCount:50,maxWordCount:1e3,requiredSections:6},consistency:{timelineCheck:!0,teamConsistency:!0,actionAlignment:!0}}}async identify8DReport(r,e=""){try{const t=this.calculate8DScore(r,e),s=t.totalScore/t.maxScore;return{is8DReport:s>.6,confidence:s,identificationDetails:t,suggestedTemplate:s>.8?"standard_8d":"basic_8d"}}catch(t){return console.error("8DæŠ¥å‘Šè¯†åˆ«å¤±è´¥:",t),{is8DReport:!1,confidence:0,error:t.message}}}calculate8DScore(r,e){let t={fileNameScore:0,keywordScore:0,structureScore:0,contentScore:0,totalScore:0,maxScore:100};return t.fileNameScore=this.scoreFileName(e),t.keywordScore=this.scoreKeywords(r),t.structureScore=this.scoreStructure(r),t.contentScore=this.scoreContent(r),t.totalScore=t.fileNameScore+t.keywordScore+t.structureScore+t.contentScore,t}scoreFileName(r){if(!r)return 0;const e=r.toLowerCase();let t=0;return e.includes("8d")&&(t+=5),(e.includes("è´¨é‡")||e.includes("quality"))&&(t+=2),(e.includes("é—®é¢˜")||e.includes("problem"))&&(t+=2),(e.includes("æŠ¥å‘Š")||e.includes("report"))&&(t+=1),Math.min(t,10)}scoreKeywords(r){let e=0;const t=r.toLowerCase();return this.keywordPatterns.documentType.forEach(s=>{t.includes(s.toLowerCase())&&(e+=5)}),this.keywordPatterns.qualityTerms.forEach(s=>{t.includes(s.toLowerCase())&&(e+=2)}),this.keywordPatterns.analysisMethods.forEach(s=>{t.includes(s.toLowerCase())&&(e+=3)}),Math.min(e,30)}scoreStructure(r){let e=0;const t=r.toLowerCase();return Object.keys(this.reportStructure).forEach(s=>{const n=this.reportStructure[s];(t.includes(s.toLowerCase())||t.includes(n.name)||t.includes(n.englishName.toLowerCase()))&&(e+=5)}),Math.min(e,40)}scoreContent(r){let e=0;return r.length>1e3&&(e+=5),r.length>3e3&&(e+=5),this.keywordPatterns.timePatterns.forEach(t=>{const s=r.match(t);s&&s.length>0&&(e+=Math.min(s.length,5))}),Math.min(e,20)}async parse8DContent(r,e="text"){try{const t=await this.extractContentByType(r,e),s=this.extract8DDimensions(t),n=this.validate8DContent(s);return{success:!0,dimensions:s,validation:n,metadata:this.extractMetadata(t),suggestions:this.generateImprovementSuggestions(s,n)}}catch(t){return console.error("8Då†…å®¹è§£æžå¤±è´¥:",t),{success:!1,error:t.message,dimensions:{},validation:{isValid:!1,errors:[t.message]}}}}async extractContentByType(r,e){switch(e.toLowerCase()){case"excel":case"xlsx":return this.parseExcel8D(r);case"word":case"docx":return this.parseWord8D(r);case"pdf":return this.parsePDF8D(r);default:return r}}parseExcel8D(r){return{sheets:["8DæŠ¥å‘Š"],data:{"D1-å›¢é˜Ÿç»„å»º":`å›¢é˜Ÿæˆå‘˜ï¼šå¼ ä¸‰ã€æŽå››ã€çŽ‹äº”
è§’è‰²ï¼šç»„é•¿ã€æŠ€æœ¯ä¸“å®¶ã€è´¨é‡å·¥ç¨‹å¸ˆ`,"D2-é—®é¢˜æè¿°":"äº§å“åœ¨å®¢æˆ·ç«¯å‡ºçŽ°åŠŸèƒ½å¼‚å¸¸ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ","D3-ä¸´æ—¶æŽªæ–½":"ç«‹å³åœæ­¢å‘è´§ï¼Œå¬å›žé—®é¢˜äº§å“","D4-æ ¹å› åˆ†æž":"é€šè¿‡5Whyåˆ†æžå‘çŽ°æ˜¯è®¾è®¡ç¼ºé™·å¯¼è‡´","D5-æ°¸ä¹…æŽªæ–½":"ä¿®æ”¹è®¾è®¡æ–¹æ¡ˆï¼Œå¢žåŠ æµ‹è¯•éªŒè¯","D6-æŽªæ–½å®žæ–½":"å·²å®Œæˆè®¾è®¡ä¿®æ”¹ï¼Œé€šè¿‡éªŒè¯æµ‹è¯•","D7-é¢„é˜²æŽªæ–½":"å»ºç«‹è®¾è®¡è¯„å®¡æµç¨‹ï¼ŒåŠ å¼ºæµ‹è¯•æ ‡å‡†","D8-å›¢é˜Ÿè¡¨å½°":"è¡¨å½°å›¢é˜Ÿå¿«é€Ÿå“åº”å’Œæœ‰æ•ˆè§£å†³é—®é¢˜"}}}parseWord8D(r){return r}parsePDF8D(r){return r}extract8DDimensions(r){const e={},t=typeof r=="string"?r:JSON.stringify(r);return Object.keys(this.reportStructure).forEach(s=>{const n=this.reportStructure[s];e[s]=this.extractDimensionContent(t,s,n)}),e}extractDimensionContent(r,e,t){const s=[new RegExp(`${e}[ï¼š:](.*?)(?=${Object.keys(this.reportStructure).join("|")}|$)`,"is"),new RegExp(`${t.name}[ï¼š:](.*?)(?=${Object.values(this.reportStructure).map(i=>i.name).join("|")}|$)`,"is"),new RegExp(`${t.englishName}[ï¼š:](.*?)(?=D\\d|$)`,"is")];let n="";for(const i of s){const o=r.match(i);if(o&&o[1]){n=o[1].trim();break}}return n||(n=this.extractByKeywords(r,t.keywords)),{content:n,keywords:this.findKeywords(n,t.keywords),fields:this.extractFields(n,t.requiredFields),completeness:this.calculateCompleteness(n,t),quality:this.assessContentQuality(n)}}extractByKeywords(r,e){let t="";return r.split(/[ã€‚ï¼ï¼Ÿ.!?]/).forEach(n=>{e.filter(o=>n.toLowerCase().includes(o.toLowerCase())).length>0&&(t+=n+"ã€‚")}),t.trim()}findKeywords(r,e){const t=[],s=r.toLowerCase();return e.forEach(n=>{s.includes(n.toLowerCase())&&t.push(n)}),t}extractFields(r,e){const t={};return e.forEach(s=>{const n=[new RegExp(`${s}[ï¼š:](.*?)(?=\\n|$)`,"i"),new RegExp(`${s}.*?[ï¼š:]\\s*(.*?)(?=\\n|$)`,"i")];for(const i of n){const o=r.match(i);if(o&&o[1]){t[s]=o[1].trim();break}}t[s]||(t[s]=null)}),t}calculateCompleteness(r,e){const t=r.length,s=e.keywords.filter(i=>r.toLowerCase().includes(i.toLowerCase())).length,n=Object.values(this.extractFields(r,e.requiredFields)).filter(i=>i!==null).length/e.requiredFields.length;return{wordCount:t,keywordMatches:s,fieldCompleteness:n,overallScore:n*.6+s/e.keywords.length*.4}}assessContentQuality(r){return{length:r.length,hasNumbers:/\d/.test(r),hasDate:/\d{4}[-\/]\d{1,2}[-\/]\d{1,2}/.test(r),hasTime:/\d{1,2}:\d{2}/.test(r),complexity:r.split(/[ï¼Œ,ã€‚.ï¼!ï¼Ÿ?]/).length,score:Math.min(r.length/100,1)*100}}validate8DContent(r){const e={isValid:!0,errors:[],warnings:[],score:0,dimensionScores:{}};let t=0,s=0;return Object.keys(this.reportStructure).forEach(n=>{const i=this.reportStructure[n],o=r[n];if(!o||!o.content){e.errors.push(`${n}(${i.name})ç¼ºå°‘å†…å®¹`),e.dimensionScores[n]=0;return}const a=this.validateDimension(o,i,e);e.dimensionScores[n]=a,t+=a*i.weight,s+=100*i.weight}),e.score=t/s*100,e.isValid=e.errors.length===0&&e.score>=60,e}validateDimension(r,e,t){let s=100;return r.content.length<this.validationRules.quality.minWordCount&&(t.warnings.push(`${e.name}å†…å®¹è¿‡çŸ­ï¼Œå»ºè®®è¡¥å……è¯¦ç»†ä¿¡æ¯`),s-=20),r.completeness.fieldCompleteness<.5&&(t.warnings.push(`${e.name}å¿…å¡«å­—æ®µä¸å®Œæ•´`),s-=30),r.keywords.length<e.keywords.length*.3&&(t.warnings.push(`${e.name}ç¼ºå°‘å…³é”®ä¿¡æ¯`),s-=20),Math.max(s,0)}extractMetadata(r){const e=typeof r=="string"?r:JSON.stringify(r);return{reportDate:this.extractDate(e),reportNumber:this.extractReportNumber(e),customer:this.extractCustomer(e),product:this.extractProduct(e),severity:this.extractSeverity(e),status:this.extractStatus(e)}}extractDate(r){const e=/\d{4}[-\/]\d{1,2}[-\/]\d{1,2}/g,t=r.match(e);return t?t[0]:null}extractReportNumber(r){const e=[/æŠ¥å‘Šç¼–å·[ï¼š:]?\s*([A-Z0-9\-]+)/i,/Report\s+No[ï¼š.]?\s*([A-Z0-9\-]+)/i,/8D[ï¼š-]?\s*([A-Z0-9\-]+)/i];for(const t of e){const s=r.match(t);if(s)return s[1]}return null}extractCustomer(r){const e=[/å®¢æˆ·[ï¼š:]?\s*([^\n\rï¼Œ,ã€‚.]+)/i,/Customer[ï¼š:]?\s*([^\n\rï¼Œ,ã€‚.]+)/i];for(const t of e){const s=r.match(t);if(s)return s[1].trim()}return null}extractProduct(r){const e=[/äº§å“[ï¼š:]?\s*([^\n\rï¼Œ,ã€‚.]+)/i,/Product[ï¼š:]?\s*([^\n\rï¼Œ,ã€‚.]+)/i,/é›¶ä»¶[ï¼š:]?\s*([^\n\rï¼Œ,ã€‚.]+)/i];for(const t of e){const s=r.match(t);if(s)return s[1].trim()}return null}extractSeverity(r){const e=["ä¸¥é‡","ä¸€èˆ¬","è½»å¾®","Critical","Major","Minor"],t=r.toLowerCase();for(const s of e)if(t.includes(s.toLowerCase()))return s;return null}extractStatus(r){const e=["è¿›è¡Œä¸­","å·²å®Œæˆ","å¾…å¤„ç†","In Progress","Completed","Pending"],t=r.toLowerCase();for(const s of e)if(t.includes(s.toLowerCase()))return s;return null}async analyzeReport(r){try{console.log("ðŸ” å¼€å§‹åˆ†æž8DæŠ¥å‘Šå†…å®¹...");const e=await this.identify8DReport(r);if(!e.is8DReport)return console.warn("âš ï¸ æ–‡æ¡£ä¸æ˜¯æ ‡å‡†8DæŠ¥å‘Š"),{isValid:!1,confidence:e.confidence,message:"æ–‡æ¡£ä¸ç¬¦åˆ8DæŠ¥å‘Šæ ‡å‡†æ ¼å¼"};const t=this.extractDimensionData(r),s=this.validateReport(t),n={isValid:!0,confidence:e.confidence,reportInfo:{reportNumber:this.extractReportNumber(r),customer:this.extractCustomer(r),product:this.extractProduct(r),date:this.extractDate(r),severity:this.extractSeverity(r),status:this.extractStatus(r)},dimensionData:t,validation:s,suggestions:this.generateImprovementSuggestions(t,s),summary:this.generateReportSummary(t,s)};return console.log("âœ… 8DæŠ¥å‘Šåˆ†æžå®Œæˆ"),n}catch(e){throw console.error("âŒ 8DæŠ¥å‘Šåˆ†æžå¤±è´¥:",e),e}}extractDimensionData(r){const e={};return Object.keys(this.reportStructure).forEach(t=>{const s=this.reportStructure[t];e[t]=this.extractDimensionContent(r,t,s)}),e}extractDimensionContent(r,e,t){const s=t.keywords,n=[];return r.split(/\n\s*\n/).forEach((o,a)=>{const u=o.toLowerCase(),c=s.filter(l=>u.includes(l.toLowerCase()));c.length>0&&n.push({content:o.trim(),position:`æ®µè½${a+1}`,matchedKeywords:c,confidence:c.length/s.length})}),{sections:n,totalContent:n.map(o=>o.content).join(`
`),keywordMatches:n.reduce((o,a)=>o+a.matchedKeywords.length,0),confidence:n.length>0?n.reduce((o,a)=>o+a.confidence,0)/n.length:0}}validateReport(r){const e={isComplete:!0,completeness:0,dimensionScores:{},missingDimensions:[],issues:[]};let t=0;const s=Object.keys(this.reportStructure).length;return Object.keys(this.reportStructure).forEach(n=>{const i=this.reportStructure[n],o=r[n];let a=0;o.totalContent.length>50?a+=30:o.totalContent.length>20&&(a+=15),a+=o.confidence*40,o.sections.length>=2?a+=30:o.sections.length>=1&&(a+=15),e.dimensionScores[n]=Math.min(100,a),t+=e.dimensionScores[n],a<30&&(e.missingDimensions.push(n),e.issues.push(`${i.name}(${n})å†…å®¹ä¸è¶³`))}),e.completeness=t/s,e.isComplete=e.completeness>=60,e}generateReportSummary(r,e){const t=Object.keys(e.dimensionScores).filter(n=>e.dimensionScores[n]>=60),s=Object.keys(this.reportStructure).length;return{completedDimensions:t.length,totalDimensions:s,completionRate:(t.length/s*100).toFixed(1),overallQuality:e.completeness.toFixed(1),status:e.isComplete?"åŸºæœ¬å®Œæ•´":"éœ€è¦å®Œå–„",keyStrengths:this.identifyStrengths(r,e),keyWeaknesses:this.identifyWeaknesses(r,e)}}identifyStrengths(r,e){return Object.keys(e.dimensionScores).filter(t=>e.dimensionScores[t]>=80).map(t=>this.reportStructure[t].name)}identifyWeaknesses(r,e){return Object.keys(e.dimensionScores).filter(t=>e.dimensionScores[t]<60).map(t=>this.reportStructure[t].name)}generateImprovementSuggestions(r,e){const t=[];return Object.keys(this.reportStructure).forEach(s=>{const n=this.reportStructure[s],i=r[s],o=e.dimensionScores[s]||0;o<70&&t.push({dimension:s,dimensionName:n.name,priority:o<40?"high":"medium",suggestion:this.getDimensionSuggestion(s,i,n),expectedImprovement:`é¢„è®¡å¯æå‡${s}ç»´åº¦è´¨é‡${Math.min(30,100-o)}åˆ†`})}),t}getDimensionSuggestion(r,e,t){return{D1:"å»ºè®®è¡¥å……å›¢é˜Ÿæˆå‘˜çš„å…·ä½“è§’è‰²åˆ†å·¥å’Œè”ç³»æ–¹å¼ï¼Œæ˜Žç¡®å„æˆå‘˜çš„ä¸“ä¸šèƒŒæ™¯å’Œè´£ä»»èŒƒå›´",D2:"å»ºè®®è¯¦ç»†æè¿°é—®é¢˜çš„å…·ä½“çŽ°è±¡ã€å‘ç”Ÿé¢‘çŽ‡ã€å½±å“èŒƒå›´å’Œå®¢æˆ·åé¦ˆï¼Œä½¿ç”¨æ•°æ®é‡åŒ–é—®é¢˜ä¸¥é‡ç¨‹åº¦",D3:"å»ºè®®æ˜Žç¡®ä¸´æ—¶æŽªæ–½çš„å…·ä½“å®žæ–½æ­¥éª¤ã€æ—¶é—´èŠ‚ç‚¹ã€è´Ÿè´£äººå’Œæ•ˆæžœéªŒè¯æ–¹æ³•",D4:"å»ºè®®ä½¿ç”¨ç³»ç»Ÿæ€§åˆ†æžæ–¹æ³•ï¼ˆå¦‚5Whyã€é±¼éª¨å›¾ï¼‰æ·±å…¥åˆ†æžæ ¹æœ¬åŽŸå› ï¼Œå¹¶æä¾›å……åˆ†çš„éªŒè¯è¯æ®",D5:"å»ºè®®åˆ¶å®šè¯¦ç»†çš„æ°¸ä¹…çº æ­£æŽªæ–½å®žæ–½è®¡åˆ’ï¼ŒåŒ…æ‹¬æ—¶é—´è¡¨ã€èµ„æºéœ€æ±‚å’Œé¢„æœŸæ•ˆæžœ",D6:"å»ºè®®è¡¥å……æŽªæ–½å®žæ–½çš„å…·ä½“è¿›åº¦ã€éªŒè¯æµ‹è¯•ç»“æžœå’Œæ•ˆæžœè¯„ä¼°æ•°æ®",D7:"å»ºè®®å»ºç«‹ç³»ç»Ÿæ€§çš„é¢„é˜²æŽªæ–½ï¼ŒåŒ…æ‹¬æµç¨‹æ”¹è¿›ã€åŸ¹è®­è®¡åˆ’å’Œç›‘æŽ§æœºåˆ¶",D8:"å»ºè®®è¯¦ç»†è®°å½•å›¢é˜Ÿè´¡çŒ®å’Œç»éªŒæ€»ç»“ï¼Œå»ºç«‹çŸ¥è¯†åˆ†äº«æœºåˆ¶"}[r]||"å»ºè®®è¡¥å……æ›´è¯¦ç»†çš„ä¿¡æ¯å’Œæ•°æ®æ”¯æ’‘"}}const m=new h;export{h as EightDReportAnalyzer,m as default};
