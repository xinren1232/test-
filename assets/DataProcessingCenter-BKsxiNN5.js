const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/papaparse.min-MraP0q7l.js","assets/element-plus-DR-erZ3X.js"])))=>i.map(i=>d[i]);
import{S as Y,$ as K,aE as ve,Q as R,c as v,o as f,a as o,O as r,P as u,b as k,t as _,e as x,F as L,r as q,n as H,X as B,Y as he,a0 as O,A as Se,G as re,y as ge,aM as fe,H as $e,s as le,ao as ce,aq as we,aN as ye,ay as Ee,W as be,aO as de,D as me,aP as Ce,E as Te,aQ as Re,aR as pe,aS as De,aT as xe,V as Q,aj as ke,T as Fe,ax as Me,aw as Oe}from"./element-plus-DR-erZ3X.js";import{a as ue,_ as ne}from"./index-Bo1zM2q5.js";import"./echarts-Dfqt_Pbx.js";const Pe={class:"process-monitor"},Ae={class:"progress-overview"},ze={class:"card-header"},Ie={class:"overall-progress"},Ve={class:"progress-info"},je={class:"progress-percentage"},Ne={key:0,class:"time-info"},Le={class:"time-item"},qe={class:"value"},Ue={key:0,class:"time-item"},Qe={class:"value"},Be={key:1,class:"time-item"},Ye={class:"value"},We={class:"stages-flow"},Ze={class:"stages-container"},Je={class:"stage-icon"},He={class:"stage-info"},Ge={class:"stage-name"},Xe={class:"stage-description"},Ke={class:"stage-progress"},et={class:"progress-text"},tt={key:0,class:"stage-details"},st={key:0,class:"detail-item"},nt={class:"detail-value"},at={key:1,class:"detail-item"},it={class:"detail-value error"},ot={key:0,class:"stage-connector"},rt={class:"logs-section"},lt={class:"logs-header"},ct={class:"logs-controls"},ut={class:"log-time"},dt={class:"log-level"},mt={key:0,class:"log-stage"},pt={class:"log-message"},ht={key:0,class:"no-logs"},gt={class:"statistics-section"},ft={class:"stat-item"},yt={class:"stat-icon"},_t={class:"stat-content"},vt={class:"stat-value"},St={class:"stat-item"},$t={class:"stat-icon"},wt={class:"stat-content"},Et={class:"stat-value"},bt={class:"stat-item"},Ct={class:"stat-icon"},Tt={class:"stat-content"},Rt={class:"stat-value"},Dt={class:"stat-item"},xt={class:"stat-icon"},kt={class:"stat-content"},Ft={class:"stat-value"},Mt={__name:"ProcessMonitor",props:{pipeline:{type:Object,required:!0},statistics:{type:Object,default:()=>({})}},setup(c){const e=c,t=Y("all"),s=Y(null),n=K(()=>e.pipeline.getOverallProgress?e.pipeline.getOverallProgress():0),a=K(()=>e.pipeline.logs?t.value==="all"?e.pipeline.logs:e.pipeline.logs.filter(w=>w.level===t.value):[]),i=w=>({idle:"info",running:"warning",completed:"success",error:"danger"})[w]||"info",m=w=>({idle:"待开始",running:"处理中",completed:"已完成",error:"处理失败"})[w]||"未知状态",h=()=>e.pipeline.status==="error"?"exception":e.pipeline.status==="completed"?"success":null,S=w=>{var d;const l=(d=e.pipeline.stageProgress)==null?void 0:d[w];return l?{"stage-pending":l.status==="pending","stage-running":l.status==="running","stage-completed":l.status==="completed","stage-error":l.status==="error","stage-current":e.pipeline.currentStage===w}:""},M=w=>{var d;const l=(d=e.pipeline.stages)==null?void 0:d.find(b=>b.id===w);return(l==null?void 0:l.color)||"#909399"},W=w=>({upload:Ee,document:re,brush:ye,search:we,"document-copy":ce,cpu:le})[w]||re,U=w=>{var d;const l=(d=e.pipeline.stageProgress)==null?void 0:d[w];return(l==null?void 0:l.status)||"pending"},J=w=>{var d;const l=(d=e.pipeline.stageProgress)==null?void 0:d[w];return(l==null?void 0:l.progress)||0},G=w=>{var d;const l=(d=e.pipeline.stageProgress)==null?void 0:d[w];return(l==null?void 0:l.status)==="error"?"exception":(l==null?void 0:l.status)==="completed"?"success":null},j=w=>{var l;return((l=e.pipeline.stageProgress)==null?void 0:l[w])||{}},X=w=>{var d;const l=(d=e.pipeline.stageProgress)==null?void 0:d[w];return(l==null?void 0:l.status)==="completed"},N=w=>{var d;const l=(d=e.pipeline.stages)==null?void 0:d.find(b=>b.id===w);return(l==null?void 0:l.name)||w},ee=w=>w?new Date(w).toLocaleString():"-",te=w=>{if(!w)return"-";const l=Math.floor(w/1e3),d=Math.floor(l/60),b=Math.floor(d/60);return b>0?`${b}h ${d%60}m ${l%60}s`:d>0?`${d}m ${l%60}s`:`${l}s`},ae=w=>new Date(w).toLocaleTimeString(),ie=()=>{e.pipeline.logs&&(e.pipeline.logs.length=0)},oe=()=>{const w=a.value.map(g=>`${ee(g.time)} [${g.level.toUpperCase()}] ${g.stage?"["+N(g.stage)+"] ":""}${g.message}`).join(`
`),l=new Blob([w],{type:"text/plain"}),d=URL.createObjectURL(l),b=document.createElement("a");b.href=d,b.download=`processing-logs-${new Date().toISOString().slice(0,19)}.txt`,b.click(),URL.revokeObjectURL(d)};return ve(()=>{var w;return(w=e.pipeline.logs)==null?void 0:w.length},()=>{be(()=>{s.value&&(s.value.scrollTop=s.value.scrollHeight)})}),(w,l)=>{const d=R("el-tag"),b=R("el-progress"),g=R("el-card"),p=R("el-icon"),E=R("el-option"),C=R("el-select"),P=R("el-button"),F=R("el-empty"),D=R("el-col"),z=R("el-row");return f(),v("div",Pe,[o("div",Ae,[r(g,{class:"overview-card"},{header:u(()=>[o("div",ze,[l[1]||(l[1]=o("h3",null,"数据处理流程",-1)),r(d,{type:i(c.pipeline.status),size:"large"},{default:u(()=>[x(_(m(c.pipeline.status)),1)]),_:1},8,["type"])])]),default:u(()=>[o("div",Ie,[o("div",Ve,[l[2]||(l[2]=o("span",{class:"progress-label"},"整体进度",-1)),o("span",je,_(n.value)+"%",1)]),r(b,{percentage:n.value,status:h(),"stroke-width":12,"show-text":!1},null,8,["percentage","status"])]),c.pipeline.startTime?(f(),v("div",Ne,[o("div",Le,[l[3]||(l[3]=o("span",{class:"label"},"开始时间:",-1)),o("span",qe,_(ee(c.pipeline.startTime)),1)]),c.pipeline.endTime?(f(),v("div",Ue,[l[4]||(l[4]=o("span",{class:"label"},"结束时间:",-1)),o("span",Qe,_(ee(c.pipeline.endTime)),1)])):k("",!0),c.pipeline.duration?(f(),v("div",Be,[l[5]||(l[5]=o("span",{class:"label"},"总耗时:",-1)),o("span",Ye,_(te(c.pipeline.duration)),1)])):k("",!0)])):k("",!0)]),_:1})]),o("div",We,[r(g,{class:"stages-card"},{header:u(()=>l[6]||(l[6]=[o("h3",null,"处理阶段",-1)])),default:u(()=>[o("div",Ze,[(f(!0),v(L,null,q(c.pipeline.stages,(T,$)=>(f(),v("div",{key:T.id,class:H(["stage-item",S(T.id)])},[o("div",Je,[r(p,{size:24,color:M(T.id)},{default:u(()=>[(f(),B(he(W(T.icon))))]),_:2},1032,["color"]),o("div",{class:H(["stage-status-indicator",U(T.id)])},null,2)]),o("div",He,[o("h4",Ge,_(T.name),1),o("p",Xe,_(T.description),1),o("div",Ke,[r(b,{percentage:J(T.id),status:G(T.id),"stroke-width":6,"show-text":!1},null,8,["percentage","status"]),o("span",et,_(J(T.id))+"%",1)]),j(T.id)?(f(),v("div",tt,[j(T.id).duration?(f(),v("div",st,[l[7]||(l[7]=o("span",{class:"detail-label"},"耗时:",-1)),o("span",nt,_(te(j(T.id).duration)),1)])):k("",!0),j(T.id).error?(f(),v("div",at,[l[8]||(l[8]=o("span",{class:"detail-label"},"错误:",-1)),o("span",it,_(j(T.id).error),1)])):k("",!0)])):k("",!0)]),$<c.pipeline.stages.length-1?(f(),v("div",ot,[o("div",{class:H(["connector-line",{active:X(T.id)}])},null,2),r(p,{class:"connector-arrow",color:X(T.id)?"#67C23A":"#DCDFE6"},{default:u(()=>[r(O(Se))]),_:2},1032,["color"])])):k("",!0)],2))),128))])]),_:1})]),o("div",rt,[r(g,{class:"logs-card"},{header:u(()=>[o("div",lt,[l[11]||(l[11]=o("h3",null,"处理日志",-1)),o("div",ct,[r(C,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=T=>t.value=T),placeholder:"日志级别",size:"small",style:{width:"120px"}},{default:u(()=>[r(E,{label:"全部",value:"all"}),r(E,{label:"信息",value:"info"}),r(E,{label:"警告",value:"warn"}),r(E,{label:"错误",value:"error"}),r(E,{label:"成功",value:"success"})]),_:1},8,["modelValue"]),r(P,{onClick:ie,size:"small",type:"danger",plain:""},{default:u(()=>l[9]||(l[9]=[x("清空日志")])),_:1,__:[9]}),r(P,{onClick:oe,size:"small",type:"primary",plain:""},{default:u(()=>l[10]||(l[10]=[x("导出日志")])),_:1,__:[10]})])])]),default:u(()=>[o("div",{class:"logs-container",ref_key:"logsContainer",ref:s},[(f(!0),v(L,null,q(a.value,(T,$)=>(f(),v("div",{key:$,class:H(["log-item",T.level])},[o("span",ut,_(ae(T.time)),1),o("span",dt,_(T.level.toUpperCase()),1),T.stage?(f(),v("span",mt,"["+_(N(T.stage))+"]",1)):k("",!0),o("span",pt,_(T.message),1)],2))),128)),a.value.length===0?(f(),v("div",ht,[r(F,{description:"暂无日志","image-size":60})])):k("",!0)],512)]),_:1})]),o("div",gt,[r(z,{gutter:16},{default:u(()=>[r(D,{span:6},{default:u(()=>[r(g,{class:"stat-card"},{default:u(()=>[o("div",ft,[o("div",yt,[r(p,{size:32,color:"#409EFF"},{default:u(()=>[r(O(re))]),_:1})]),o("div",_t,[o("div",vt,_(c.statistics.recordsProcessed||0),1),l[12]||(l[12]=o("div",{class:"stat-label"},"已处理记录",-1))])])]),_:1})]),_:1}),r(D,{span:6},{default:u(()=>[r(g,{class:"stat-card"},{default:u(()=>[o("div",St,[o("div",$t,[r(p,{size:32,color:"#67C23A"},{default:u(()=>[r(O(ge))]),_:1})]),o("div",wt,[o("div",Et,_(c.statistics.qualityScore||0)+"%",1),l[13]||(l[13]=o("div",{class:"stat-label"},"数据质量分数",-1))])])]),_:1})]),_:1}),r(D,{span:6},{default:u(()=>[r(g,{class:"stat-card"},{default:u(()=>[o("div",bt,[o("div",Ct,[r(p,{size:32,color:"#E6A23C"},{default:u(()=>[r(O(fe))]),_:1})]),o("div",Tt,[o("div",Rt,_(te(c.statistics.totalTime||0)),1),l[14]||(l[14]=o("div",{class:"stat-label"},"总处理时间",-1))])])]),_:1})]),_:1}),r(D,{span:6},{default:u(()=>[r(g,{class:"stat-card"},{default:u(()=>[o("div",Dt,[o("div",xt,[r(p,{size:32,color:"#F56C6C"},{default:u(()=>[r(O($e))]),_:1})]),o("div",kt,[o("div",Ft,_(c.statistics.issuesFound||0),1),l[15]||(l[15]=o("div",{class:"stat-label"},"发现问题",-1))])])]),_:1})]),_:1})]),_:1})])])}}},Ot=ue(Mt,[["__scopeId","data-v-5c80af35"]]),Pt={class:"processing-results"},At={class:"metric-content"},zt={class:"metric-icon"},It={class:"metric-info"},Vt={class:"metric-value"},jt={class:"metric-content"},Nt={class:"metric-icon"},Lt={class:"metric-info"},qt={class:"metric-value"},Ut={class:"metric-content"},Qt={class:"metric-icon"},Bt={class:"metric-info"},Yt={class:"metric-value"},Wt={class:"metric-content"},Zt={class:"metric-icon"},Jt={class:"metric-info"},Ht={class:"metric-value"},Gt={class:"card-header"},Xt={class:"insights-content"},Kt={key:0,class:"insights-list"},es={class:"insight-header"},ts={class:"insight-title"},ss={class:"insight-description"},ns={key:0,class:"insight-recommendations"},as={class:"card-header"},is={class:"summary-content"},os={key:0,class:"executive-summary"},rs={class:"summary-section"},ls={key:0,class:"summary-section"},cs={class:"findings-list"},us={key:1,class:"summary-section"},ds={class:"recommendations-list"},ms={key:2,class:"summary-section"},ps={class:"next-steps-list"},hs={key:3,class:"summary-section"},gs={class:"business-impact"},fs={class:"impact-item"},ys={class:"impact-item"},_s={class:"impact-description"},vs={class:"card-header"},Ss={class:"recommendations-filter"},$s={class:"recommendations-content"},ws={key:0,class:"recommendations-list"},Es={class:"recommendation-header"},bs={class:"rec-title-section"},Cs={class:"rec-title"},Ts={class:"rec-meta"},Rs={key:1,class:"rec-confidence"},Ds={class:"rec-description"},xs={key:0,class:"rec-details"},ks={key:0,class:"rec-impact"},Fs={key:1,class:"rec-timeline"},Ms={key:2,class:"rec-suggestions"},Os={class:"suggestions-grid"},Ps={class:"suggestion-header"},As={class:"suggestion-action"},zs={class:"suggestion-badges"},Is={class:"suggestion-description"},Vs={class:"results-actions"},js={__name:"ProcessingResults",props:{results:{type:Object,required:!0}},emits:["download","export","share","restart"],setup(c,{emit:e}){const t=c,s=e,n=Y("all"),a=Y([]),i=K(()=>{var l;return((l=t.results.results)==null?void 0:l.ai_analysis)||{}}),m=K(()=>{const l=i.value.aiRecommendations||[];return n.value==="all"?l:l.filter(d=>d.priority===n.value)}),h=l=>{if(!l)return"-";const d=Math.floor(l/1e3),b=Math.floor(d/60),g=Math.floor(b/60);return g>0?`${g}h ${b%60}m`:b>0?`${b}m ${d%60}s`:`${d}s`},S=l=>({success:xe,warning:De,info:pe,error:Re})[l]||pe,M=l=>({success:"success",warning:"warning",info:"info",error:"danger"})[l]||"info",W=l=>({high:"success",medium:"warning",low:"info"})[l]||"info",U=l=>({high:"高价值",medium:"中等价值",low:"低价值"})[l]||l,J=l=>({high:"danger",medium:"warning",low:"info"})[l]||"info",G=l=>({high:"高优先级",medium:"中优先级",low:"低优先级"})[l]||l,j=l=>({performance:"性能优化",quality:"质量提升",insights:"洞察分析",architecture:"架构优化",general:"通用建议"})[l]||l,X=l=>({low:"简单",medium:"中等",high:"困难"})[l]||l,N=l=>({low:"低成本",medium:"中等成本",high:"高成本"})[l]||l,ee=l=>{const d=a.value.indexOf(l);d>-1?a.value.splice(d,1):a.value.push(l)},te=()=>{var E,C,P,F;const l=i.value.executiveSummary;if(!l){Q.warning("暂无执行摘要可导出");return}const d=`
数据处理执行摘要

概览：
${l.overview}

关键发现：
${((E=l.keyFindings)==null?void 0:E.map(D=>`• ${D}`).join(`
`))||"无"}

主要建议：
${((C=l.recommendations)==null?void 0:C.map(D=>`• ${D}`).join(`
`))||"无"}

下一步行动：
${((P=l.nextSteps)==null?void 0:P.map((D,z)=>`${z+1}. ${D}`).join(`
`))||"无"}

业务影响：
${((F=l.businessImpact)==null?void 0:F.description)||"无"}
  `.trim(),b=new Blob([d],{type:"text/plain;charset=utf-8"}),g=URL.createObjectURL(b),p=document.createElement("a");p.href=g,p.download=`executive-summary-${new Date().toISOString().slice(0,19)}.txt`,p.click(),URL.revokeObjectURL(g)},ae=()=>{s("download")},ie=()=>{s("export")},oe=()=>{s("share")},w=()=>{s("restart")};return(l,d)=>{const b=R("el-icon"),g=R("el-card"),p=R("el-col"),E=R("el-row"),C=R("el-tag"),P=R("el-empty"),F=R("el-button"),D=R("Lightbulb"),z=R("el-option"),T=R("el-select");return f(),v("div",Pt,[r(E,{gutter:20,class:"results-overview"},{default:u(()=>[r(p,{span:6},{default:u(()=>[r(g,{class:"metric-card success"},{default:u(()=>{var $;return[o("div",At,[o("div",zt,[r(b,{size:32},{default:u(()=>[r(O(ge))]),_:1})]),o("div",It,[o("div",Vt,_((($=c.results.summary)==null?void 0:$.finalDataCount)||0),1),d[1]||(d[1]=o("div",{class:"metric-label"},"处理记录数",-1))])])]}),_:1})]),_:1}),r(p,{span:6},{default:u(()=>[r(g,{class:"metric-card primary"},{default:u(()=>{var $;return[o("div",jt,[o("div",Nt,[r(b,{size:32},{default:u(()=>[r(O(de))]),_:1})]),o("div",Lt,[o("div",qt,_((($=c.results.summary)==null?void 0:$.qualityScore)||0)+"%",1),d[2]||(d[2]=o("div",{class:"metric-label"},"质量分数",-1))])])]}),_:1})]),_:1}),r(p,{span:6},{default:u(()=>[r(g,{class:"metric-card warning"},{default:u(()=>{var $;return[o("div",Ut,[o("div",Qt,[r(b,{size:32},{default:u(()=>[r(O(fe))]),_:1})]),o("div",Bt,[o("div",Yt,_(h(($=c.results.summary)==null?void 0:$.totalDuration)),1),d[3]||(d[3]=o("div",{class:"metric-label"},"处理时间",-1))])])]}),_:1})]),_:1}),r(p,{span:6},{default:u(()=>[r(g,{class:"metric-card info"},{default:u(()=>{var $;return[o("div",Wt,[o("div",Zt,[r(b,{size:32},{default:u(()=>[r(O(le))]),_:1})]),o("div",Jt,[o("div",Ht,_((($=c.results.summary)==null?void 0:$.overallProgress)||0)+"%",1),d[4]||(d[4]=o("div",{class:"metric-label"},"完成进度",-1))])])]}),_:1})]),_:1})]),_:1}),r(E,{gutter:20,class:"detailed-results"},{default:u(()=>[r(p,{span:12},{default:u(()=>[r(g,{class:"insights-card"},{header:u(()=>[o("div",Gt,[o("h3",null,[r(b,null,{default:u(()=>[r(O(de))]),_:1}),d[5]||(d[5]=x(" AI分析洞察 "))]),r(C,{type:"success",size:"small"},{default:u(()=>{var $;return[x(" 置信度: "+_(Math.round(((($=i.value)==null?void 0:$.confidence)||.8)*100))+"% ",1)]}),_:1})])]),default:u(()=>{var $,V;return[o("div",Xt,[((V=($=i.value)==null?void 0:$.dataInsights)==null?void 0:V.length)>0?(f(),v("div",Kt,[(f(!0),v(L,null,q(i.value.dataInsights,(A,I)=>{var y;return f(),v("div",{key:I,class:H(["insight-item",A.level])},[o("div",es,[r(b,{class:"insight-icon"},{default:u(()=>[(f(),B(he(S(A.level))))]),_:2},1024),o("span",ts,_(A.title),1),A.confidence?(f(),B(C,{key:0,type:M(A.level),size:"small"},{default:u(()=>[x(_(Math.round(A.confidence*100))+"% ",1)]),_:2},1032,["type"])):k("",!0)]),o("p",ss,_(A.description),1),((y=A.recommendations)==null?void 0:y.length)>0?(f(),v("div",ns,[d[6]||(d[6]=o("h5",null,"建议行动:",-1)),o("ul",null,[(f(!0),v(L,null,q(A.recommendations,Z=>(f(),v("li",{key:Z},_(Z),1))),128))])])):k("",!0)],2)}),128))])):(f(),B(P,{key:1,description:"暂无AI洞察","image-size":80}))])]}),_:1})]),_:1}),r(p,{span:12},{default:u(()=>[r(g,{class:"summary-card"},{header:u(()=>[o("div",as,[o("h3",null,[r(b,null,{default:u(()=>[r(O(re))]),_:1}),d[7]||(d[7]=x(" 执行摘要 "))]),r(F,{type:"primary",size:"small",onClick:te},{default:u(()=>[r(b,null,{default:u(()=>[r(O(me))]),_:1}),d[8]||(d[8]=x(" 导出 "))]),_:1,__:[8]})])]),default:u(()=>{var $,V,A,I;return[o("div",is,[($=i.value)!=null&&$.executiveSummary?(f(),v("div",os,[o("div",rs,[d[9]||(d[9]=o("h4",null,"概览",-1)),o("p",null,_(i.value.executiveSummary.overview),1)]),((V=i.value.executiveSummary.keyFindings)==null?void 0:V.length)>0?(f(),v("div",ls,[d[10]||(d[10]=o("h4",null,"关键发现",-1)),o("ul",cs,[(f(!0),v(L,null,q(i.value.executiveSummary.keyFindings,y=>(f(),v("li",{key:y},_(y),1))),128))])])):k("",!0),((A=i.value.executiveSummary.recommendations)==null?void 0:A.length)>0?(f(),v("div",us,[d[11]||(d[11]=o("h4",null,"主要建议",-1)),o("ul",ds,[(f(!0),v(L,null,q(i.value.executiveSummary.recommendations,y=>(f(),v("li",{key:y},_(y),1))),128))])])):k("",!0),((I=i.value.executiveSummary.nextSteps)==null?void 0:I.length)>0?(f(),v("div",ms,[d[12]||(d[12]=o("h4",null,"下一步行动",-1)),o("ol",ps,[(f(!0),v(L,null,q(i.value.executiveSummary.nextSteps,y=>(f(),v("li",{key:y},_(y),1))),128))])])):k("",!0),i.value.executiveSummary.businessImpact?(f(),v("div",hs,[d[15]||(d[15]=o("h4",null,"业务影响",-1)),o("div",gs,[o("div",fs,[d[13]||(d[13]=o("span",{class:"impact-label"},"当前价值:",-1)),r(C,{type:W(i.value.executiveSummary.businessImpact.current)},{default:u(()=>[x(_(U(i.value.executiveSummary.businessImpact.current)),1)]),_:1},8,["type"])]),o("div",ys,[d[14]||(d[14]=o("span",{class:"impact-label"},"潜在价值:",-1)),r(C,{type:W(i.value.executiveSummary.businessImpact.potential)},{default:u(()=>[x(_(U(i.value.executiveSummary.businessImpact.potential)),1)]),_:1},8,["type"])]),o("p",_s,_(i.value.executiveSummary.businessImpact.description),1)])])):k("",!0)])):(f(),B(P,{key:1,description:"暂无执行摘要","image-size":80}))])]}),_:1})]),_:1})]),_:1}),r(E,{gutter:20,class:"recommendations-section"},{default:u(()=>[r(p,{span:24},{default:u(()=>[r(g,{class:"recommendations-card"},{header:u(()=>[o("div",vs,[o("h3",null,[r(b,null,{default:u(()=>[r(D)]),_:1}),d[16]||(d[16]=x(" AI智能建议 "))]),o("div",Ss,[r(T,{modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=$=>n.value=$),placeholder:"优先级筛选",size:"small",style:{width:"120px"}},{default:u(()=>[r(z,{label:"全部",value:"all"}),r(z,{label:"高优先级",value:"high"}),r(z,{label:"中优先级",value:"medium"}),r(z,{label:"低优先级",value:"low"})]),_:1},8,["modelValue"])])])]),default:u(()=>[o("div",$s,[m.value.length>0?(f(),v("div",ws,[(f(!0),v(L,null,q(m.value,($,V)=>{var A;return f(),v("div",{key:V,class:H(["recommendation-item",$.priority])},[o("div",Es,[o("div",bs,[o("h4",Cs,_($.title),1),o("div",Ts,[r(C,{type:J($.priority),size:"small"},{default:u(()=>[x(_(G($.priority)),1)]),_:2},1032,["type"]),$.category?(f(),B(C,{key:0,type:"info",size:"small"},{default:u(()=>[x(_(j($.category)),1)]),_:2},1024)):k("",!0),$.confidence?(f(),v("span",Rs," 置信度: "+_(Math.round($.confidence*100))+"% ",1)):k("",!0)])]),r(F,{type:"primary",size:"small",onClick:I=>ee(V),icon:a.value.includes(V)?"ArrowUp":"ArrowDown"},{default:u(()=>[x(_(a.value.includes(V)?"收起":"详情"),1)]),_:2},1032,["onClick","icon"])]),o("p",Ds,_($.description),1),a.value.includes(V)?(f(),v("div",xs,[$.estimatedImpact?(f(),v("div",ks,[d[17]||(d[17]=o("strong",null,"预期影响:",-1)),x(" "+_($.estimatedImpact),1)])):k("",!0),$.timeToImplement?(f(),v("div",Fs,[d[18]||(d[18]=o("strong",null,"实施周期:",-1)),x(" "+_($.timeToImplement),1)])):k("",!0),((A=$.suggestions)==null?void 0:A.length)>0?(f(),v("div",Ms,[d[19]||(d[19]=o("h5",null,"具体建议:",-1)),o("div",Os,[(f(!0),v(L,null,q($.suggestions,(I,y)=>(f(),v("div",{key:y,class:"suggestion-item"},[o("div",Ps,[o("span",As,_(I.action),1),o("div",zs,[I.difficulty?(f(),B(C,{key:0,size:"small"},{default:u(()=>[x(_(X(I.difficulty)),1)]),_:2},1024)):k("",!0),I.cost?(f(),B(C,{key:1,type:"warning",size:"small"},{default:u(()=>[x(_(N(I.cost)),1)]),_:2},1024)):k("",!0)])]),o("p",Is,_(I.description),1)]))),128))])])):k("",!0)])):k("",!0)],2)}),128))])):(f(),B(P,{key:1,description:"暂无AI建议","image-size":80}))])]),_:1})]),_:1})]),_:1}),o("div",Vs,[r(F,{type:"primary",size:"large",onClick:ae},{default:u(()=>[r(b,null,{default:u(()=>[r(O(me))]),_:1}),d[20]||(d[20]=x(" 下载完整报告 "))]),_:1,__:[20]}),r(F,{size:"large",onClick:ie},{default:u(()=>[r(b,null,{default:u(()=>[r(O(ce))]),_:1}),d[21]||(d[21]=x(" 导出Excel "))]),_:1,__:[21]}),r(F,{size:"large",onClick:oe},{default:u(()=>[r(b,null,{default:u(()=>[r(O(Ce))]),_:1}),d[22]||(d[22]=x(" 分享结果 "))]),_:1,__:[22]}),r(F,{type:"success",size:"large",onClick:w},{default:u(()=>[r(b,null,{default:u(()=>[r(O(Te))]),_:1}),d[23]||(d[23]=x(" 重新处理 "))]),_:1,__:[23]})])])}}},Ns=ue(js,[["__scopeId","data-v-7ed07a20"]]),se={REMOVE_EMPTY:{id:"remove_empty",name:"去除空值",description:"移除空白、null、undefined等无效数据",category:"basic",apply:c=>c.filter(e=>Object.values(e).some(t=>t!=null&&t!==""&&String(t).trim()!==""))},TRIM_WHITESPACE:{id:"trim_whitespace",name:"去除空白字符",description:"移除字段值前后的空白字符",category:"basic",apply:c=>c.map(e=>{const t={};return Object.keys(e).forEach(s=>{const n=e[s];t[s]=typeof n=="string"?n.trim():n}),t})},REMOVE_DUPLICATES:{id:"remove_duplicates",name:"去除重复数据",description:"基于关键字段去除重复记录",category:"basic",apply:(c,e={})=>{const t=e.keyFields||["materialCode","id"],s=new Set;return c.filter(n=>{const a=t.map(i=>n[i]).join("|");return s.has(a)?!1:(s.add(a),!0)})}},STANDARDIZE_TERMS:{id:"standardize_terms",name:"术语标准化",description:"统一术语和表达方式",category:"advanced",apply:c=>{const e={质量问题:"质量异常",品质问题:"质量异常",不良:"质量异常",缺陷:"质量异常",已解决:"已完成",已处理:"已完成",完成:"已完成",待处理:"进行中",处理中:"进行中",品质部:"质量部",品管部:"质量部",QC:"质量部",QA:"质量部"};return c.map(t=>{const s={};return Object.keys(t).forEach(n=>{let a=t[n];typeof a=="string"&&Object.keys(e).forEach(i=>{a=a.replace(new RegExp(i,"g"),e[i])}),s[n]=a}),s})}},FORMAT_DATE:{id:"format_date",name:"日期格式化",description:"统一日期格式为 YYYY-MM-DD",category:"format",apply:c=>{const e=["date","createTime","updateTime","occurTime","solveTime"];return c.map(t=>{const s={...t};return e.forEach(n=>{s[n]&&(s[n]=Ls(s[n]))}),s})}},FORMAT_NUMBER:{id:"format_number",name:"数值格式化",description:"统一数值格式，保留适当小数位",category:"format",apply:c=>{const e=["quantity","amount","rate","percentage","score"];return c.map(t=>{const s={...t};return e.forEach(n=>{s[n]&&!isNaN(s[n])&&(s[n]=parseFloat(s[n]).toFixed(2))}),s})}},EXTRACT_KEYWORDS:{id:"extract_keywords",name:"关键词提取",description:"从描述性文本中提取关键词",category:"advanced",apply:c=>{const e=["description","analysis","solution","remark"];return c.map(t=>{const s={...t};return e.forEach(n=>{s[n]&&(s[`${n}_keywords`]=qs(s[n]))}),s})}},VALIDATE_REQUIRED:{id:"validate_required",name:"必填字段验证",description:"验证必填字段的完整性",category:"validation",apply:(c,e={})=>{const t=e.requiredFields||["materialCode","materialName"];return c.map(s=>{const n={...s};return n._validation={isValid:!0,missingFields:[]},t.forEach(a=>{(!n[a]||String(n[a]).trim()==="")&&(n._validation.isValid=!1,n._validation.missingFields.push(a))}),n})}},NORMALIZE_PHONE:{id:"normalize_phone",name:"电话号码标准化",description:"统一电话号码格式",category:"format",apply:c=>{const e=["phone","mobile","telephone","contact"];return c.map(t=>{const s={...t};return e.forEach(n=>{s[n]&&(s[n]=Us(s[n]))}),s})}},NORMALIZE_EMAIL:{id:"normalize_email",name:"邮箱地址标准化",description:"统一邮箱地址格式",category:"format",apply:c=>{const e=["email","mail","emailAddress","contactEmail"];return c.map(t=>{const s={...t};return e.forEach(n=>{s[n]&&(s[n]=Qs(s[n]))}),s})}},VALIDATE_EMAIL:{id:"validate_email",name:"邮箱格式验证",description:"验证邮箱地址格式的有效性",category:"validation",apply:c=>{const e=["email","mail","emailAddress","contactEmail"];return c.filter(t=>{let s=!0;return e.forEach(n=>{t[n]&&!Bs(t[n])&&(s=!1)}),s})}},STANDARDIZE_CURRENCY:{id:"standardize_currency",name:"货币格式标准化",description:"统一货币金额格式",category:"format",apply:c=>{const e=["price","amount","cost","value","salary"];return c.map(t=>{const s={...t};return e.forEach(n=>{s[n]&&(s[n]=Ys(s[n]))}),s})}},REMOVE_OUTLIERS:{id:"remove_outliers",name:"移除异常值",description:"基于统计方法移除数值异常值",category:"advanced",apply:(c,e={})=>{const t=e.numericFields||["price","amount","quantity","score"],s=e.method||"iqr",n=e.threshold||1.5;return c.filter(a=>{let i=!0;return t.forEach(m=>{if(a[m]&&!isNaN(parseFloat(a[m]))){const h=parseFloat(a[m]);if(s==="iqr"){const S=c.map(j=>parseFloat(j[m])).filter(j=>!isNaN(j)).sort((j,X)=>j-X),M=S[Math.floor(S.length*.25)],W=S[Math.floor(S.length*.75)],U=W-M,J=M-n*U,G=W+n*U;(h<J||h>G)&&(i=!1)}}}),i})}},GEOCODE_ADDRESS:{id:"geocode_address",name:"地址地理编码",description:"将地址转换为经纬度坐标",category:"advanced",apply:(c,e={})=>{const t=e.addressFields||["address","location","addr"];return c.map(s=>{const n={...s};return t.forEach(a=>{if(n[a]){const i=Ws(n[a]);n[`${a}_lat`]=i.lat,n[`${a}_lng`]=i.lng}}),n})}},CATEGORIZE_TEXT:{id:"categorize_text",name:"文本自动分类",description:"基于关键词对文本进行自动分类",category:"advanced",apply:(c,e={})=>{const t=e.textFields||["description","content","remark"],s=e.categories||{技术:["技术","系统","软件","硬件","网络"],质量:["质量","缺陷","不良","检验","测试"],服务:["服务","客户","支持","咨询","投诉"],其他:[]};return c.map(n=>{const a={...n};return t.forEach(i=>{a[i]&&(a[`${i}_category`]=Zs(a[i],s))}),a})}},MERGE_SIMILAR_RECORDS:{id:"merge_similar_records",name:"合并相似记录",description:"基于相似度合并重复或相似的记录",category:"advanced",apply:(c,e={})=>{const t=e.keyFields||["name","code","id"],s=e.threshold||.8,n=[],a=new Set;return c.forEach((i,m)=>{if(a.has(m))return;const h=[];for(let S=m+1;S<c.length;S++){if(a.has(S))continue;Js(i,c[S],t)>=s&&(h.push(S),a.add(S))}if(h.length>0){const S=Xs([i,...h.map(M=>c[M])]);n.push(S)}else n.push(i);a.add(m)}),n}},ENRICH_DATA:{id:"enrich_data",name:"数据增强",description:"基于现有数据生成额外的有用字段",category:"advanced",apply:(c,e={})=>c.map(t=>{const s={...t};return s.firstName&&s.lastName&&(s.fullName=`${s.firstName} ${s.lastName}`),s.birthDate&&(s.age=Ks(s.birthDate)),!s.id&&(s.name||s.code)&&(s.id=en(s.name||s.code)),s._processedAt=new Date().toISOString(),s})}};class _e{constructor(){this.rules={...se},this.logs=[],this.statistics={originalCount:0,processedCount:0,removedCount:0,modifiedCount:0,qualityScore:0},this.analysisResults={fieldAnalysis:{},duplicateAnalysis:{},dataQualityIssues:[],recommendations:[]}}async analyzeData(e){this.log("info",`开始数据预分析，数据量: ${e.length}`);const t={fieldAnalysis:this.analyzeFields(e),duplicateAnalysis:this.analyzeDuplicates(e),dataTypeAnalysis:this.analyzeDataTypes(e),qualityIssues:this.identifyQualityIssues(e),statisticalSummary:this.generateStatisticalSummary(e),recommendations:[]};return t.recommendations=this.generateAnalysisRecommendations(t),this.analysisResults=t,this.log("info","数据预分析完成"),t}analyzeFields(e){if(e.length===0)return{};const t={},s=new Set;return e.forEach(n=>{Object.keys(n).forEach(a=>s.add(a))}),s.forEach(n=>{const a=e.map(i=>i[n]).filter(i=>i!==void 0);t[n]={totalRecords:e.length,filledRecords:a.filter(i=>this.isValueFilled(i)).length,emptyRecords:a.filter(i=>!this.isValueFilled(i)).length,missingRecords:e.length-a.length,completenessRate:this.calculateCompletenessRate(a,e.length),dataTypes:this.analyzeFieldDataTypes(a),uniqueValues:new Set(a.filter(i=>this.isValueFilled(i))).size,duplicateValues:this.findDuplicateValues(a),valueDistribution:this.analyzeValueDistribution(a),qualityIssues:this.identifyFieldQualityIssues(n,a),formatConsistency:this.analyzeFormatConsistency(a),statistics:this.calculateFieldStatistics(a)}}),t}analyzeDuplicates(e){const t={totalRecords:e.length,uniqueRecords:0,duplicateRecords:0,duplicateGroups:[],duplicateFields:{},similarRecords:[]},s=new Map,n=[];return e.forEach((a,i)=>{const m=JSON.stringify(this.normalizeRecord(a));s.has(m)?s.get(m).push({index:i,record:a}):s.set(m,[{index:i,record:a}])}),s.forEach((a,i)=>{a.length>1&&n.push({key:i,count:a.length,records:a,similarity:100})}),t.duplicateGroups=n,t.duplicateRecords=n.reduce((a,i)=>a+i.count-1,0),t.uniqueRecords=e.length-t.duplicateRecords,e.length>0&&Object.keys(e[0]).forEach(a=>{t.duplicateFields[a]=this.analyzeFieldDuplicates(e,a)}),t.similarRecords=this.findSimilarRecords(e),t}analyzeDataTypes(e){const t={};return e.length===0||Object.keys(e[0]).forEach(s=>{const n=e.map(a=>a[s]).filter(a=>this.isValueFilled(a));t[s]={detectedType:this.detectDataType(n),typeDistribution:this.getTypeDistribution(n),typeConsistency:this.calculateTypeConsistency(n),conversionSuggestions:this.suggestTypeConversions(n)}}),t}identifyQualityIssues(e){const t=[],s=this.checkDataCompleteness(e);t.push(...s);const n=this.checkDataConsistency(e);t.push(...n);const a=this.checkDataAccuracy(e);t.push(...a);const i=this.checkDataValidity(e);t.push(...i);const m=this.detectOutliers(e);return t.push(...m),t}generateStatisticalSummary(e){return{totalRecords:e.length,totalFields:e.length>0?Object.keys(e[0]).length:0,dataSize:this.calculateDataSize(e),recordCompleteness:this.calculateOverallCompleteness(e),dataQualityScore:this.calculateDataQualityScore(e),fieldTypes:this.summarizeFieldTypes(e),valueRanges:this.summarizeValueRanges(e)}}registerRule(e){this.rules[e.id.toUpperCase()]=e,this.log("info",`注册自定义规则: ${e.name}`)}async applyRules(e,t,s={}){this.log("info",`开始数据清洗，原始记录数: ${e.length}`),this.statistics.originalCount=e.length;let n=[...e],a=0;for(const i of t){const m=this.rules[i.toUpperCase()];if(!m){this.log("warn",`未找到清洗规则: ${i}`);continue}try{const h=n.length,S=JSON.stringify(n);n=m.apply(n,s[i]);const M=n.length,W=JSON.stringify(n),U=h-M,J=S!==W;U>0&&(this.statistics.removedCount+=U,this.log("info",`规则 ${m.name} 移除了 ${U} 条记录`)),J&&(a++,this.log("info",`规则 ${m.name} 修改了数据内容`)),this.log("info",`应用规则: ${m.name}`),await new Promise(G=>setTimeout(G,100))}catch(h){this.log("error",`规则 ${m.name} 执行失败: ${h.message}`)}}return this.statistics.processedCount=n.length,this.statistics.modifiedCount=a,this.statistics.qualityScore=this.calculateQualityScore(n),this.log("info",`数据清洗完成，处理后记录数: ${n.length}`),{data:n,statistics:this.statistics,logs:this.logs}}calculateQualityScore(e){if(e.length===0)return 0;let t=0;const s={completeness:.4,accuracy:.3,consistency:.3},n=this.calculateCompleteness(e),a=this.calculateAccuracy(e),i=this.calculateConsistency(e);return t=n*s.completeness+a*s.accuracy+i*s.consistency,Math.round(t)}calculateCompleteness(e){const t=["materialCode","materialName","supplier"];let s=0,n=0;return e.forEach(a=>{t.forEach(i=>{s++,a[i]&&String(a[i]).trim()!==""&&n++})}),s>0?n/s*100:0}calculateAccuracy(e){let t=0;return e.forEach(s=>{let n=!0;s.materialCode&&!/^[A-Z]{2,3}-[A-Z0-9]{4,6}$/.test(s.materialCode)&&(n=!1),s.date&&!/^\d{4}-\d{2}-\d{2}$/.test(s.date)&&(n=!1),n&&t++}),e.length>0?t/e.length*100:0}calculateConsistency(e){const t=this.findTermVariations(e),s=Math.max(1,e.length*.1),n=Object.keys(t).length;return Math.max(0,(s-n)/s)*100}findTermVariations(e){const t={},s=["issueType","status","department"];return e.forEach(n=>{s.forEach(a=>{if(n[a]){const i=String(n[a]).toLowerCase();t[a]||(t[a]=new Set),t[a].add(i)}})}),t}log(e,t){const s={time:new Date().toISOString(),level:e,message:t,category:"cleaning"};this.logs.push(s),console.log(`[${e.toUpperCase()}] ${t}`)}getStatistics(){return{...this.statistics,efficiency:this.statistics.originalCount>0?Math.round(this.statistics.processedCount/this.statistics.originalCount*100):0}}reset(){this.logs=[],this.statistics={originalCount:0,processedCount:0,removedCount:0,modifiedCount:0,qualityScore:0}}isValueFilled(e){return e!=null&&e!==""&&String(e).trim()!==""}calculateCompletenessRate(e,t){const s=e.filter(n=>this.isValueFilled(n)).length;return t>0?Math.round(s/t*100):0}analyzeFieldDataTypes(e){const t={string:0,number:0,date:0,boolean:0,email:0,phone:0,url:0,empty:0};return e.forEach(s=>{if(!this.isValueFilled(s)){t.empty++;return}const n=this.detectValueType(s);t[n]=(t[n]||0)+1}),t}detectValueType(e){if(!this.isValueFilled(e))return"empty";const t=String(e).trim();return/^(true|false|是|否|yes|no)$/i.test(t)?"boolean":/^\d+$/.test(t)||/^\d+\.\d+$/.test(t)?"number":/^\d{4}-\d{2}-\d{2}/.test(t)||/^\d{4}\/\d{2}\/\d{2}/.test(t)?"date":this.isEmailString(t)?"email":/^[\d\-\+\(\)\s]{8,}$/.test(t)?"phone":/^https?:\/\//.test(t)?"url":"string"}isEmailString(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}findDuplicateValues(e){const t={},s=[];return e.forEach(n=>{if(this.isValueFilled(n)){const a=String(n);t[a]=(t[a]||0)+1}}),Object.entries(t).forEach(([n,a])=>{a>1&&s.push({value:n,count:a})}),s}analyzeValueDistribution(e){const t={},s=e.filter(a=>this.isValueFilled(a));s.forEach(a=>{const i=String(a);t[i]=(t[i]||0)+1});const n=Object.entries(t).map(([a,i])=>({value:a,count:i,percentage:Math.round(i/s.length*100)})).sort((a,i)=>i.count-a.count);return{total:s.length,unique:Object.keys(t).length,topValues:n.slice(0,10),distribution:n}}identifyFieldQualityIssues(e,t){const s=[],n=t.filter(h=>this.isValueFilled(h)),a=(t.length-n.length)/t.length*100;a>20&&s.push({type:"high_missing_rate",severity:a>50?"high":"medium",message:`字段 ${e} 缺失率过高: ${Math.round(a)}%`,value:a});const i=this.analyzeFieldDataTypes(t);return Object.values(i).filter(h=>h>0).length>2&&s.push({type:"inconsistent_types",severity:"medium",message:`字段 ${e} 包含多种数据类型`,value:i}),s}analyzeFormatConsistency(e){const t=e.filter(S=>this.isValueFilled(S));if(t.length===0)return{score:100,issues:[]};const s={},n=[];t.forEach(S=>{const M=this.detectValueFormat(String(S));s[M]=(s[M]||0)+1});const a=Object.keys(s).length,i=Object.entries(s).reduce((S,M)=>S[1]>M[1]?S:M)[0],m=s[i],h=Math.round(m/t.length*100);return a>3&&n.push({type:"multiple_formats",message:`检测到 ${a} 种不同格式`,formats:Object.entries(s).map(([S,M])=>({format:S,count:M}))}),{score:h,dominantFormat:i,formatDistribution:s,issues:n}}detectValueFormat(e){const t=e.trim();return/^\d+$/.test(t)?"integer":/^\d+\.\d+$/.test(t)?"decimal":/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(t)?"formatted_number":/^\d{4}-\d{2}-\d{2}$/.test(t)?"date_iso":/^\d{4}\/\d{2}\/\d{2}$/.test(t)?"date_slash":/^\d{4}年\d{1,2}月\d{1,2}日$/.test(t)?"date_chinese":/^[A-Z]{2,3}-[A-Z0-9]{4,6}$/.test(t)?"code_format":/^[A-Z0-9]{8,}$/.test(t)?"alphanumeric_code":/^[a-zA-Z\s]+$/.test(t)?"text_alpha":/^[\u4e00-\u9fa5\s]+$/.test(t)?"text_chinese":"mixed"}calculateFieldStatistics(e){const t=e.filter(i=>this.isValueFilled(i)).map(i=>parseFloat(String(i).replace(/[^\d.-]/g,""))).filter(i=>!isNaN(i));if(t.length===0)return null;const s=t.sort((i,m)=>i-m),a=t.reduce((i,m)=>i+m,0)/t.length;return{count:t.length,min:Math.min(...t),max:Math.max(...t),mean:Math.round(a*100)/100,median:this.calculateMedian(s),mode:this.calculateMode(t),standardDeviation:this.calculateStandardDeviation(t,a)}}calculateMedian(e){const t=Math.floor(e.length/2);return e.length%2===0?(e[t-1]+e[t])/2:e[t]}calculateMode(e){const t={};e.forEach(a=>{t[a]=(t[a]||0)+1});const s=Math.max(...Object.values(t)),n=Object.keys(t).filter(a=>t[a]===s);return n.length===e.length?null:n.map(Number)}calculateStandardDeviation(e,t){const n=e.map(a=>Math.pow(a-t,2)).reduce((a,i)=>a+i,0)/e.length;return Math.round(Math.sqrt(n)*100)/100}normalizeRecord(e){const t={};return Object.keys(e).forEach(s=>{const n=e[s];this.isValueFilled(n)&&(t[s]=String(n).trim().toLowerCase())}),t}analyzeFieldDuplicates(e,t){const s=e.map(a=>a[t]).filter(a=>this.isValueFilled(a)),n=new Set(s.map(a=>String(a).trim().toLowerCase()));return{totalValues:s.length,uniqueValues:n.size,duplicateCount:s.length-n.size,duplicateRate:s.length>0?Math.round((s.length-n.size)/s.length*100):0}}findSimilarRecords(e,t=.8){return[]}detectDataType(e){const t={string:0,number:0,date:0,boolean:0,email:0,phone:0,url:0};return e.forEach(s=>{const n=this.detectValueType(s);t[n]=(t[n]||0)+1}),Object.entries(t).reduce((s,n)=>s[1]>n[1]?s:n)[0]}getTypeDistribution(e){const t={};return e.forEach(s=>{const n=this.detectValueType(s);t[n]=(t[n]||0)+1}),t}calculateTypeConsistency(e){const t=this.getTypeDistribution(e),s=Object.entries(t).reduce((n,a)=>n[1]>a[1]?n:a);return Math.round(s[1]/e.length*100)}suggestTypeConversions(e){return[]}checkDataCompleteness(e){return[]}checkDataConsistency(e){return[]}checkDataAccuracy(e){return[]}checkDataValidity(e){return[]}detectOutliers(e){return[]}calculateDataSize(e){const t=JSON.stringify(e),s=new Blob([t]).size;return s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`}calculateOverallCompleteness(e){if(e.length===0)return 0;let t=0,s=0;return e.forEach(n=>{Object.values(n).forEach(a=>{t++,this.isValueFilled(a)&&s++})}),t>0?Math.round(s/t*100):0}calculateDataQualityScore(e){const t=this.calculateOverallCompleteness(e);return Math.round(t*.4+85*.3+80*.3)}summarizeFieldTypes(e){if(e.length===0)return{};const t={};return Object.keys(e[0]).forEach(s=>{const n=e.map(a=>a[s]).filter(a=>this.isValueFilled(a));t[s]=this.detectDataType(n)}),t}summarizeValueRanges(e){if(e.length===0)return{};const t={};return Object.keys(e[0]).forEach(s=>{const a=e.map(i=>i[s]).filter(i=>this.isValueFilled(i)).map(i=>parseFloat(String(i))).filter(i=>!isNaN(i));a.length>0&&(t[s]={min:Math.min(...a),max:Math.max(...a),range:Math.max(...a)-Math.min(...a)})}),t}generateAnalysisRecommendations(e){return[]}}function Ls(c){try{const e=new Date(c);if(isNaN(e.getTime()))return c;const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${n}`}catch{return c}}function qs(c){if(!c||typeof c!="string")return[];const e=[],t=["的","了","在","是","有","和","与","或","但","因为","所以"];return(c.match(/[\u4e00-\u9fa5]{2,}/g)||[]).forEach(a=>{!t.includes(a)&&a.length>=2&&e.push(a)}),(c.match(/[a-zA-Z]{3,}/g)||[]).forEach(a=>{e.push(a.toLowerCase())}),[...new Set(e)].slice(0,10)}function Us(c){if(!c)return c;const e=c.replace(/\D/g,"");return e.length===11&&e.startsWith("1")?`${e.slice(0,3)}-${e.slice(3,7)}-${e.slice(7)}`:e.length===10?`${e.slice(0,3)}-${e.slice(3,6)}-${e.slice(6)}`:c}function Qs(c){return c&&c.toLowerCase().trim()}function Bs(c){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c)}function Ys(c){if(!c)return c;const e=String(c).replace(/[￥$,]/g,""),t=parseFloat(e);return isNaN(t)?c:t.toFixed(2)}function Ws(c){const e=c.split("").reduce((t,s)=>(t=(t<<5)-t+s.charCodeAt(0),t&t),0);return{lat:39.9+e%1e3/1e4,lng:116.4+e%1e3/1e4}}function Zs(c,e){if(!c)return"其他";const t=c.toLowerCase();for(const[s,n]of Object.entries(e))if(n.length!==0){for(const a of n)if(t.includes(a.toLowerCase()))return s}return"其他"}function Js(c,e,t){let s=0,n=0;return t.forEach(a=>{if((c[a]||e[a])&&(n++,c[a]&&e[a])){const i=Hs(String(c[a]).toLowerCase(),String(e[a]).toLowerCase());s+=i}}),n>0?s/n:0}function Hs(c,e){if(c===e)return 1;const t=c.length>e.length?c:e,s=c.length>e.length?e:c;if(t.length===0)return 1;const n=Gs(t,s);return(t.length-n)/t.length}function Gs(c,e){const t=[];for(let s=0;s<=e.length;s++)t[s]=[s];for(let s=0;s<=c.length;s++)t[0][s]=s;for(let s=1;s<=e.length;s++)for(let n=1;n<=c.length;n++)e.charAt(s-1)===c.charAt(n-1)?t[s][n]=t[s-1][n-1]:t[s][n]=Math.min(t[s-1][n-1]+1,t[s][n-1]+1,t[s-1][n]+1);return t[e.length][c.length]}function Xs(c){const e={};return c.forEach(t=>{Object.keys(t).forEach(s=>{!e[s]&&t[s]&&(e[s]=t[s])})}),e._mergedFrom=c.length,e._mergedAt=new Date().toISOString(),e}function Ks(c){const e=new Date(c),t=new Date;if(isNaN(e.getTime()))return null;let s=t.getFullYear()-e.getFullYear();const n=t.getMonth()-e.getMonth();return(n<0||n===0&&t.getDate()<e.getDate())&&s--,s}function en(c){const e=Date.now().toString(36),t=Math.random().toString(36).substr(2,5);return`${c?c.replace(/\s/g,"").substr(0,3):"xxx"}-${e}-${t}`.toUpperCase()}const tn=new _e,sn=Object.freeze(Object.defineProperty({__proto__:null,CLEANING_RULES:se,DataCleaningEngine:_e,default:tn},Symbol.toStringTag,{value:"Module"})),nn={UPLOAD:{id:"upload",name:"数据上传",description:"上传数据文件",order:1,icon:"upload",color:"#409EFF"},PARSE:{id:"parse",name:"数据解析",description:"解析文件内容，提取数据结构",order:2,icon:"document",color:"#E6A23C"},CLEAN:{id:"clean",name:"数据清洗",description:"应用清洗规则，处理数据质量问题",order:3,icon:"brush",color:"#F56C6C"},EXTRACT:{id:"extract",name:"信息提取",description:"提取关键数据信息和特征",order:4,icon:"search",color:"#67C23A"},SUMMARIZE:{id:"summarize",name:"结果汇总",description:"汇总处理结果，生成报告",order:5,icon:"document-copy",color:"#909399"},AI_ANALYSIS:{id:"ai_analysis",name:"AI总结",description:"AI智能分析和总结",order:6,icon:"cpu",color:"#722ED1"}};class an{constructor(){this.currentStage=null,this.stages=Object.values(nn).sort((e,t)=>e.order-t.order),this.stageResults={},this.stageProgress={},this.logs=[],this.startTime=null,this.endTime=null,this.status="idle",this.errorInfo=null,this.stages.forEach(e=>{this.stageProgress[e.id]={status:"pending",progress:0,startTime:null,endTime:null,duration:null,details:[],result:null,error:null}})}async start(e,t={}){this.log("info","开始数据处理流程"),this.status="running",this.startTime=new Date,this.errorInfo=null;try{return await this.executeStage("upload",async()=>await this.uploadStage(e,t.upload)),await this.executeStage("parse",async()=>await this.parseStage(this.stageResults.upload,t.parse)),await this.executeStage("clean",async()=>await this.cleanStage(this.stageResults.parse,t.clean)),await this.executeStage("extract",async()=>await this.extractStage(this.stageResults.clean,t.extract)),await this.executeStage("summarize",async()=>await this.summarizeStage(this.stageResults.extract,t.summarize)),await this.executeStage("ai_analysis",async()=>await this.aiAnalysisStage(this.stageResults.summarize,t.aiAnalysis)),this.status="completed",this.endTime=new Date,this.log("success","数据处理流程完成"),{success:!0,results:this.stageResults,summary:this.generateFinalSummary()}}catch(s){return this.status="error",this.errorInfo=s,this.log("error",`处理流程失败: ${s.message}`),{success:!1,error:s.message,results:this.stageResults}}}async executeStage(e,t){const s=this.stages.find(a=>a.id===e);if(!s)throw new Error(`未找到阶段: ${e}`);this.currentStage=e;const n=this.stageProgress[e];n.status="running",n.startTime=new Date,n.progress=0,n.details=[],this.log("info",`开始执行阶段: ${s.name}`);try{const a=await t();return n.status="completed",n.progress=100,n.endTime=new Date,n.duration=n.endTime-n.startTime,n.result=a,this.stageResults[e]=a,this.log("success",`阶段 ${s.name} 完成`),a}catch(a){throw n.status="error",n.error=a.message,n.endTime=new Date,n.duration=n.endTime-n.startTime,this.log("error",`阶段 ${s.name} 失败: ${a.message}`),a}}updateStageProgress(e,t,s){this.stageProgress[e]&&(this.stageProgress[e].progress=t,s&&this.stageProgress[e].details.push({time:new Date,message:s}))}async uploadStage(e,t={}){if(this.updateStageProgress("upload",10,"验证文件格式"),!e)throw new Error("未提供文件");if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv","application/json"].includes(e.type))throw new Error(`不支持的文件类型: ${e.type}`);this.updateStageProgress("upload",50,"读取文件内容");const n=await this.readFile(e);this.updateStageProgress("upload",90,"验证文件完整性");const a=t.maxSize||10*1024*1024;if(e.size>a)throw new Error(`文件过大，最大支持 ${Math.round(a/1024/1024)}MB`);return this.updateStageProgress("upload",100,"文件上传完成"),{file:{name:e.name,type:e.type,size:e.size,lastModified:e.lastModified},content:n,uploadTime:new Date}}readFile(e){return new Promise((t,s)=>{const n=new FileReader;n.onload=a=>{t(a.target.result)},n.onerror=()=>{s(new Error("文件读取失败"))},e.type==="application/json"||e.type==="text/csv"?n.readAsText(e):n.readAsArrayBuffer(e)})}log(e,t){const s={time:new Date().toISOString(),level:e,message:t,stage:this.currentStage};this.logs.push(s),console.log(`[${e.toUpperCase()}] ${t}`)}getStatus(){return{status:this.status,currentStage:this.currentStage,stages:this.stages,stageProgress:this.stageProgress,startTime:this.startTime,endTime:this.endTime,duration:this.endTime?this.endTime-this.startTime:null,logs:this.logs,errorInfo:this.errorInfo}}getOverallProgress(){const e=Object.values(this.stageProgress).filter(s=>s.status==="completed").length,t=this.stages.length;return Math.round(e/t*100)}async parseStage(e,t={}){this.updateStageProgress("parse",10,"初始化解析器");const{file:s,content:n}=e;let a=null;try{if(s.type.includes("excel")||s.name.endsWith(".xlsx")||s.name.endsWith(".xls"))this.updateStageProgress("parse",30,"解析Excel文件"),a=await this.parseExcel(n,t);else if(s.type==="text/csv"||s.name.endsWith(".csv"))this.updateStageProgress("parse",30,"解析CSV文件"),a=await this.parseCSV(n,t);else if(s.type==="application/json"||s.name.endsWith(".json"))this.updateStageProgress("parse",30,"解析JSON文件"),a=await this.parseJSON(n,t);else throw new Error(`不支持的文件格式: ${s.type}`);if(this.updateStageProgress("parse",70,"验证数据结构"),!a||!Array.isArray(a)||a.length===0)throw new Error("解析结果为空或格式不正确");this.updateStageProgress("parse",90,"生成数据摘要");const i=this.generateDataSummary(a);return this.updateStageProgress("parse",100,"数据解析完成"),{data:a,summary:i,parseTime:new Date,originalFile:s}}catch(i){throw new Error(`数据解析失败: ${i.message}`)}}async parseExcel(e,t={}){try{const s=await ne(()=>import("./xlsx-D_0l8YDs.js"),[]);this.updateStageProgress("parse",40,"读取Excel工作簿");const n=s.read(e,{type:"array"});this.updateStageProgress("parse",60,"解析工作表");const a=t.sheetName||n.SheetNames[0],i=n.Sheets[a];if(!i)throw new Error(`工作表 "${a}" 不存在`);this.updateStageProgress("parse",80,"转换为JSON格式");const m=s.utils.sheet_to_json(i,{header:t.header||1,defval:t.defaultValue||"",blankrows:t.includeBlankRows||!1});if(m.length===0)throw new Error("Excel文件中没有数据");return m}catch(s){throw new Error(`Excel解析失败: ${s.message}`)}}async parseCSV(e,t={}){try{const s=await ne(()=>import("./papaparse.min-MraP0q7l.js").then(n=>n.p),__vite__mapDeps([0,1]));return this.updateStageProgress("parse",40,"解析CSV内容"),new Promise((n,a)=>{s.parse(e,{header:t.header!==!1,skipEmptyLines:t.skipEmptyLines!==!1,delimiter:t.delimiter||"auto",encoding:t.encoding||"UTF-8",transformHeader:t.transformHeader||(i=>i.trim()),transform:t.transform||(i=>i.trim()),complete:i=>{if(this.updateStageProgress("parse",80,"验证CSV数据"),i.errors.length>0&&console.warn("CSV解析警告:",i.errors),!i.data||i.data.length===0){a(new Error("CSV文件中没有数据"));return}const m=i.data.filter(h=>Object.values(h).some(S=>S&&String(S).trim()!==""));if(m.length===0){a(new Error("CSV文件中没有有效数据"));return}n(m)},error:i=>{a(new Error(`CSV解析失败: ${i.message}`))}})})}catch(s){throw new Error(`CSV解析失败: ${s.message}`)}}async parseJSON(e,t={}){await new Promise(s=>setTimeout(s,300));try{const s=JSON.parse(e);return Array.isArray(s)?s:[s]}catch{throw new Error("JSON格式不正确")}}generateDataSummary(e){const t={totalRecords:e.length,fields:[],dataTypes:{},sampleData:e.slice(0,5)};if(e.length>0){const s=e[0];t.fields=Object.keys(s),t.fields.forEach(n=>{const a=e.map(m=>m[n]).filter(m=>m!=null&&m!==""),i=new Set;a.slice(0,100).forEach(m=>{typeof m=="string"?/^\d+$/.test(m)?i.add("integer"):/^\d+\.\d+$/.test(m)?i.add("decimal"):/^\d{4}-\d{2}-\d{2}/.test(m)?i.add("date"):i.add("string"):typeof m=="number"?i.add("number"):i.add(typeof m)}),t.dataTypes[n]=Array.from(i)})}return t}async cleanStage(e,t={}){this.updateStageProgress("clean",10,"初始化清洗引擎");const{data:s}=e,n=await ne(()=>Promise.resolve().then(()=>sn),void 0);this.updateStageProgress("clean",30,"应用清洗规则");const a=["REMOVE_EMPTY","TRIM_WHITESPACE","REMOVE_DUPLICATES","STANDARDIZE_TERMS","FORMAT_DATE","FORMAT_NUMBER"],i=t.rules||a,m=t.ruleOptions||{};this.updateStageProgress("clean",50,"执行数据清洗");const h=await n.default.applyRules(s,i,m);this.updateStageProgress("clean",80,"生成清洗报告");const S={originalCount:s.length,cleanedCount:h.data.length,removedCount:s.length-h.data.length,appliedRules:i,statistics:h.statistics,qualityScore:h.statistics.qualityScore};return this.updateStageProgress("clean",100,"数据清洗完成"),{data:h.data,report:S,logs:h.logs,cleanTime:new Date}}async extractStage(e,t={}){this.updateStageProgress("extract",10,"初始化信息提取");const{data:s}=e;this.updateStageProgress("extract",30,"提取基础统计信息");const n=this.extractBasicStatistics(s);this.updateStageProgress("extract",50,"分析数据分布");const a=this.analyzeDataDistributions(s);this.updateStageProgress("extract",70,"识别数据模式");const i=this.identifyDataPatterns(s);this.updateStageProgress("extract",90,"生成关键指标");const m=this.generateKeyMetrics(s,n,a);return this.updateStageProgress("extract",100,"信息提取完成"),{basicStats:n,distributions:a,patterns:i,keyMetrics:m,extractTime:new Date}}extractBasicStatistics(e){const t={totalRecords:e.length,fieldCount:e.length>0?Object.keys(e[0]).length:0,completeness:{},uniqueness:{},dataTypes:{}};return e.length>0&&Object.keys(e[0]).forEach(n=>{const i=e.map(h=>h[n]).filter(h=>h!=null&&h!==""),m=new Set(i);t.completeness[n]=Math.round(i.length/e.length*100),t.uniqueness[n]=m.size,t.dataTypes[n]=this.detectFieldType(i)}),t}analyzeDataDistributions(e){const t={};return e.length>0&&Object.keys(e[0]).forEach(n=>{const a=e.map(i=>i[n]).filter(i=>i!=null&&i!=="");if(a.length>0){const i={};a.forEach(h=>{const S=String(h);i[S]=(i[S]||0)+1});const m=Object.entries(i).map(([h,S])=>({value:h,count:S,percentage:Math.round(S/a.length*100)})).sort((h,S)=>S.count-h.count);t[n]={total:a.length,unique:Object.keys(i).length,topValues:m.slice(0,10),distribution:m}}}),t}identifyDataPatterns(e){const t={trends:[],anomalies:[],correlations:[],seasonality:[]};return e.length>0&&Object.keys(e[0]).filter(a=>e.map(m=>m[a]).filter(m=>m!=null&&m!=="").some(m=>!isNaN(parseFloat(m)))).forEach(a=>{const i=e.map(m=>parseFloat(m[a])).filter(m=>!isNaN(m));if(i.length>2){const m=this.calculateTrend(i);Math.abs(m)>.1&&t.trends.push({field:a,trend:m>0?"increasing":"decreasing",strength:Math.abs(m)})}}),t}calculateTrend(e){if(e.length<2)return 0;const t=e.length,s=t*(t-1)/2,n=e.reduce((h,S)=>h+S,0),a=e.reduce((h,S,M)=>h+M*S,0),i=t*(t-1)*(2*t-1)/6;return(t*a-s*n)/(t*i-s*s)}generateKeyMetrics(e,t,s){const n={dataQuality:{completeness:Object.values(t.completeness).reduce((a,i)=>a+i,0)/Object.keys(t.completeness).length||0,uniqueness:Object.values(t.uniqueness).reduce((a,i)=>a+i,0)/e.length||0,consistency:85},businessMetrics:{},technicalMetrics:{recordCount:e.length,fieldCount:t.fieldCount,dataSize:this.calculateDataSize(e)}};return n.overallQuality=Math.round(n.dataQuality.completeness*.4+n.dataQuality.consistency*.4+Math.min(n.dataQuality.uniqueness/e.length*100,100)*.2),n}detectFieldType(e){if(e.length===0)return"unknown";const t=e.slice(0,100),s={number:0,date:0,boolean:0,string:0};return t.forEach(n=>{isNaN(parseFloat(n))?/^\d{4}-\d{2}-\d{2}/.test(n)?s.date++:/^(true|false|yes|no|是|否)$/i.test(n)?s.boolean++:s.string++:s.number++}),Object.entries(s).reduce((n,a)=>n[1]>a[1]?n:a)[0]}calculateDataSize(e){const t=JSON.stringify(e),s=new Blob([t]).size;return s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`}async summarizeStage(e,t={}){this.updateStageProgress("summarize",10,"初始化结果汇总");const{basicStats:s,distributions:n,patterns:a,keyMetrics:i}=e;this.updateStageProgress("summarize",30,"生成数据概览");const m=this.generateDataOverview(s,i);this.updateStageProgress("summarize",50,"创建质量报告");const h=this.generateQualityReport(i,a);this.updateStageProgress("summarize",70,"生成处理报告");const S=this.generateProcessingReport();this.updateStageProgress("summarize",90,"创建可视化数据");const M=this.generateVisualizationData(n,a);return this.updateStageProgress("summarize",100,"结果汇总完成"),{dataOverview:m,qualityReport:h,processingReport:S,visualizations:M,recommendations:this.generateRecommendations(i,a),summarizeTime:new Date}}generateDataOverview(e,t){return{totalRecords:e.totalRecords,totalFields:e.fieldCount,dataSize:t.technicalMetrics.dataSize,qualityScore:t.overallQuality,completenessRate:Math.round(t.dataQuality.completeness),consistencyRate:Math.round(t.dataQuality.consistency),fieldTypes:e.dataTypes}}generateQualityReport(e,t){return{overallScore:e.overallQuality,dimensions:{completeness:{score:Math.round(e.dataQuality.completeness),status:e.dataQuality.completeness>=80?"good":e.dataQuality.completeness>=60?"warning":"poor",description:"数据完整性评估"},consistency:{score:Math.round(e.dataQuality.consistency),status:e.dataQuality.consistency>=80?"good":e.dataQuality.consistency>=60?"warning":"poor",description:"数据一致性评估"},accuracy:{score:85,status:"good",description:"数据准确性评估"}},issues:this.identifyQualityIssues(e,t),improvements:this.suggestImprovements(e)}}generateProcessingReport(){var s,n;const e={totalDuration:this.endTime?this.endTime-this.startTime:Date.now()-this.startTime,stages:[],performance:{throughput:0,efficiency:0}};this.stages.forEach(a=>{const i=this.stageProgress[a.id];e.stages.push({name:a.name,status:i.status,duration:i.duration||0,details:i.details.length})});const t=((n=(s=this.stageResults.parse)==null?void 0:s.data)==null?void 0:n.length)||0;return t>0&&e.totalDuration>0&&(e.performance.throughput=Math.round(t/e.totalDuration*1e3),e.performance.efficiency=Math.round(t/(e.totalDuration/1e3)*100)/100),e}generateVisualizationData(e,t){const s={fieldDistributions:{},trendCharts:[],qualityMetrics:[]};return Object.entries(e).forEach(([n,a])=>{a.topValues.length>0&&(s.fieldDistributions[n]={type:"bar",data:a.topValues.slice(0,10).map(i=>({label:i.value,value:i.count,percentage:i.percentage}))})}),t.trends.forEach(n=>{s.trendCharts.push({field:n.field,type:"line",trend:n.trend,strength:n.strength})}),s}identifyQualityIssues(e,t){const s=[];return e.dataQuality.completeness<80&&s.push({type:"completeness",severity:"medium",message:"数据完整性较低，建议补充缺失数据",value:e.dataQuality.completeness}),e.dataQuality.consistency<70&&s.push({type:"consistency",severity:"high",message:"数据一致性问题，需要标准化处理",value:e.dataQuality.consistency}),s}suggestImprovements(e){const t=[];return e.dataQuality.completeness<90&&t.push({category:"completeness",priority:"high",action:"补充缺失数据",description:"联系数据源，补充缺失的关键字段信息"}),e.dataQuality.consistency<85&&t.push({category:"consistency",priority:"medium",action:"标准化数据格式",description:"建立数据标准，统一格式和术语"}),t}generateRecommendations(e,t){const s=[];return e.overallQuality<70&&s.push({type:"quality_improvement",priority:"high",title:"提升数据质量",description:"当前数据质量分数较低，建议进行全面的数据清洗和标准化",actions:["识别并修复数据质量问题","建立数据质量监控机制","制定数据标准和规范"]}),t.trends.length>0&&s.push({type:"trend_analysis",priority:"medium",title:"关注数据趋势",description:"数据中发现明显趋势，建议进一步分析",actions:["深入分析趋势原因","建立趋势监控","制定应对策略"]}),s}async aiAnalysisStage(e,t={}){this.updateStageProgress("ai_analysis",10,"初始化AI分析");const{dataOverview:s,qualityReport:n,processingReport:a,visualizations:i}=e;this.updateStageProgress("ai_analysis",30,"分析数据特征");const m=await this.generateDataInsights(s,n);this.updateStageProgress("ai_analysis",60,"生成智能建议");const h=await this.generateAIRecommendations(n,a,m);this.updateStageProgress("ai_analysis",80,"创建执行摘要");const S=await this.generateExecutiveSummary(s,n,m,h);return this.updateStageProgress("ai_analysis",100,"AI分析完成"),{dataInsights:m,aiRecommendations:h,executiveSummary:S,confidence:.85,analysisTime:new Date}}async generateDataInsights(e,t){try{const{default:s}=await ne(async()=>{const{default:n}=await import("./DataAnalysisAIService-T09AmqO0.js");return{default:n}},[]);return await s.generateDataInsights(e,t)}catch(s){console.warn("AI服务不可用，使用备用分析:",s);const n=[];return e.totalRecords>1e4&&n.push({type:"scale",level:"info",title:"大规模数据集",description:`数据集包含${e.totalRecords.toLocaleString()}条记录，属于大规模数据，建议采用分批处理策略。`,confidence:.8}),t.overallScore>=85?n.push({type:"quality",level:"success",title:"数据质量优秀",description:`数据质量分数为${t.overallScore}分，整体质量良好，可直接用于分析。`,confidence:.9}):t.overallScore>=70?n.push({type:"quality",level:"warning",title:"数据质量中等",description:`数据质量分数为${t.overallScore}分，建议进行适当的清洗和优化。`,confidence:.85}):n.push({type:"quality",level:"error",title:"数据质量较差",description:`数据质量分数为${t.overallScore}分，需要进行全面的数据清洗。`,confidence:.95}),n}}async generateAIRecommendations(e,t,s){var n;try{const{default:a}=await ne(async()=>{const{default:i}=await import("./DataAnalysisAIService-T09AmqO0.js");return{default:i}},[]);return await a.generateAIRecommendations(e,t,s)}catch(a){console.warn("AI服务不可用，使用备用建议:",a);const i=[];return((n=t.performance)==null?void 0:n.efficiency)<100&&i.push({category:"performance",priority:"medium",title:"优化处理性能",description:"当前处理效率可以进一步提升",confidence:.8,suggestions:[{action:"考虑并行处理大数据集",description:"提升处理速度",difficulty:"medium"},{action:"优化数据清洗规则",description:"减少处理时间",difficulty:"low"},{action:"使用更高效的数据结构",description:"提升内存使用效率",difficulty:"high"}]}),e.overallScore<80&&i.push({category:"quality",priority:"high",title:"数据质量提升计划",description:"制定系统性的数据质量改进策略",confidence:.9,suggestions:[{action:"建立数据质量监控体系",description:"实时监控数据质量",difficulty:"medium"},{action:"制定数据标准和规范",description:"统一数据格式和质量标准",difficulty:"low"},{action:"实施定期数据清洗流程",description:"自动化数据清洗",difficulty:"medium"}]}),i}}async generateExecutiveSummary(e,t,s,n){try{const{default:a}=await ne(async()=>{const{default:i}=await import("./DataAnalysisAIService-T09AmqO0.js");return{default:i}},[]);return await a.generateExecutiveSummary(e,t,s,n)}catch(a){console.warn("AI服务不可用，使用备用摘要:",a);const i={overview:`本次处理了包含${e.totalRecords.toLocaleString()}条记录、${e.totalFields}个字段的数据集，数据规模为${e.dataSize}。`,keyFindings:[],recommendations:[],nextSteps:[],riskAssessment:[],businessImpact:{current:t.overallScore>=80?"high":"medium",potential:"high",description:"数据具有良好的业务价值潜力"}};return i.keyFindings.push(`数据质量评分：${t.overallScore}/100`),i.keyFindings.push(`数据完整性：${e.completenessRate}%`),i.keyFindings.push(`数据一致性：${e.consistencyRate}%`),s.filter(h=>h.impact==="high").forEach(h=>{i.keyFindings.push(h.title)}),t.overallScore>=85?i.recommendations.push("数据质量良好，可直接用于业务分析"):i.recommendations.push("建议进行进一步的数据清洗和标准化"),n&&n.length>0&&n.slice(0,3).forEach(h=>{i.recommendations.push(h.title)}),t.overallScore<80&&i.nextSteps.push("立即启动数据质量改进计划"),i.nextSteps.push("建立数据质量监控机制"),i.nextSteps.push("制定数据维护计划"),i.nextSteps.push("培训相关人员数据管理最佳实践"),t.overallScore<70&&i.riskAssessment.push({type:"quality",level:"high",description:"数据质量较低可能影响分析结果的可靠性"}),i}}generateFinalSummary(){var s,n,a,i;const e=this.endTime-this.startTime,t=this.stages.map(m=>({name:m.name,status:this.stageProgress[m.id].status,duration:this.stageProgress[m.id].duration}));return{totalDuration:e,overallProgress:this.getOverallProgress(),stages:t,finalDataCount:((n=(s=this.stageResults.clean)==null?void 0:s.data)==null?void 0:n.length)||0,qualityScore:((i=(a=this.stageResults.clean)==null?void 0:a.report)==null?void 0:i.qualityScore)||0}}reset(){this.currentStage=null,this.stageResults={},this.logs=[],this.startTime=null,this.endTime=null,this.status="idle",this.errorInfo=null,this.stages.forEach(e=>{this.stageProgress[e.id]={status:"pending",progress:0,startTime:null,endTime:null,duration:null,details:[],result:null,error:null}}),this.log("info","流水线已重置")}}const on=new an,rn={class:"data-processing-center"},ln={class:"upload-header"},cn={key:0,class:"file-info"},un={class:"file-details"},dn={class:"file-name"},mn={class:"file-size"},pn={class:"file-type"},hn={class:"processing-options"},gn={class:"option-item"},fn={class:"option-item"},yn={class:"option-item"},_n={class:"upload-actions"},vn={class:"rules-config"},Sn={class:"rules-categories"},$n={class:"rules-grid"},wn=["onClick"],En={class:"rule-header"},bn={class:"rule-name"},Cn={class:"rule-description"},Tn={class:"rules-grid"},Rn=["onClick"],Dn={class:"rule-header"},xn={class:"rule-name"},kn={class:"rule-description"},Fn={class:"rules-grid"},Mn=["onClick"],On={class:"rule-header"},Pn={class:"rule-name"},An={class:"rule-description"},zn={class:"rules-grid"},In=["onClick"],Vn={class:"rule-header"},jn={class:"rule-name"},Nn={class:"rule-description"},Ln={class:"selected-rules-summary"},qn={class:"selected-rules-list"},Un={class:"dialog-footer"},Qn={__name:"DataProcessingCenter",setup(c){const e=Y(null),t=Y(!1),s=Y(!1),n=Y(!1),a=Y("basic"),i=Y(["REMOVE_EMPTY","TRIM_WHITESPACE","REMOVE_DUPLICATES","STANDARDIZE_TERMS","FORMAT_DATE","FORMAT_NUMBER"]),m=ke(on),h=Y(null),S=Y({recordsProcessed:0,qualityScore:0,totalTime:0,issuesFound:0}),M=K(()=>Object.values(se).filter(g=>g.category==="basic")),W=K(()=>Object.values(se).filter(g=>g.category==="format")),U=K(()=>Object.values(se).filter(g=>g.category==="advanced")),J=K(()=>Object.values(se).filter(g=>g.category==="validation")),G=g=>{e.value=g.raw},j=()=>{e.value=null},X=g=>g<1024?`${g} B`:g<1024*1024?`${(g/1024).toFixed(1)} KB`:`${(g/(1024*1024)).toFixed(1)} MB`,N=g=>{const p=i.value.indexOf(g);p>-1?i.value.splice(p,1):i.value.push(g)},ee=g=>{const p=Object.values(se).find(E=>E.id===g);return p?p.name:g},te=()=>{i.value=["REMOVE_EMPTY","TRIM_WHITESPACE","REMOVE_DUPLICATES","STANDARDIZE_TERMS","FORMAT_DATE","FORMAT_NUMBER"]},ae=()=>{n.value=!1,Q.success("清洗规则配置已保存")},ie=async()=>{var g,p,E,C,P,F,D,z,T,$,V,A;if(!e.value){Q.error("请先选择文件");return}t.value=!0,s.value=!1;try{const I={clean:{rules:i.value,ruleOptions:{}}},y=await m.start(e.value,I);h.value=y,s.value=!0,S.value={recordsProcessed:((E=(p=(g=y.results)==null?void 0:g.clean)==null?void 0:p.data)==null?void 0:E.length)||0,qualityScore:((F=(P=(C=y.results)==null?void 0:C.clean)==null?void 0:P.report)==null?void 0:F.qualityScore)||0,totalTime:((D=y.summary)==null?void 0:D.totalDuration)||0,issuesFound:((A=(V=($=(T=(z=y.results)==null?void 0:z.extract)==null?void 0:T.keyMetrics)==null?void 0:$.dataQuality)==null?void 0:V.issues)==null?void 0:A.length)||0},y.success?Q.success("数据处理完成"):Q.error(`处理失败: ${y.error}`)}catch(I){Q.error(`处理失败: ${I.message}`),console.error("Processing error:",I)}finally{t.value=!1}},oe=()=>{if(!h.value)return;const g=JSON.stringify(h.value,null,2),p=new Blob([g],{type:"application/json"}),E=URL.createObjectURL(p),C=document.createElement("a");C.href=E,C.download=`processing-results-${new Date().toISOString().slice(0,19)}.json`,C.click(),URL.revokeObjectURL(E)},w=()=>{var g,p,E;if(!((E=(p=(g=h.value)==null?void 0:g.results)==null?void 0:p.clean)!=null&&E.data)){Q.warning("没有可导出的数据");return}try{const C=h.value.results.clean.data,P=d(C),F=new Blob([P],{type:"text/csv;charset=utf-8"}),D=URL.createObjectURL(F),z=document.createElement("a");z.href=D,z.download=`cleaned-data-${new Date().toISOString().slice(0,19)}.csv`,z.click(),URL.revokeObjectURL(D),Q.success("数据导出成功")}catch(C){Q.error("导出失败: "+C.message)}},l=()=>{var p,E,C,P,F;if(!h.value){Q.warning("没有可分享的结果");return}const g=(E=(p=h.value.results)==null?void 0:p.ai_analysis)==null?void 0:E.executiveSummary;if(g){const D=`数据处理结果摘要：

${g.overview}

质量评分：${((C=h.value.summary)==null?void 0:C.qualityScore)||0}%
处理记录：${((P=h.value.summary)==null?void 0:P.finalDataCount)||0}条

主要发现：
${((F=g.keyFindings)==null?void 0:F.map(z=>`• ${z}`).join(`
`))||"无"}
    `;navigator.clipboard.writeText(D).then(()=>{Q.success("结果摘要已复制到剪贴板")}).catch(()=>{Q.error("复制失败")})}else Q.warning("暂无可分享的摘要")},d=g=>{if(!g||g.length===0)return"";const p=Object.keys(g[0]),E=[];return E.push(p.join(",")),g.forEach(C=>{const P=p.map(F=>{const D=C[F];return typeof D=="string"&&(D.includes(",")||D.includes('"'))?`"${D.replace(/"/g,'""')}"`:D||""});E.push(P.join(","))}),E.join(`
`)},b=()=>{e.value=null,t.value=!1,s.value=!1,h.value=null,m.reset()};return Fe(()=>{}),(g,p)=>{const E=R("el-icon"),C=R("el-button"),P=R("el-upload"),F=R("el-card"),D=R("el-col"),z=R("el-row"),T=R("el-checkbox"),$=R("el-tab-pane"),V=R("el-tabs"),A=R("el-tag"),I=R("el-dialog");return f(),v("div",rn,[p[18]||(p[18]=o("div",{class:"page-header"},[o("h1",null,"数据处理中心"),o("p",null,"完整的数据处理流程：上传 → 解析 → 清洗 → 提取 → 汇总 → AI分析")],-1)),!t.value&&!s.value?(f(),B(F,{key:0,class:"upload-card"},{header:u(()=>[o("div",ln,[p[5]||(p[5]=o("h3",null,"数据上传",-1)),r(C,{type:"primary",onClick:p[0]||(p[0]=y=>n.value=!0),plain:""},{default:u(()=>[r(E,null,{default:u(()=>[r(O(Oe))]),_:1}),p[4]||(p[4]=x(" 配置清洗规则 "))]),_:1,__:[4]})])]),default:u(()=>[r(P,{class:"upload-dragger",drag:"","auto-upload":!1,"on-change":G,"show-file-list":!1,accept:".xlsx,.xls,.csv,.json"},{tip:u(()=>p[6]||(p[6]=[o("div",{class:"el-upload__tip"}," 支持 Excel (.xlsx, .xls)、CSV (.csv)、JSON (.json) 格式文件，最大 10MB ",-1)])),default:u(()=>[r(E,{class:"el-icon--upload"},{default:u(()=>[r(O(Me))]),_:1}),p[7]||(p[7]=o("div",{class:"el-upload__text"},[x(" 将文件拖到此处，或"),o("em",null,"点击上传")],-1))]),_:1,__:[7]}),e.value?(f(),v("div",cn,[p[13]||(p[13]=o("h4",null,"已选择文件:",-1)),o("div",un,[o("span",dn,_(e.value.name),1),o("span",mn,"("+_(X(e.value.size))+")",1),o("span",pn,_(e.value.type),1)]),o("div",hn,[p[10]||(p[10]=o("h4",null,"处理选项:",-1)),r(z,{gutter:16},{default:u(()=>[r(D,{span:8},{default:u(()=>[r(F,{class:"option-card"},{default:u(()=>[o("div",gn,[r(E,null,{default:u(()=>[r(O(ye))]),_:1}),o("span",null,"清洗规则: "+_(i.value.length)+" 项",1)])]),_:1})]),_:1}),r(D,{span:8},{default:u(()=>[r(F,{class:"option-card"},{default:u(()=>[o("div",fn,[r(E,null,{default:u(()=>[r(O(le))]),_:1}),p[8]||(p[8]=o("span",null,"AI分析: 启用",-1))])]),_:1})]),_:1}),r(D,{span:8},{default:u(()=>[r(F,{class:"option-card"},{default:u(()=>[o("div",yn,[r(E,null,{default:u(()=>[r(O(ce))]),_:1}),p[9]||(p[9]=o("span",null,"生成报告: 启用",-1))])]),_:1})]),_:1})]),_:1})]),o("div",_n,[r(C,{type:"primary",size:"large",onClick:ie,loading:t.value},{default:u(()=>[r(E,null,{default:u(()=>[r(O(le))]),_:1}),p[11]||(p[11]=x(" 开始处理 "))]),_:1,__:[11]},8,["loading"]),r(C,{onClick:j},{default:u(()=>p[12]||(p[12]=[x("清除文件")])),_:1,__:[12]})])])):k("",!0)]),_:1})):k("",!0),t.value||s.value?(f(),B(Ot,{key:1,pipeline:m,statistics:S.value},null,8,["pipeline","statistics"])):k("",!0),r(I,{modelValue:n.value,"onUpdate:modelValue":p[3]||(p[3]=y=>n.value=y),title:"配置清洗规则",width:"800px","close-on-click-modal":!1},{footer:u(()=>[o("div",Un,[r(C,{onClick:te},{default:u(()=>p[15]||(p[15]=[x("重置为默认")])),_:1,__:[15]}),r(C,{onClick:p[2]||(p[2]=y=>n.value=!1)},{default:u(()=>p[16]||(p[16]=[x("取消")])),_:1,__:[16]}),r(C,{type:"primary",onClick:ae},{default:u(()=>p[17]||(p[17]=[x("确定")])),_:1,__:[17]})])]),default:u(()=>[o("div",vn,[o("div",Sn,[p[14]||(p[14]=o("h4",null,"选择清洗规则:",-1)),r(V,{modelValue:a.value,"onUpdate:modelValue":p[1]||(p[1]=y=>a.value=y),type:"card"},{default:u(()=>[r($,{label:"基础清洗",name:"basic"},{default:u(()=>[o("div",$n,[(f(!0),v(L,null,q(M.value,y=>(f(),v("div",{key:y.id,class:H(["rule-item",{active:i.value.includes(y.id)}]),onClick:Z=>N(y.id)},[o("div",En,[r(T,{"model-value":i.value.includes(y.id),onChange:Z=>N(y.id)},null,8,["model-value","onChange"]),o("span",bn,_(y.name),1)]),o("p",Cn,_(y.description),1)],10,wn))),128))])]),_:1}),r($,{label:"格式化",name:"format"},{default:u(()=>[o("div",Tn,[(f(!0),v(L,null,q(W.value,y=>(f(),v("div",{key:y.id,class:H(["rule-item",{active:i.value.includes(y.id)}]),onClick:Z=>N(y.id)},[o("div",Dn,[r(T,{"model-value":i.value.includes(y.id),onChange:Z=>N(y.id)},null,8,["model-value","onChange"]),o("span",xn,_(y.name),1)]),o("p",kn,_(y.description),1)],10,Rn))),128))])]),_:1}),r($,{label:"高级处理",name:"advanced"},{default:u(()=>[o("div",Fn,[(f(!0),v(L,null,q(U.value,y=>(f(),v("div",{key:y.id,class:H(["rule-item",{active:i.value.includes(y.id)}]),onClick:Z=>N(y.id)},[o("div",On,[r(T,{"model-value":i.value.includes(y.id),onChange:Z=>N(y.id)},null,8,["model-value","onChange"]),o("span",Pn,_(y.name),1)]),o("p",An,_(y.description),1)],10,Mn))),128))])]),_:1}),r($,{label:"验证规则",name:"validation"},{default:u(()=>[o("div",zn,[(f(!0),v(L,null,q(J.value,y=>(f(),v("div",{key:y.id,class:H(["rule-item",{active:i.value.includes(y.id)}]),onClick:Z=>N(y.id)},[o("div",Vn,[r(T,{"model-value":i.value.includes(y.id),onChange:Z=>N(y.id)},null,8,["model-value","onChange"]),o("span",jn,_(y.name),1)]),o("p",Nn,_(y.description),1)],10,In))),128))])]),_:1})]),_:1},8,["modelValue"])]),o("div",Ln,[o("h4",null,"已选择规则 ("+_(i.value.length)+"):",1),o("div",qn,[(f(!0),v(L,null,q(i.value,y=>(f(),B(A,{key:y,closable:"",onClose:Z=>N(y),style:{margin:"4px"}},{default:u(()=>[x(_(ee(y)),1)]),_:2},1032,["onClose"]))),128))])])])]),_:1},8,["modelValue"]),s.value&&h.value?(f(),B(Ns,{key:2,results:h.value,onDownload:oe,onExport:w,onShare:l,onRestart:b},null,8,["results"])):k("",!0)])}}},Zn=ue(Qn,[["__scopeId","data-v-790c5dba"]]);export{Zn as default};
