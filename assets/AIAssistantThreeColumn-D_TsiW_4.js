import{S as d,aj as X,T as G,c as i,o,a as s,O as k,Q as b,P as T,e as x,F as S,r as w,b as I,_ as Y,ai as Z,t as l,n as V,X as ee,V as M,W as te}from"./element-plus-DR-erZ3X.js";import{a as se}from"./aiService-CKXedvtd.js";import{a as ne}from"./index-Bo1zM2q5.js";import"./echarts-Dfqt_Pbx.js";const ae={class:"ai-assistant-container"},oe={class:"top-header"},ie={class:"header-controls"},le={class:"three-column-layout"},ce={class:"left-column"},re={class:"tools-section"},ue=["onClick"],de={class:"tool-icon"},pe={class:"tool-details"},me={class:"tool-name"},ve={class:"tool-desc"},_e={class:"middle-column"},ge={class:"column-header"},ye={class:"quick-examples"},he={class:"message-avatar"},fe={key:0},ke={key:1},Se={class:"message-body"},we=["innerHTML"],Ie={class:"message-timestamp"},Ae={key:0,class:"chat-message ai loading-message"},Ce={class:"input-area"},De={class:"input-controls"},be={class:"right-column"},Te={class:"thinking-area"},xe={key:0,class:"empty-thinking"},Me={class:"step-header"},Oe={class:"step-icon"},Ve={class:"step-title"},Ee={class:"step-status"},Ne={key:0,class:"step-details"},$e={key:1,class:"step-result"},Le={class:"result-content"},Qe={__name:"AIAssistantThreeColumn",setup(Be){const u=d(""),v=d([{type:"ai",content:"æ‚¨å¥½ï¼æˆ‘æ˜¯QMS AIæ™ºèƒ½åŠ©æ‰‹ã€‚æˆ‘å·²æŽ¥å…¥DeepSeekå¤§è¯­è¨€æ¨¡åž‹ï¼Œå¯ä»¥ä¸ºæ‚¨æä¾›ä¸“ä¸šçš„è´¨é‡ç®¡ç†é—®ç­”æœåŠ¡ã€‚",timestamp:new Date}]),m=d(!1),g=d(!0),p=d([]),A=d(null),C=d(""),E=d("info"),$=d(["æŸ¥è¯¢å·¥åŽ‚Açš„åº“å­˜æƒ…å†µ","åˆ†æžæœ€è¿‘çš„è´¨é‡è¶‹åŠ¿","ç”Ÿæˆè´¨é‡æŠ¥å‘Š","ç»Ÿè®¡ä¸åˆæ ¼å“æ•°é‡","æŸ¥çœ‹ç”Ÿäº§çº¿çŠ¶æ€","æ£€æµ‹å¼‚å¸¸ç‰©æ–™æ‰¹æ¬¡"]),L=X([{name:"æ•°æ®åˆ†æžå·¥å…·",icon:"ðŸ“Š",tools:[{name:"æ•°æ®åˆ†æž",icon:"ðŸ“Š",description:"åˆ†æžè´¨é‡ç®¡ç†æ•°æ®"},{name:"ç»Ÿè®¡åˆ†æž",icon:"ðŸ“ˆ",description:"æ‰§è¡Œç»Ÿè®¡åˆ†æž"},{name:"æ•°å€¼è®¡ç®—",icon:"ðŸ§®",description:"æ‰§è¡Œæ•°å­¦è®¡ç®—"}]},{name:"å¯è§†åŒ–å·¥å…·",icon:"ðŸ“ˆ",tools:[{name:"å›¾è¡¨ç”Ÿæˆ",icon:"ðŸ“Š",description:"ç”Ÿæˆæ•°æ®å¯è§†åŒ–å›¾è¡¨"},{name:"æŠ¥å‘Šç”Ÿæˆ",icon:"ðŸ“„",description:"ç”Ÿæˆè´¨é‡åˆ†æžæŠ¥å‘Š"}]},{name:"è”ç½‘å·¥å…·",icon:"ðŸŒ",tools:[{name:"ç½‘ç»œæœç´¢",icon:"ðŸ”",description:"æœç´¢ç›¸å…³ä¿¡æ¯"}]},{name:"è´¨é‡ç®¡ç†",icon:"ðŸŽ¯",tools:[{name:"åº“å­˜æŸ¥è¯¢",icon:"ðŸ“¦",description:"æŸ¥è¯¢åº“å­˜ä¿¡æ¯"},{name:"ç”Ÿäº§æŸ¥è¯¢",icon:"ðŸ­",description:"æŸ¥è¯¢ç”Ÿäº§æ•°æ®"},{name:"æ£€æµ‹æŸ¥è¯¢",icon:"ðŸ§ª",description:"æŸ¥è¯¢æ£€æµ‹ç»“æžœ"}]}]),Q=t=>t?new Date(t).toLocaleTimeString():"",B=t=>t.replace(/\n/g,"<br>"),j=t=>({thinking:"ðŸ¤”",analysis:"ðŸ”",tool_selection:"ðŸ› ï¸",data_query:"ðŸ“Š",ai_call:"ðŸ¤–",response:"ðŸ’¬"})[t]||"âš™ï¸",R=t=>({processing:"å¤„ç†ä¸­...",completed:"å®Œæˆ",error:"é”™è¯¯"})[t]||t,J=t=>typeof t=="object"?JSON.stringify(t,null,2):String(t),_=(t,e="info")=>{C.value=t,E.value=e,setTimeout(()=>{C.value=""},3e3)},U=t=>{const e=`è¯·ä½¿ç”¨${t.name}å·¥å…·å¸®æˆ‘${t.description}`;u.value=e,M.success(`å·²é€‰æ‹©å·¥å…·ï¼š${t.name}`)},P=t=>{u.value=t,O()},q=()=>{const t=g.value?"AIå¢žå¼ºæ¨¡å¼":"åŸºç¡€æ¨¡å¼";M.info(`å·²åˆ‡æ¢åˆ°${t}`),_(`å·²åˆ‡æ¢åˆ°${t}`,"success")},z=()=>{v.value=[{type:"ai",content:"å¯¹è¯å·²æ¸…ç©ºã€‚æ‚¨å¥½ï¼æˆ‘æ˜¯IQE AIæ™ºèƒ½åŠ©æ‰‹ï¼Œå·²æŽ¥å…¥DeepSeekå¤§è¯­è¨€æ¨¡åž‹ã€‚",timestamp:new Date}],p.value=[],M.success("å¯¹è¯å·²æ¸…ç©º")},H=()=>{const t={timestamp:new Date().toISOString(),messages:v.value,aiMode:g.value?"AIå¢žå¼ºæ¨¡å¼":"åŸºç¡€æ¨¡å¼"},e=JSON.stringify(t,null,2),a=new Blob([e],{type:"application/json"}),c=URL.createObjectURL(a),f=document.createElement("a");f.href=c,f.download=`IQE-AIå¯¹è¯è®°å½•-${new Date().toISOString().slice(0,10)}.json`,f.click(),URL.revokeObjectURL(c),M.success("å¯¹è¯è®°å½•å·²å¯¼å‡º")},N=()=>{te(()=>{A.value&&(A.value.scrollTop=A.value.scrollHeight)})},O=async()=>{if(!u.value.trim()||m.value)return;const t={type:"user",content:u.value,timestamp:new Date};v.value.push(t);const e=u.value;u.value="",N();try{await K(e)}catch(a){console.error("AIå¤„ç†é”™è¯¯:",a),v.value.push({type:"ai",content:"æŠ±æ­‰ï¼Œå¤„ç†æ‚¨çš„é—®é¢˜æ—¶å‡ºçŽ°äº†é”™è¯¯ã€‚è¯·ç¨åŽé‡è¯•ã€‚",timestamp:new Date}),_("å¤„ç†å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•","error")}N()},K=async t=>{m.value=!0,p.value=[];try{await y("thinking","ç†è§£é—®é¢˜","processing",{question:t}),await D(500),h(0,"completed"),await y("analysis","åˆ†æžé—®é¢˜ç±»åž‹","processing"),await D(300),h(1,"completed"),await y("data_query","èŽ·å–ä¸šåŠ¡æ•°æ®","processing");const e=await F();await D(400),h(2,"completed"),await y("ai_call","è°ƒç”¨DeepSeek AI","processing");let a;if(g.value)try{const c=await se.queryAI(t,e);a=c.response||c.answer||"æŠ±æ­‰ï¼ŒAIæœåŠ¡è¿”å›žäº†ç©ºå“åº”ã€‚",_("AIå“åº”æˆåŠŸ","success")}catch(c){console.error("AIè°ƒç”¨å¤±è´¥:",c),a=`æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ã€‚åŸºäºŽæ‚¨çš„é—®é¢˜"${t}"ï¼Œæˆ‘ä¸ºæ‚¨æä¾›åŸºç¡€åˆ†æž...`,_("AIæœåŠ¡ä¸å¯ç”¨ï¼Œå·²åˆ‡æ¢åˆ°åŸºç¡€æ¨¡å¼","error")}else a=`åŸºç¡€æ¨¡å¼å›žå¤ï¼šæˆ‘æ”¶åˆ°äº†æ‚¨çš„é—®é¢˜"${t}"ã€‚è¿™æ˜¯ä¸€ä¸ªå…³äºŽè´¨é‡ç®¡ç†çš„é—®é¢˜ï¼Œæˆ‘æ­£åœ¨ä¸ºæ‚¨åˆ†æžç›¸å…³æ•°æ®...`;h(3,"completed"),await y("response","ç”Ÿæˆå›žç­”","processing"),await D(200),h(4,"completed"),v.value.push({type:"ai",content:a,timestamp:new Date})}catch(e){throw console.error("å¤„ç†AIå“åº”æ—¶å‡ºé”™:",e),_("å¤„ç†å¤±è´¥","error"),e}finally{m.value=!1}},y=async(t,e,a,c=null)=>{p.value.push({type:t,title:e,status:a,details:c})},h=(t,e,a=null)=>{p.value[t]&&(p.value[t].status=e,a&&(p.value[t].result=a))},D=t=>new Promise(e=>setTimeout(e,t)),F=async()=>{try{const t=JSON.parse(localStorage.getItem("inventoryData")||"[]"),e=JSON.parse(localStorage.getItem("productionData")||"[]"),a=JSON.parse(localStorage.getItem("testData")||"[]");return{inventoryCount:t.length,productionCount:e.length,testCount:a.length,factoryCount:3,timestamp:new Date().toISOString(),inventorySample:t.slice(0,5),productionSample:e.slice(0,5),testSample:a.slice(0,5)}}catch(t){console.error("èŽ·å–ä¸šåŠ¡æ•°æ®å¤±è´¥:",t);try{const a=await(await fetch("/api/data/status")).json();if(a.success)return{inventoryCount:a.data.inventory,productionCount:a.data.online,testCount:a.data.lab,factoryCount:3,timestamp:a.data.lastSync}}catch(e){console.error("ä»ŽAPIèŽ·å–æ•°æ®ä¹Ÿå¤±è´¥:",e)}return{inventoryCount:132,productionCount:1056,testCount:396,factoryCount:3,timestamp:new Date().toISOString()}}};return G(()=>{console.log("ðŸ¤– IQE AIæ™ºèƒ½åŠ©æ‰‹å·²åŠ è½½"),_("AIæ™ºèƒ½åŠ©æ‰‹å·²å°±ç»ªï¼ŒDeepSeekæ¨¡åž‹å·²è¿žæŽ¥","success")}),(t,e)=>{const a=b("el-switch"),c=b("el-button"),f=b("el-tag"),W=b("el-input");return o(),i("div",ae,[s("div",oe,[e[4]||(e[4]=s("h1",null,"ðŸ¤– QMS AI æ™ºèƒ½åŠ©æ‰‹",-1)),s("div",ie,[k(a,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=n=>g.value=n),onChange:q,"active-text":"AIå¢žå¼ºæ¨¡å¼","inactive-text":"åŸºç¡€æ¨¡å¼",size:"large"},null,8,["modelValue"]),k(c,{onClick:z,type:"primary",plain:""},{default:T(()=>e[2]||(e[2]=[x("æ¸…ç©ºå¯¹è¯")])),_:1,__:[2]}),k(c,{onClick:H,type:"success",plain:""},{default:T(()=>e[3]||(e[3]=[x("å¯¼å‡ºå¯¹è¯")])),_:1,__:[3]})])]),s("div",le,[s("div",ce,[e[5]||(e[5]=s("div",{class:"column-header"},[s("h3",null,"ðŸ› ï¸ å¯ç”¨å·¥å…·")],-1)),s("div",re,[(o(!0),i(S,null,w(L,n=>(o(),i("div",{class:"tool-category",key:n.name},[s("h4",null,l(n.icon)+" "+l(n.name),1),(o(!0),i(S,null,w(n.tools,r=>(o(),i("div",{class:"tool-item",key:r.name,onClick:je=>U(r)},[s("span",de,l(r.icon),1),s("div",pe,[s("div",me,l(r.name),1),s("div",ve,l(r.description),1)])],8,ue))),128))]))),128))])]),s("div",_e,[s("div",ge,[e[6]||(e[6]=s("h3",null,"ðŸ’¬ æ™ºèƒ½é—®ç­”",-1)),s("div",ye,[(o(!0),i(S,null,w($.value,n=>(o(),ee(f,{key:n,onClick:r=>P(n),class:"example-tag",type:"info",effect:"plain"},{default:T(()=>[x(l(n),1)]),_:2},1032,["onClick"]))),128))])]),s("div",{class:"messages-area",ref_key:"messagesArea",ref:A},[(o(!0),i(S,null,w(v.value,(n,r)=>(o(),i("div",{key:r,class:V(["chat-message",n.type])},[s("div",he,[n.type==="user"?(o(),i("span",fe,"ðŸ‘¤")):(o(),i("span",ke,"ðŸ¤–"))]),s("div",Se,[s("div",{class:"message-text",innerHTML:B(n.content)},null,8,we),s("div",Ie,l(Q(n.timestamp)),1)])],2))),128)),m.value?(o(),i("div",Ae,e[7]||(e[7]=[s("div",{class:"message-avatar"},"ðŸ¤–",-1),s("div",{class:"message-body"},[s("div",{class:"typing-animation"},[s("span"),s("span"),s("span")]),s("div",{class:"loading-text"},"AIæ­£åœ¨æ€è€ƒä¸­...")],-1)]))):I("",!0)],512),s("div",Ce,[k(W,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=n=>u.value=n),type:"textarea",rows:3,placeholder:"è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...",onKeydown:Y(Z(O,["ctrl"]),["enter"]),disabled:m.value,resize:"none"},null,8,["modelValue","onKeydown","disabled"]),s("div",De,[k(c,{onClick:O,type:"primary",loading:m.value,disabled:!u.value.trim()},{default:T(()=>[x(l(m.value?"å‘é€ä¸­...":"å‘é€ (Ctrl+Enter)"),1)]),_:1},8,["loading","disabled"])]),C.value?(o(),i("div",{key:0,class:V(["status-message",E.value])},l(C.value),3)):I("",!0)])]),s("div",be,[e[10]||(e[10]=s("div",{class:"column-header"},[s("h3",null,"ðŸ§  AIæ€è€ƒè¿‡ç¨‹")],-1)),s("div",Te,[p.value.length===0?(o(),i("div",xe,e[8]||(e[8]=[s("div",{class:"empty-icon"},"ðŸ¤”",-1),s("div",{class:"empty-text"},"AIæ­£åœ¨ç­‰å¾…æ‚¨çš„é—®é¢˜...",-1)]))):I("",!0),(o(!0),i(S,null,w(p.value,(n,r)=>(o(),i("div",{key:r,class:V(["thinking-step",n.status])},[s("div",Me,[s("span",Oe,l(j(n.type)),1),s("span",Ve,l(n.title),1),s("span",Ee,l(R(n.status)),1)]),n.details?(o(),i("div",Ne,[s("pre",null,l(JSON.stringify(n.details,null,2)),1)])):I("",!0),n.result?(o(),i("div",$e,[e[9]||(e[9]=s("div",{class:"result-label"},"æ‰§è¡Œç»“æžœ:",-1)),s("div",Le,l(J(n.result)),1)])):I("",!0)],2))),128))])])])])}}},qe=ne(Qe,[["__scopeId","data-v-9d6757cd"]]);export{qe as default};
