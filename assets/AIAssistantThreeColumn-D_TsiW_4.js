import{S as d,aj as X,T as G,c as i,o,a as s,O as k,Q as b,P as T,e as x,F as S,r as w,b as I,_ as Y,ai as Z,t as l,n as V,X as ee,V as M,W as te}from"./element-plus-DR-erZ3X.js";import{a as se}from"./aiService-CKXedvtd.js";import{a as ne}from"./index-Bo1zM2q5.js";import"./echarts-Dfqt_Pbx.js";const ae={class:"ai-assistant-container"},oe={class:"top-header"},ie={class:"header-controls"},le={class:"three-column-layout"},ce={class:"left-column"},re={class:"tools-section"},ue=["onClick"],de={class:"tool-icon"},pe={class:"tool-details"},me={class:"tool-name"},ve={class:"tool-desc"},_e={class:"middle-column"},ge={class:"column-header"},ye={class:"quick-examples"},he={class:"message-avatar"},fe={key:0},ke={key:1},Se={class:"message-body"},we=["innerHTML"],Ie={class:"message-timestamp"},Ae={key:0,class:"chat-message ai loading-message"},Ce={class:"input-area"},De={class:"input-controls"},be={class:"right-column"},Te={class:"thinking-area"},xe={key:0,class:"empty-thinking"},Me={class:"step-header"},Oe={class:"step-icon"},Ve={class:"step-title"},Ee={class:"step-status"},Ne={key:0,class:"step-details"},$e={key:1,class:"step-result"},Le={class:"result-content"},Qe={__name:"AIAssistantThreeColumn",setup(Be){const u=d(""),v=d([{type:"ai",content:"您好！我是QMS AI智能助手。我已接入DeepSeek大语言模型，可以为您提供专业的质量管理问答服务。",timestamp:new Date}]),m=d(!1),g=d(!0),p=d([]),A=d(null),C=d(""),E=d("info"),$=d(["查询工厂A的库存情况","分析最近的质量趋势","生成质量报告","统计不合格品数量","查看生产线状态","检测异常物料批次"]),L=X([{name:"数据分析工具",icon:"📊",tools:[{name:"数据分析",icon:"📊",description:"分析质量管理数据"},{name:"统计分析",icon:"📈",description:"执行统计分析"},{name:"数值计算",icon:"🧮",description:"执行数学计算"}]},{name:"可视化工具",icon:"📈",tools:[{name:"图表生成",icon:"📊",description:"生成数据可视化图表"},{name:"报告生成",icon:"📄",description:"生成质量分析报告"}]},{name:"联网工具",icon:"🌐",tools:[{name:"网络搜索",icon:"🔍",description:"搜索相关信息"}]},{name:"质量管理",icon:"🎯",tools:[{name:"库存查询",icon:"📦",description:"查询库存信息"},{name:"生产查询",icon:"🏭",description:"查询生产数据"},{name:"检测查询",icon:"🧪",description:"查询检测结果"}]}]),Q=t=>t?new Date(t).toLocaleTimeString():"",B=t=>t.replace(/\n/g,"<br>"),j=t=>({thinking:"🤔",analysis:"🔍",tool_selection:"🛠️",data_query:"📊",ai_call:"🤖",response:"💬"})[t]||"⚙️",R=t=>({processing:"处理中...",completed:"完成",error:"错误"})[t]||t,J=t=>typeof t=="object"?JSON.stringify(t,null,2):String(t),_=(t,e="info")=>{C.value=t,E.value=e,setTimeout(()=>{C.value=""},3e3)},U=t=>{const e=`请使用${t.name}工具帮我${t.description}`;u.value=e,M.success(`已选择工具：${t.name}`)},P=t=>{u.value=t,O()},q=()=>{const t=g.value?"AI增强模式":"基础模式";M.info(`已切换到${t}`),_(`已切换到${t}`,"success")},z=()=>{v.value=[{type:"ai",content:"对话已清空。您好！我是IQE AI智能助手，已接入DeepSeek大语言模型。",timestamp:new Date}],p.value=[],M.success("对话已清空")},H=()=>{const t={timestamp:new Date().toISOString(),messages:v.value,aiMode:g.value?"AI增强模式":"基础模式"},e=JSON.stringify(t,null,2),a=new Blob([e],{type:"application/json"}),c=URL.createObjectURL(a),f=document.createElement("a");f.href=c,f.download=`IQE-AI对话记录-${new Date().toISOString().slice(0,10)}.json`,f.click(),URL.revokeObjectURL(c),M.success("对话记录已导出")},N=()=>{te(()=>{A.value&&(A.value.scrollTop=A.value.scrollHeight)})},O=async()=>{if(!u.value.trim()||m.value)return;const t={type:"user",content:u.value,timestamp:new Date};v.value.push(t);const e=u.value;u.value="",N();try{await K(e)}catch(a){console.error("AI处理错误:",a),v.value.push({type:"ai",content:"抱歉，处理您的问题时出现了错误。请稍后重试。",timestamp:new Date}),_("处理失败，请稍后重试","error")}N()},K=async t=>{m.value=!0,p.value=[];try{await y("thinking","理解问题","processing",{question:t}),await D(500),h(0,"completed"),await y("analysis","分析问题类型","processing"),await D(300),h(1,"completed"),await y("data_query","获取业务数据","processing");const e=await F();await D(400),h(2,"completed"),await y("ai_call","调用DeepSeek AI","processing");let a;if(g.value)try{const c=await se.queryAI(t,e);a=c.response||c.answer||"抱歉，AI服务返回了空响应。",_("AI响应成功","success")}catch(c){console.error("AI调用失败:",c),a=`抱歉，AI服务暂时不可用。基于您的问题"${t}"，我为您提供基础分析...`,_("AI服务不可用，已切换到基础模式","error")}else a=`基础模式回复：我收到了您的问题"${t}"。这是一个关于质量管理的问题，我正在为您分析相关数据...`;h(3,"completed"),await y("response","生成回答","processing"),await D(200),h(4,"completed"),v.value.push({type:"ai",content:a,timestamp:new Date})}catch(e){throw console.error("处理AI响应时出错:",e),_("处理失败","error"),e}finally{m.value=!1}},y=async(t,e,a,c=null)=>{p.value.push({type:t,title:e,status:a,details:c})},h=(t,e,a=null)=>{p.value[t]&&(p.value[t].status=e,a&&(p.value[t].result=a))},D=t=>new Promise(e=>setTimeout(e,t)),F=async()=>{try{const t=JSON.parse(localStorage.getItem("inventoryData")||"[]"),e=JSON.parse(localStorage.getItem("productionData")||"[]"),a=JSON.parse(localStorage.getItem("testData")||"[]");return{inventoryCount:t.length,productionCount:e.length,testCount:a.length,factoryCount:3,timestamp:new Date().toISOString(),inventorySample:t.slice(0,5),productionSample:e.slice(0,5),testSample:a.slice(0,5)}}catch(t){console.error("获取业务数据失败:",t);try{const a=await(await fetch("/api/data/status")).json();if(a.success)return{inventoryCount:a.data.inventory,productionCount:a.data.online,testCount:a.data.lab,factoryCount:3,timestamp:a.data.lastSync}}catch(e){console.error("从API获取数据也失败:",e)}return{inventoryCount:132,productionCount:1056,testCount:396,factoryCount:3,timestamp:new Date().toISOString()}}};return G(()=>{console.log("🤖 IQE AI智能助手已加载"),_("AI智能助手已就绪，DeepSeek模型已连接","success")}),(t,e)=>{const a=b("el-switch"),c=b("el-button"),f=b("el-tag"),W=b("el-input");return o(),i("div",ae,[s("div",oe,[e[4]||(e[4]=s("h1",null,"🤖 QMS AI 智能助手",-1)),s("div",ie,[k(a,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=n=>g.value=n),onChange:q,"active-text":"AI增强模式","inactive-text":"基础模式",size:"large"},null,8,["modelValue"]),k(c,{onClick:z,type:"primary",plain:""},{default:T(()=>e[2]||(e[2]=[x("清空对话")])),_:1,__:[2]}),k(c,{onClick:H,type:"success",plain:""},{default:T(()=>e[3]||(e[3]=[x("导出对话")])),_:1,__:[3]})])]),s("div",le,[s("div",ce,[e[5]||(e[5]=s("div",{class:"column-header"},[s("h3",null,"🛠️ 可用工具")],-1)),s("div",re,[(o(!0),i(S,null,w(L,n=>(o(),i("div",{class:"tool-category",key:n.name},[s("h4",null,l(n.icon)+" "+l(n.name),1),(o(!0),i(S,null,w(n.tools,r=>(o(),i("div",{class:"tool-item",key:r.name,onClick:je=>U(r)},[s("span",de,l(r.icon),1),s("div",pe,[s("div",me,l(r.name),1),s("div",ve,l(r.description),1)])],8,ue))),128))]))),128))])]),s("div",_e,[s("div",ge,[e[6]||(e[6]=s("h3",null,"💬 智能问答",-1)),s("div",ye,[(o(!0),i(S,null,w($.value,n=>(o(),ee(f,{key:n,onClick:r=>P(n),class:"example-tag",type:"info",effect:"plain"},{default:T(()=>[x(l(n),1)]),_:2},1032,["onClick"]))),128))])]),s("div",{class:"messages-area",ref_key:"messagesArea",ref:A},[(o(!0),i(S,null,w(v.value,(n,r)=>(o(),i("div",{key:r,class:V(["chat-message",n.type])},[s("div",he,[n.type==="user"?(o(),i("span",fe,"👤")):(o(),i("span",ke,"🤖"))]),s("div",Se,[s("div",{class:"message-text",innerHTML:B(n.content)},null,8,we),s("div",Ie,l(Q(n.timestamp)),1)])],2))),128)),m.value?(o(),i("div",Ae,e[7]||(e[7]=[s("div",{class:"message-avatar"},"🤖",-1),s("div",{class:"message-body"},[s("div",{class:"typing-animation"},[s("span"),s("span"),s("span")]),s("div",{class:"loading-text"},"AI正在思考中...")],-1)]))):I("",!0)],512),s("div",Ce,[k(W,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=n=>u.value=n),type:"textarea",rows:3,placeholder:"请输入您的问题...",onKeydown:Y(Z(O,["ctrl"]),["enter"]),disabled:m.value,resize:"none"},null,8,["modelValue","onKeydown","disabled"]),s("div",De,[k(c,{onClick:O,type:"primary",loading:m.value,disabled:!u.value.trim()},{default:T(()=>[x(l(m.value?"发送中...":"发送 (Ctrl+Enter)"),1)]),_:1},8,["loading","disabled"])]),C.value?(o(),i("div",{key:0,class:V(["status-message",E.value])},l(C.value),3)):I("",!0)])]),s("div",be,[e[10]||(e[10]=s("div",{class:"column-header"},[s("h3",null,"🧠 AI思考过程")],-1)),s("div",Te,[p.value.length===0?(o(),i("div",xe,e[8]||(e[8]=[s("div",{class:"empty-icon"},"🤔",-1),s("div",{class:"empty-text"},"AI正在等待您的问题...",-1)]))):I("",!0),(o(!0),i(S,null,w(p.value,(n,r)=>(o(),i("div",{key:r,class:V(["thinking-step",n.status])},[s("div",Me,[s("span",Oe,l(j(n.type)),1),s("span",Ve,l(n.title),1),s("span",Ee,l(R(n.status)),1)]),n.details?(o(),i("div",Ne,[s("pre",null,l(JSON.stringify(n.details,null,2)),1)])):I("",!0),n.result?(o(),i("div",$e,[e[9]||(e[9]=s("div",{class:"result-label"},"执行结果:",-1)),s("div",Le,l(J(n.result)),1)])):I("",!0)],2))),128))])])])])}}},qe=ne(Qe,[["__scopeId","data-v-9d6757cd"]]);export{qe as default};
