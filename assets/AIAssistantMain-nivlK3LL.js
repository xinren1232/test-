import{S as u,aj as F,T as R,c as l,o as n,a as e,O as m,Q as A,P as f,e as w,F as v,r as _,b as E,_ as G,ai as H,t as o,X as J,n as V,V as h,W}from"./element-plus-DR-erZ3X.js";import{a as X,ax as Y}from"./index-Bo1zM2q5.js";import"./echarts-Dfqt_Pbx.js";const Z={class:"ai-assistant-main"},ee={class:"top-header"},se={class:"header-controls"},te={class:"three-column-layout"},ae={class:"left-column"},ne={class:"tools-section"},oe=["onClick"],ie={class:"tool-icon"},le={class:"tool-details"},ce={class:"tool-name"},re={class:"tool-desc"},de={class:"middle-column"},ue={class:"column-header"},pe={class:"quick-examples"},me={class:"message-avatar"},ve={class:"message-content"},_e={class:"message-text"},he={class:"message-time"},ye={key:0,class:"message ai"},ge={class:"input-section"},ke={class:"input-actions"},Ie={class:"right-column"},Ae={class:"thinking-area"},fe={key:0,class:"empty-state"},we={class:"step-header"},xe={class:"step-icon"},Ce={class:"step-title"},be={class:"step-status"},Te={__name:"AIAssistantMain",setup(Ee){const $=Y(),y=u(!0),d=u(!1),r=u(""),p=u([{type:"ai",content:"您好！我是IQE AI智能助手。我已接入DeepSeek大语言模型，可以为您提供专业的质量管理问答服务。",timestamp:new Date}]),i=u([]),g=u(null),S=u(["查询工厂A的库存情况","分析最近的质量趋势","生成质量报告","检查异常批次"]),D=F([{name:"数据分析工具",icon:"📊",tools:[{name:"数据分析",icon:"📊",description:"分析质量管理数据"},{name:"统计分析",icon:"📈",description:"执行统计分析"},{name:"数值计算",icon:"🔢",description:"执行数值计算分析"},{name:"数据验证",icon:"✅",description:"验证数据完整性"}]},{name:"可视化工具",icon:"📈",tools:[{name:"图表生成",icon:"📊",description:"生成数据可视化图表"},{name:"趋势分析",icon:"📈",description:"分析数据趋势变化"},{name:"报表生成",icon:"📄",description:"生成质量分析报表"}]},{name:"联网工具",icon:"🌐",tools:[{name:"网络搜索",icon:"🔍",description:"搜索相关信息"},{name:"API调用",icon:"🔗",description:"调用外部API接口"}]},{name:"质量管理",icon:"🎯",tools:[{name:"生产管理",icon:"🏭",description:"管理生产流程数据"}]}]),k={apiKey:"sk-cab797574abf4288bcfaca253191565d",baseURL:"https://api.deepseek.com",endpoint:"/chat/completions",model:"deepseek-chat"},Q=()=>{$.push("/")},B=()=>{h.info(`已切换到${y.value?"AI增强模式":"基础模式"}`)},M=()=>{p.value=[{type:"ai",content:"对话已清空。您好！我是IQE AI智能助手，已接入DeepSeek大语言模型。",timestamp:new Date}],i.value=[],h.success("对话已清空")},N=t=>{r.value=`请使用${t.name}工具帮我分析数据`,h.success(`已选择工具：${t.name}`)},P=t=>{r.value=t,x()},x=async()=>{if(!r.value.trim()||d.value)return;const t=r.value.trim();p.value.push({type:"user",content:t,timestamp:new Date}),r.value="",T();try{await K(t)}catch(s){console.error("AI处理错误:",s),p.value.push({type:"ai",content:"抱歉，处理您的问题时出现了错误。请稍后重试。",timestamp:new Date})}T()},K=async t=>{d.value=!0,i.value=[];try{i.value.push({type:"thinking",title:"理解问题",status:"processing"}),await C(500),i.value[0].status="completed",i.value.push({type:"data_query",title:"获取业务数据",status:"processing"}),await C(400),i.value[1].status="completed",i.value.push({type:"ai_call",title:"调用AI大模型",status:"processing"});let s;if(y.value)try{s=await z(t),h.success("AI响应成功")}catch(I){console.error("AI调用失败:",I),s=`抱歉，AI服务暂时不可用。基于您的问题"${t}"，我为您提供基础分析...`,h.error("AI服务不可用，已切换到基础模式")}else s=`基础模式回复：我收到了您的问题"${t}"。这是一个关于质量管理的问题，我正在为您分析相关数据...`;i.value[2].status="completed",i.value.push({type:"response",title:"生成回答",status:"processing"}),await C(200),i.value[3].status="completed",p.value.push({type:"ai",content:s,timestamp:new Date})}finally{d.value=!1}},z=async t=>{const s=await fetch(`${k.baseURL}${k.endpoint}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k.apiKey}`},body:JSON.stringify({model:k.model,messages:[{role:"system",content:"你是IQE质量管理系统的AI智能助手，专门负责质量管理数据分析和问答。请基于用户问题提供专业、准确、有用的回答。"},{role:"user",content:t}],temperature:.7,max_tokens:2e3})});if(!s.ok)throw new Error(`AI API错误: ${s.status}`);return(await s.json()).choices[0].message.content},C=t=>new Promise(s=>setTimeout(s,t)),L=t=>t?new Date(t).toLocaleTimeString():"",O=t=>({thinking:"🤔",data_query:"📊",ai_call:"🤖",response:"💬"})[t]||"⚙️",U=t=>({processing:"处理中...",completed:"完成"})[t]||t,T=()=>{W(()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)})};return R(()=>{console.log("🤖 IQE AI智能助手已加载")}),(t,s)=>{const I=A("el-switch"),b=A("el-button"),j=A("el-tag"),q=A("el-input");return n(),l("div",Z,[e("div",ee,[s[4]||(s[4]=e("h1",null,"🤖 IQE AI 智能助手",-1)),e("div",se,[m(I,{modelValue:y.value,"onUpdate:modelValue":s[0]||(s[0]=a=>y.value=a),onChange:B,"active-text":"AI增强模式","inactive-text":"基础模式",size:"large"},null,8,["modelValue"]),m(b,{onClick:M,type:"primary",plain:""},{default:f(()=>s[2]||(s[2]=[w("清空对话")])),_:1,__:[2]}),m(b,{onClick:Q,type:"info",plain:""},{default:f(()=>s[3]||(s[3]=[w("返回系统")])),_:1,__:[3]})])]),e("div",te,[e("div",ae,[s[5]||(s[5]=e("div",{class:"column-header"},[e("h3",null,"🛠️ 可用工具")],-1)),e("div",ne,[(n(!0),l(v,null,_(D,a=>(n(),l("div",{class:"tool-category",key:a.name},[e("h4",null,o(a.icon)+" "+o(a.name),1),(n(!0),l(v,null,_(a.tools,c=>(n(),l("div",{class:"tool-item",key:c.name,onClick:Ve=>N(c)},[e("span",ie,o(c.icon),1),e("div",le,[e("div",ce,o(c.name),1),e("div",re,o(c.description),1)])],8,oe))),128))]))),128))])]),e("div",de,[e("div",ue,[s[6]||(s[6]=e("h3",null,"💬 智能问答",-1)),e("div",pe,[(n(!0),l(v,null,_(S.value,a=>(n(),J(j,{key:a,onClick:c=>P(a),class:"example-tag",size:"small",effect:"plain"},{default:f(()=>[w(o(a),1)]),_:2},1032,["onClick"]))),128))])]),e("div",{class:"messages-area",ref_key:"messagesArea",ref:g},[(n(!0),l(v,null,_(p.value,(a,c)=>(n(),l("div",{key:c,class:V(["message",a.type])},[e("div",me,o(a.type==="user"?"👤":"🤖"),1),e("div",ve,[e("div",_e,o(a.content),1),e("div",he,o(L(a.timestamp)),1)])],2))),128)),d.value?(n(),l("div",ye,s[7]||(s[7]=[e("div",{class:"message-avatar"},"🤖",-1),e("div",{class:"message-content"},[e("div",{class:"loading-dots"},[e("span"),e("span"),e("span")]),e("div",{class:"loading-text"},"AI正在思考中...")],-1)]))):E("",!0)],512),e("div",ge,[m(q,{modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=a=>r.value=a),type:"textarea",rows:3,placeholder:"请输入您的问题...",onKeydown:G(H(x,["ctrl"]),["enter"]),disabled:d.value},null,8,["modelValue","onKeydown","disabled"]),e("div",ke,[m(b,{type:"primary",onClick:x,loading:d.value,disabled:!r.value.trim()},{default:f(()=>[w(o(d.value?"发送中...":"发送 (Ctrl+Enter)"),1)]),_:1},8,["loading","disabled"])])])]),e("div",Ie,[s[9]||(s[9]=e("div",{class:"column-header"},[e("h3",null,"🧠 AI思考过程")],-1)),e("div",Ae,[i.value.length===0?(n(),l("div",fe,s[8]||(s[8]=[e("div",{class:"empty-icon"},"🤔",-1),e("div",{class:"empty-text"},"AI正在等待您的问题...",-1)]))):E("",!0),(n(!0),l(v,null,_(i.value,(a,c)=>(n(),l("div",{key:c,class:V(["thinking-step",a.status])},[e("div",we,[e("span",xe,o(O(a.type)),1),e("span",Ce,o(a.title),1),e("span",be,o(U(a.status)),1)])],2))),128))])])])])}}},Qe=X(Te,[["__scopeId","data-v-826972aa"]]);export{Qe as default};
