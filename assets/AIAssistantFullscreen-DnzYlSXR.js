import{S as u,aj as U,T as j,c as o,o as a,a as e,O as v,Q as k,P as f,e as I,F as _,r as h,b as T,_ as q,ai as G,t as l,X as H,n as V,V as $,W as J}from"./element-plus-DR-erZ3X.js";import{ax as W}from"./index-Bo1zM2q5.js";import"./echarts-Dfqt_Pbx.js";const X={class:"fullscreen-ai-assistant"},Y={class:"ai-header"},Z={class:"ai-controls"},ee={class:"ai-main-content"},te={class:"ai-left-panel"},se={class:"tools-list"},ne=["onClick"],ae={class:"tool-icon"},oe={class:"tool-info"},ie={class:"tool-name"},le={class:"tool-desc"},ce={class:"ai-center-panel"},re={class:"panel-header"},de={class:"quick-questions"},ue={class:"msg-avatar"},pe={key:0},me={key:1},ve={class:"msg-content"},_e={class:"msg-text"},he={class:"msg-time"},ye={key:0,class:"chat-msg ai loading"},ge={class:"input-section"},ke={class:"input-actions"},fe={class:"ai-right-panel"},Ie={class:"thinking-area"},we={key:0,class:"empty-state"},Ae={class:"step-header"},xe={class:"step-icon"},Ce={class:"step-title"},be={class:"step-status"},De={__name:"AIAssistantFullscreen",setup(Te){const E=W(),r=u(""),m=u([{type:"ai",content:"您好！我是IQE AI智能助手。我已接入DeepSeek大语言模型，可以为您提供专业的质量管理问答服务。",timestamp:new Date}]),d=u(!1),w=u(!0),i=u([]),y=u(null),g={apiKey:"sk-cab797574abf4288bcfaca253191565d",baseURL:"https://api.deepseek.com",endpoint:"/chat/completions",model:"deepseek-chat"},S=u(["查询工厂A的库存情况","分析最近的质量趋势","生成质量报告","统计不合格品数量","查看生产线状态","检测异常物料批次"]),D=U([{name:"数据分析工具",icon:"📊",tools:[{name:"数据分析",icon:"📊",description:"分析质量管理数据"},{name:"统计分析",icon:"📈",description:"执行统计分析"},{name:"数值计算",icon:"🧮",description:"执行数学计算"}]},{name:"可视化工具",icon:"📈",tools:[{name:"图表生成",icon:"📊",description:"生成数据可视化图表"},{name:"报告生成",icon:"📄",description:"生成质量分析报告"}]},{name:"联网工具",icon:"🌐",tools:[{name:"网络搜索",icon:"🔍",description:"搜索相关信息"}]},{name:"质量管理",icon:"🎯",tools:[{name:"库存查询",icon:"📦",description:"查询库存信息"},{name:"生产查询",icon:"🏭",description:"查询生产数据"},{name:"检测查询",icon:"🧪",description:"查询检测结果"}]}]),Q=s=>s?new Date(s).toLocaleTimeString():"",B=s=>({thinking:"🤔",analysis:"🔍",data_query:"📊",ai_call:"🤖",response:"💬"})[s]||"⚙️",M=s=>({processing:"处理中...",completed:"完成",error:"错误"})[s]||s,b=()=>{J(()=>{y.value&&(y.value.scrollTop=y.value.scrollHeight)})},N=()=>{E.push("/")},K=s=>{const t=`请使用${s.name}工具帮我${s.description}`;r.value=t,$.success(`已选择工具：${s.name}`)},P=s=>{r.value=s,A()},z=()=>{m.value=[{type:"ai",content:"对话已清空。您好！我是IQE AI智能助手，已接入DeepSeek大语言模型。",timestamp:new Date}],i.value=[],$.success("对话已清空")},A=async()=>{if(!r.value.trim()||d.value)return;const s={type:"user",content:r.value,timestamp:new Date};m.value.push(s);const t=r.value;r.value="",b();try{await F(t)}catch(p){console.error("AI处理错误:",p),m.value.push({type:"ai",content:"抱歉，处理您的问题时出现了错误。请稍后重试。",timestamp:new Date})}b()},F=async s=>{d.value=!0,i.value=[];try{i.value.push({type:"thinking",title:"理解问题",status:"processing"}),await x(500),i.value[0].status="completed",i.value.push({type:"data_query",title:"获取业务数据",status:"processing"}),await x(400),i.value[1].status="completed",i.value.push({type:"ai_call",title:"调用AI大模型",status:"processing"});let t;if(w.value)try{t=await L(s)}catch(p){console.error("AI调用失败:",p),t=`抱歉，AI服务暂时不可用。基于您的问题"${s}"，我为您提供基础分析...`}else t=`基础模式回复：我收到了您的问题"${s}"。这是一个关于质量管理的问题，我正在为您分析相关数据...`;i.value[2].status="completed",i.value.push({type:"response",title:"生成回答",status:"processing"}),await x(200),i.value[3].status="completed",m.value.push({type:"ai",content:t,timestamp:new Date})}catch(t){throw console.error("处理AI响应时出错:",t),t}finally{d.value=!1}},L=async s=>{const t=await fetch(`${g.baseURL}${g.endpoint}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g.apiKey}`},body:JSON.stringify({model:g.model,messages:[{role:"system",content:"你是IQE质量管理系统的AI智能助手，专门负责质量管理数据分析和问答。请基于用户问题提供专业、准确、有用的回答。"},{role:"user",content:s}],temperature:.7,max_tokens:2e3})});if(!t.ok)throw new Error(`AI API错误: ${t.status}`);return(await t.json()).choices[0].message.content},x=s=>new Promise(t=>setTimeout(t,s));return j(()=>{console.log("🤖 IQE AI智能助手已加载")}),(s,t)=>{const p=k("el-switch"),C=k("el-button"),O=k("el-tag"),R=k("el-input");return a(),o("div",X,[e("div",Y,[t[4]||(t[4]=e("h1",null,"🤖 IQE AI 智能助手",-1)),e("div",Z,[v(p,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=n=>w.value=n),"active-text":"AI增强模式","inactive-text":"基础模式",size:"large"},null,8,["modelValue"]),v(C,{onClick:z,type:"primary",plain:""},{default:f(()=>t[2]||(t[2]=[I("清空对话")])),_:1,__:[2]}),v(C,{onClick:N,type:"info",plain:""},{default:f(()=>t[3]||(t[3]=[I("返回系统")])),_:1,__:[3]})])]),e("div",ee,[e("div",te,[t[5]||(t[5]=e("div",{class:"panel-header"},[e("h3",null,"🛠️ 可用工具")],-1)),e("div",se,[(a(!0),o(_,null,h(D,n=>(a(),o("div",{class:"tool-group",key:n.name},[e("h4",null,l(n.icon)+" "+l(n.name),1),(a(!0),o(_,null,h(n.tools,c=>(a(),o("div",{class:"tool-item",key:c.name,onClick:Ve=>K(c)},[e("span",ae,l(c.icon),1),e("div",oe,[e("div",ie,l(c.name),1),e("div",le,l(c.description),1)])],8,ne))),128))]))),128))])]),e("div",ce,[e("div",re,[t[6]||(t[6]=e("h3",null,"💬 智能问答",-1)),e("div",de,[(a(!0),o(_,null,h(S.value,n=>(a(),H(O,{key:n,onClick:c=>P(n),class:"question-tag",type:"info",effect:"plain"},{default:f(()=>[I(l(n),1)]),_:2},1032,["onClick"]))),128))])]),e("div",{class:"chat-area",ref_key:"chatArea",ref:y},[(a(!0),o(_,null,h(m.value,(n,c)=>(a(),o("div",{key:c,class:V(["chat-msg",n.type])},[e("div",ue,[n.type==="user"?(a(),o("span",pe,"👤")):(a(),o("span",me,"🤖"))]),e("div",ve,[e("div",_e,l(n.content),1),e("div",he,l(Q(n.timestamp)),1)])],2))),128)),d.value?(a(),o("div",ye,t[7]||(t[7]=[e("div",{class:"msg-avatar"},"🤖",-1),e("div",{class:"msg-content"},[e("div",{class:"loading-dots"},[e("span"),e("span"),e("span")]),e("div",{class:"loading-text"},"AI正在思考中...")],-1)]))):T("",!0)],512),e("div",ge,[v(R,{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=n=>r.value=n),type:"textarea",rows:3,placeholder:"请输入您的问题...",onKeydown:q(G(A,["ctrl"]),["enter"]),disabled:d.value,resize:"none"},null,8,["modelValue","onKeydown","disabled"]),e("div",ke,[v(C,{onClick:A,type:"primary",loading:d.value,disabled:!r.value.trim()},{default:f(()=>[I(l(d.value?"发送中...":"发送 (Ctrl+Enter)"),1)]),_:1},8,["loading","disabled"])])])]),e("div",fe,[t[9]||(t[9]=e("div",{class:"panel-header"},[e("h3",null,"🧠 AI思考过程")],-1)),e("div",Ie,[i.value.length===0?(a(),o("div",we,t[8]||(t[8]=[e("div",{class:"empty-icon"},"🤔",-1),e("div",{class:"empty-text"},"AI正在等待您的问题...",-1)]))):T("",!0),(a(!0),o(_,null,h(i.value,(n,c)=>(a(),o("div",{key:c,class:V(["thinking-step",n.status])},[e("div",Ae,[e("span",xe,l(B(n.type)),1),e("span",Ce,l(n.title),1),e("span",be,l(M(n.status)),1)])],2))),128))])])])])}}};export{De as default};
