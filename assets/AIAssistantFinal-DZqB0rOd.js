import{S as p,aj as K,T as P,c as n,o,a as e,O as h,Q as A,P as S,e as C,F as I,r as k,b as D,_ as H,ai as W,t as i,n as E,X,V as x,W as G}from"./element-plus-DR-erZ3X.js";import{a as Y}from"./aiService-CKXedvtd.js";import{a as Z}from"./index-Bo1zM2q5.js";import"./echarts-Dfqt_Pbx.js";const ee={class:"ai-assistant-container"},te={class:"top-header"},se={class:"header-controls"},ae={class:"three-column-layout"},oe={class:"left-column"},ne={class:"tools-section"},ie=["onClick"],le={class:"tool-icon"},ce={class:"tool-details"},re={class:"tool-name"},ue={class:"tool-desc"},de={class:"middle-column"},pe={class:"column-header"},me={class:"quick-examples"},ve={class:"message-avatar"},_e={key:0},ge={key:1},ye={class:"message-body"},he={class:"message-text"},Ie={class:"message-timestamp"},ke={key:0,class:"chat-message ai loading-message"},fe={class:"input-area"},we={class:"input-controls"},Ae={class:"right-column"},Se={class:"thinking-area"},Ce={key:0,class:"empty-thinking"},De={class:"step-header"},xe={class:"step-icon"},be={class:"step-title"},Te={class:"step-status"},Ee={key:0,class:"step-result"},Oe={class:"result-content"},Ve={__name:"AIAssistantFinal",setup(Me){const d=p(""),v=p([{type:"ai",content:"您好！我是IQE AI智能助手。我已接入DeepSeek大语言模型，可以为您提供专业的质量管理问答服务。",timestamp:new Date}]),m=p(!1),g=p(!0),l=p([]),f=p(null),w=p(""),O=p("info"),M=p(["查询工厂A的库存情况","分析最近的质量趋势","生成质量报告","统计不合格品数量","查看生产线状态","检测异常物料批次"]),$=K([{name:"数据分析工具",icon:"📊",tools:[{name:"数据分析",icon:"📊",description:"分析质量管理数据"},{name:"统计分析",icon:"📈",description:"执行统计分析"},{name:"数值计算",icon:"🧮",description:"执行数学计算"}]},{name:"可视化工具",icon:"📈",tools:[{name:"图表生成",icon:"📊",description:"生成数据可视化图表"},{name:"报告生成",icon:"📄",description:"生成质量分析报告"}]},{name:"联网工具",icon:"🌐",tools:[{name:"网络搜索",icon:"🔍",description:"搜索相关信息"}]},{name:"质量管理",icon:"🎯",tools:[{name:"库存查询",icon:"📦",description:"查询库存信息"},{name:"生产查询",icon:"🏭",description:"查询生产数据"},{name:"检测查询",icon:"🧪",description:"查询检测结果"}]}]),Q=s=>s?new Date(s).toLocaleTimeString():"",B=s=>({thinking:"🤔",analysis:"🔍",data_query:"📊",ai_call:"🤖",response:"💬"})[s]||"⚙️",N=s=>({processing:"处理中...",completed:"完成",error:"错误"})[s]||s,_=(s,t="info")=>{w.value=s,O.value=t,setTimeout(()=>{w.value=""},3e3)},V=()=>{G(()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)})},L=s=>{const t=`请使用${s.name}工具帮我${s.description}`;d.value=t,x.success(`已选择工具：${s.name}`)},R=s=>{d.value=s,b()},U=()=>{const s=g.value?"AI增强模式":"基础模式";x.info(`已切换到${s}`),_(`已切换到${s}`,"success")},j=()=>{v.value=[{type:"ai",content:"对话已清空。您好！我是IQE AI智能助手，已接入DeepSeek大语言模型。",timestamp:new Date}],l.value=[],x.success("对话已清空")},q=()=>{const s={timestamp:new Date().toISOString(),messages:v.value,aiMode:g.value?"AI增强模式":"基础模式"},t=JSON.stringify(s,null,2),c=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(c),y=document.createElement("a");y.href=r,y.download=`IQE-AI对话记录-${new Date().toISOString().slice(0,10)}.json`,y.click(),URL.revokeObjectURL(r),x.success("对话记录已导出")},b=async()=>{if(!d.value.trim()||m.value)return;const s={type:"user",content:d.value,timestamp:new Date};v.value.push(s);const t=d.value;d.value="",V();try{await F(t)}catch(c){console.error("AI处理错误:",c),v.value.push({type:"ai",content:"抱歉，处理您的问题时出现了错误。请稍后重试。",timestamp:new Date}),_("处理失败，请稍后重试","error")}V()},F=async s=>{m.value=!0,l.value=[];try{l.value.push({type:"thinking",title:"理解问题",status:"processing"}),await T(500),l.value[0].status="completed",l.value.push({type:"data_query",title:"获取业务数据",status:"processing"});const t=await J();await T(400),l.value[1].status="completed",l.value.push({type:"ai_call",title:"调用AI大模型",status:"processing"});let c;if(g.value)try{const r=await Y.queryAI(s,t);c=r.response||r.answer||r.content||"抱歉，AI服务返回了空响应。",_("AI响应成功","success")}catch(r){console.error("AI调用失败:",r),c=`抱歉，AI服务暂时不可用。基于您的问题"${s}"，我为您提供基础分析...`,_("AI服务不可用，已切换到基础模式","error")}else c=`基础模式回复：我收到了您的问题"${s}"。这是一个关于质量管理的问题，我正在为您分析相关数据...`;l.value[2].status="completed",l.value.push({type:"response",title:"生成回答",status:"processing"}),await T(200),l.value[3].status="completed",v.value.push({type:"ai",content:c,timestamp:new Date})}catch(t){throw console.error("处理AI响应时出错:",t),_("处理失败","error"),t}finally{m.value=!1}},J=async()=>{try{const s=JSON.parse(localStorage.getItem("inventoryData")||"[]"),t=JSON.parse(localStorage.getItem("productionData")||"[]"),c=JSON.parse(localStorage.getItem("testData")||"[]");return{inventoryCount:s.length,productionCount:t.length,testCount:c.length,factoryCount:3,timestamp:new Date().toISOString()}}catch(s){return console.error("获取业务数据失败:",s),{inventoryCount:132,productionCount:1056,testCount:396,factoryCount:3,timestamp:new Date().toISOString()}}},T=s=>new Promise(t=>setTimeout(t,s));return P(()=>{console.log("🤖 IQE AI智能助手已加载"),_("AI智能助手已就绪，DeepSeek模型已连接","success")}),(s,t)=>{const c=A("el-switch"),r=A("el-button"),y=A("el-tag"),z=A("el-input");return o(),n("div",ee,[e("div",te,[t[4]||(t[4]=e("h1",null,"🤖 IQE AI 智能助手",-1)),e("div",se,[h(c,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a),onChange:U,"active-text":"AI增强模式","inactive-text":"基础模式",size:"large"},null,8,["modelValue"]),h(r,{onClick:j,type:"primary",plain:""},{default:S(()=>t[2]||(t[2]=[C("清空对话")])),_:1,__:[2]}),h(r,{onClick:q,type:"success",plain:""},{default:S(()=>t[3]||(t[3]=[C("导出对话")])),_:1,__:[3]})])]),e("div",ae,[e("div",oe,[t[5]||(t[5]=e("div",{class:"column-header"},[e("h3",null,"🛠️ 可用工具")],-1)),e("div",ne,[(o(!0),n(I,null,k($,a=>(o(),n("div",{class:"tool-category",key:a.name},[e("h4",null,i(a.icon)+" "+i(a.name),1),(o(!0),n(I,null,k(a.tools,u=>(o(),n("div",{class:"tool-item",key:u.name,onClick:$e=>L(u)},[e("span",le,i(u.icon),1),e("div",ce,[e("div",re,i(u.name),1),e("div",ue,i(u.description),1)])],8,ie))),128))]))),128))])]),e("div",de,[e("div",pe,[t[6]||(t[6]=e("h3",null,"💬 智能问答",-1)),e("div",me,[(o(!0),n(I,null,k(M.value,a=>(o(),X(y,{key:a,onClick:u=>R(a),class:"example-tag",type:"info",effect:"plain"},{default:S(()=>[C(i(a),1)]),_:2},1032,["onClick"]))),128))])]),e("div",{class:"messages-area",ref_key:"messagesArea",ref:f},[(o(!0),n(I,null,k(v.value,(a,u)=>(o(),n("div",{key:u,class:E(["chat-message",a.type])},[e("div",ve,[a.type==="user"?(o(),n("span",_e,"👤")):(o(),n("span",ge,"🤖"))]),e("div",ye,[e("div",he,i(a.content),1),e("div",Ie,i(Q(a.timestamp)),1)])],2))),128)),m.value?(o(),n("div",ke,t[7]||(t[7]=[e("div",{class:"message-avatar"},"🤖",-1),e("div",{class:"message-body"},[e("div",{class:"typing-animation"},[e("span"),e("span"),e("span")]),e("div",{class:"loading-text"},"AI正在思考中...")],-1)]))):D("",!0)],512),e("div",fe,[h(z,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=a=>d.value=a),type:"textarea",rows:3,placeholder:"请输入您的问题...",onKeydown:H(W(b,["ctrl"]),["enter"]),disabled:m.value,resize:"none"},null,8,["modelValue","onKeydown","disabled"]),e("div",we,[h(r,{onClick:b,type:"primary",loading:m.value,disabled:!d.value.trim()},{default:S(()=>[C(i(m.value?"发送中...":"发送 (Ctrl+Enter)"),1)]),_:1},8,["loading","disabled"])]),w.value?(o(),n("div",{key:0,class:E(["status-message",O.value])},i(w.value),3)):D("",!0)])]),e("div",Ae,[t[9]||(t[9]=e("div",{class:"column-header"},[e("h3",null,"🧠 AI思考过程")],-1)),e("div",Se,[l.value.length===0?(o(),n("div",Ce,t[8]||(t[8]=[e("div",{class:"empty-icon"},"🤔",-1),e("div",{class:"empty-text"},"AI正在等待您的问题...",-1)]))):D("",!0),(o(!0),n(I,null,k(l.value,(a,u)=>(o(),n("div",{key:u,class:E(["thinking-step",a.status])},[e("div",De,[e("span",xe,i(B(a.type)),1),e("span",be,i(a.title),1),e("span",Te,i(N(a.status)),1)]),a.result?(o(),n("div",Ee,[e("div",Oe,i(a.result),1)])):D("",!0)],2))),128))])])])])}}},Re=Z(Ve,[["__scopeId","data-v-12e1f8b9"]]);export{Re as default};
