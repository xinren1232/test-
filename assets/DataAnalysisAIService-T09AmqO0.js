class l{constructor(){this.apiEndpoint="/api/ai/analysis",this.models={dataInsights:"gpt-4-turbo",recommendations:"gpt-3.5-turbo",summary:"gpt-4"}}async generateDataInsights(i,e){try{const t=this.buildInsightsPrompt(i,e);await new Promise(o=>setTimeout(o,1500));const s=[];i.totalRecords>5e4?s.push({type:"scale",level:"info",title:"大规模数据集检测",description:`数据集包含${i.totalRecords.toLocaleString()}条记录，属于大规模数据。建议采用分批处理和索引优化策略以提升处理效率。`,confidence:.95,impact:"medium",actionable:!0,recommendations:["实施数据分片策略","建立适当的索引","考虑使用并行处理"]}):i.totalRecords>1e4&&s.push({type:"scale",level:"info",title:"中等规模数据集",description:`数据集包含${i.totalRecords.toLocaleString()}条记录，规模适中，适合进行深度分析和机器学习建模。`,confidence:.9,impact:"low",actionable:!1}),e.overallScore>=90?s.push({type:"quality",level:"success",title:"优秀的数据质量",description:`数据质量评分为${e.overallScore}分，达到优秀水平。数据完整性、一致性和准确性都表现良好，可直接用于高价值分析和决策支持。`,confidence:.98,impact:"high",actionable:!1}):e.overallScore>=75?s.push({type:"quality",level:"warning",title:"良好的数据质量，有改进空间",description:`数据质量评分为${e.overallScore}分，整体良好但仍有提升空间。建议重点关注${this.identifyWeakAreas(e)}。`,confidence:.85,impact:"medium",actionable:!0,recommendations:this.generateQualityImprovements(e)}):s.push({type:"quality",level:"error",title:"数据质量需要重点改进",description:`数据质量评分为${e.overallScore}分，存在较多质量问题。建议实施全面的数据治理计划。`,confidence:.92,impact:"high",actionable:!0,recommendations:["建立数据质量监控体系","制定数据清洗标准流程","实施数据验证规则","培训数据管理团队"]}),i.totalFields>50&&s.push({type:"structure",level:"warning",title:"复杂的数据结构",description:`数据包含${i.totalFields}个字段，结构较为复杂。建议进行字段重要性分析和维度降维。`,confidence:.8,impact:"medium",actionable:!0,recommendations:["进行特征重要性分析","考虑主成分分析(PCA)","建立字段分类体系","优化数据模型设计"]});const n=this.analyzeFieldTypes(i.fieldTypes);return n.mixed>.3&&s.push({type:"types",level:"warning",title:"数据类型不一致问题",description:`检测到${Math.round(n.mixed*100)}%的字段存在混合数据类型，可能影响分析准确性。`,confidence:.88,impact:"medium",actionable:!0,recommendations:["标准化数据类型定义","实施数据类型验证","建立类型转换规则"]}),s}catch(t){return console.error("生成数据洞察失败:",t),this.getFallbackInsights(i,e)}}async generateAIRecommendations(i,e,t){var s;try{await new Promise(c=>setTimeout(c,1200));const n=[];((s=e.performance)==null?void 0:s.efficiency)<100&&n.push({category:"performance",priority:"medium",title:"处理性能优化建议",description:"当前数据处理效率可以进一步提升，建议采用以下优化策略",confidence:.85,estimatedImpact:"提升20-30%处理速度",timeToImplement:"1-2周",suggestions:[{action:"实施并行处理",description:"对大数据集采用多线程或分布式处理",difficulty:"medium",cost:"low"},{action:"优化数据清洗规则",description:"精简和优化清洗规则，减少不必要的处理步骤",difficulty:"low",cost:"low"},{action:"使用更高效的数据结构",description:"采用列式存储或内存数据库提升访问速度",difficulty:"high",cost:"medium"}]}),i.overallScore<85&&n.push({category:"quality",priority:"high",title:"数据质量提升计划",description:"制定系统性的数据质量改进策略，建立长期质量保障机制",confidence:.92,estimatedImpact:"提升数据质量15-25分",timeToImplement:"2-4周",suggestions:[{action:"建立数据质量监控体系",description:"实施实时数据质量监控和告警机制",difficulty:"medium",cost:"medium"},{action:"制定数据标准和规范",description:"建立统一的数据定义、格式和质量标准",difficulty:"low",cost:"low"},{action:"实施定期数据清洗流程",description:"建立自动化的数据清洗和验证流程",difficulty:"medium",cost:"medium"}]});const o=t.filter(c=>c.impact==="high"&&c.actionable);return o.length>0&&n.push({category:"insights",priority:"high",title:"基于AI洞察的行动建议",description:"根据数据分析发现的关键问题，建议优先处理以下事项",confidence:.9,estimatedImpact:"显著提升数据价值",timeToImplement:"1-3周",suggestions:o.map(c=>({action:c.title,description:c.description,difficulty:"medium",cost:"low",recommendations:c.recommendations||[]}))}),n.push({category:"architecture",priority:"low",title:"技术架构优化建议",description:"长期技术架构改进建议，提升系统整体能力",confidence:.75,estimatedImpact:"提升系统可扩展性和稳定性",timeToImplement:"1-3个月",suggestions:[{action:"实施数据湖架构",description:"建立统一的数据存储和处理平台",difficulty:"high",cost:"high"},{action:"集成机器学习管道",description:"建立自动化的ML模型训练和部署流程",difficulty:"high",cost:"medium"},{action:"实施数据血缘追踪",description:"建立完整的数据流向和变更追踪机制",difficulty:"medium",cost:"medium"}]}),n}catch(n){return console.error("生成AI建议失败:",n),this.getFallbackRecommendations()}}async generateExecutiveSummary(i,e,t,s){try{return await new Promise(o=>setTimeout(o,800)),{overview:this.generateOverviewText(i,e),keyFindings:this.extractKeyFindings(i,e,t),recommendations:this.prioritizeRecommendations(s),nextSteps:this.generateNextSteps(e,s),riskAssessment:this.assessRisks(e,t),businessImpact:this.assessBusinessImpact(e,i)}}catch(n){return console.error("生成执行摘要失败:",n),this.getFallbackSummary(i,e)}}buildInsightsPrompt(i,e){return`
      分析以下数据集的特征和质量状况：
      
      数据概览：
      - 记录数：${i.totalRecords}
      - 字段数：${i.totalFields}
      - 数据大小：${i.dataSize}
      
      质量评分：
      - 整体质量：${e.overallScore}/100
      - 完整性：${i.completenessRate}%
      - 一致性：${i.consistencyRate}%
      
      请提供专业的数据分析洞察和建议。
    `}identifyWeakAreas(i){var t,s,n,o,c,r;const e=[];return((s=(t=i.dimensions)==null?void 0:t.completeness)==null?void 0:s.score)<80&&e.push("数据完整性"),((o=(n=i.dimensions)==null?void 0:n.consistency)==null?void 0:o.score)<80&&e.push("数据一致性"),((r=(c=i.dimensions)==null?void 0:c.accuracy)==null?void 0:r.score)<80&&e.push("数据准确性"),e.length>0?e.join("、"):"各项指标"}generateQualityImprovements(i){var t,s,n,o,c,r;const e=[];return((s=(t=i.dimensions)==null?void 0:t.completeness)==null?void 0:s.score)<80&&(e.push("补充缺失数据字段"),e.push("建立数据收集标准")),((o=(n=i.dimensions)==null?void 0:n.consistency)==null?void 0:o.score)<80&&(e.push("统一数据格式标准"),e.push("实施数据验证规则")),((r=(c=i.dimensions)==null?void 0:c.accuracy)==null?void 0:r.score)<80&&(e.push("加强数据源头质量控制"),e.push("建立数据校验机制")),e}analyzeFieldTypes(i){if(!i)return{mixed:0};const e=Object.keys(i).length;let t=0;return Object.values(i).forEach(s=>{Array.isArray(s)&&s.length>1&&t++}),{mixed:e>0?t/e:0}}generateOverviewText(i,e){return`本次分析处理了包含${i.totalRecords.toLocaleString()}条记录、${i.totalFields}个字段的数据集，数据规模为${i.dataSize}。经过全面的质量评估，数据整体质量评分为${e.overallScore}/100分，${e.overallScore>=85?"达到优秀水平":e.overallScore>=70?"处于良好水平":"需要重点改进"}。`}extractKeyFindings(i,e,t){const s=[`数据质量评分：${e.overallScore}/100分`,`数据完整性：${i.completenessRate}%`,`数据一致性：${i.consistencyRate}%`];return t.filter(o=>o.impact==="high").forEach(o=>{s.push(o.title)}),s}prioritizeRecommendations(i){return i.sort((e,t)=>{const s={high:3,medium:2,low:1};return s[t.priority]-s[e.priority]}).slice(0,5).map(e=>e.title)}generateNextSteps(i,e){const t=[];return i.overallScore<80&&t.push("立即启动数据质量改进计划"),t.push("建立数据质量监控机制"),t.push("制定数据维护计划"),t.push("培训相关人员数据管理最佳实践"),t}assessRisks(i,e){const t=[];return i.overallScore<70&&t.push({type:"quality",level:"high",description:"数据质量较低可能影响分析结果的可靠性"}),e.filter(n=>n.level==="error").length>0&&t.push({type:"structural",level:"medium",description:"数据结构问题可能影响后续处理效率"}),t}assessBusinessImpact(i,e){const t={current:i.overallScore>=85?"high":i.overallScore>=70?"medium":"low",potential:"high",description:""};return t.current==="high"?t.description="数据质量优秀，可直接支持关键业务决策和高价值分析":t.current==="medium"?t.description="数据质量良好，适合大部分业务分析，建议进一步优化以支持更高价值应用":t.description="数据质量需要改进，建议优先处理质量问题后再进行业务分析",t}getFallbackInsights(i,e){return[{type:"quality",level:e.overallScore>=80?"success":"warning",title:"数据质量评估",description:`数据质量评分为${e.overallScore}分`,confidence:.8}]}getFallbackRecommendations(){return[{category:"general",priority:"medium",title:"建立数据质量监控",description:"实施基础的数据质量监控机制",suggestions:[{action:"定期数据质量检查",description:"建立定期检查流程"}]}]}getFallbackSummary(i,e){return{overview:`处理了${i.totalRecords}条记录的数据集`,keyFindings:[`数据质量评分：${e.overallScore}/100`],recommendations:["建立数据质量监控机制"],nextSteps:["制定数据维护计划"],riskAssessment:[],businessImpact:{current:"medium",potential:"high",description:"数据具有良好的业务价值潜力"}}}}const m=new l;export{l as DataAnalysisAIService,m as default};
