import{S as p,aj as ue,T as pe,V as v,c,o as i,a as e,O as l,n as V,t as o,Q as w,a0 as I,ak as ve,al as ge,F as S,r as C,b as y,R as me,_ as _e,ai as ye,P as u,am as fe,an as he,e as B,a8 as ke,d as be,X as O,ao as we,W as Ie,ap as Ae}from"./element-plus-DR-erZ3X.js";import{a as Se,ax as Ce}from"./index-Bo1zM2q5.js";import"./echarts-Dfqt_Pbx.js";const xe={class:"ai-assistant-redesigned"},$e={class:"top-navbar"},Te={class:"navbar-right"},De={class:"main-content"},Ve={class:"left-panel"},Me={class:"tools-grid"},ze=["onClick"],Be={class:"tool-info"},Ee={key:0,class:"tool-badge"},Le={class:"quick-actions"},Ne={class:"action-buttons"},Qe={class:"center-panel"},Re={class:"chat-header"},Oe={class:"chat-title"},Fe={class:"chat-stats"},qe={class:"quick-questions"},Ke={key:0,class:"welcome-message"},Ue={class:"message-avatar"},je={class:"avatar-icon"},Je={key:0,class:"avatar-status"},Pe={class:"message-bubble"},He=["innerHTML"],Ge={class:"message-meta"},We={class:"message-time"},Xe={key:0,class:"message-actions"},Ye={key:1,class:"message-item ai loading"},Ze={class:"chat-input"},et={class:"input-container"},tt={class:"input-actions"},st={class:"input-tools"},at={class:"right-panel"},nt={class:"thinking-steps"},ot={key:0,class:"empty-thinking"},it={class:"step-indicator"},lt={class:"step-number"},ct={key:0,class:"step-line"},rt={class:"step-content"},dt={class:"step-header"},ut={class:"step-icon"},pt={class:"step-title"},vt={class:"step-status"},gt={key:0,class:"step-details"},mt={key:1,class:"step-progress"},_t={class:"data-stats"},yt={class:"stats-grid"},ft={class:"stat-item"},ht={class:"stat-value"},kt={class:"stat-item"},bt={class:"stat-value"},wt={class:"stat-item"},It={class:"stat-value"},At={__name:"AIAssistantRedesigned",setup(St){const F=Ce(),k=p(!0),h=p(!1),m=p(""),f=p([]),_=p([]),M=p(null),E=p(0),x=p(null),n=ue({inventory:0,production:0,inspection:0,lastSync:null}),q=p([{id:"data-analysis",name:"数据分析",icon:"📊",description:"深度分析质量管理数据",category:"分析",color:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{id:"trend-analysis",name:"趋势分析",icon:"📈",description:"识别数据变化趋势",category:"分析",color:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"},{id:"chart-generation",name:"图表生成",icon:"📊",description:"生成可视化图表",category:"可视化",color:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"},{id:"report-generation",name:"报告生成",icon:"📄",description:"自动生成分析报告",category:"报告",color:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"},{id:"inventory-query",name:"库存查询",icon:"📦",description:"查询库存状态信息",category:"查询",color:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)"},{id:"production-query",name:"生产查询",icon:"🏭",description:"查询生产线数据",category:"查询",color:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"},{id:"quality-inspection",name:"质量检测",icon:"🔍",description:"检测质量异常",category:"检测",color:"linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)"},{id:"web-search",name:"网络搜索",icon:"🌐",description:"搜索相关信息",category:"搜索",color:"linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)"}]),K=p([{text:"数据概览",icon:"📊",type:"primary",action:"overview"},{text:"异常检测",icon:"⚠️",type:"warning",action:"anomaly"},{text:"质量报告",icon:"📋",type:"success",action:"report"},{text:"趋势预测",icon:"🔮",type:"info",action:"prediction"}]),U=p(["查询工厂A的库存情况","分析最近一周的质量趋势","生成本月质量分析报告","检查是否有异常批次","预测下月质量风险","对比各工厂质量表现"]),$={apiKey:"sk-cab797574abf4288bcfaca253191565d",baseURL:"https://api.deepseek.com",endpoint:"/chat/completions",model:"deepseek-chat"},j=()=>{F.push("/")},J=()=>{v({message:`已切换到${k.value?"AI增强模式":"基础模式"}`,type:"info",duration:2e3})},P=async()=>{try{await Ae.confirm("确定要清空所有对话记录吗？","清空对话",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.value=[],_.value=[],M.value=null,v({type:"success",message:"对话已清空"})}catch{}},H=s=>{M.value=s,m.value=`请使用${s.name}工具帮我分析数据`,v({message:`已选择工具：${s.name}`,type:"success",duration:2e3})},G=s=>{const t={overview:"请提供当前系统的数据概览",anomaly:"请检测当前是否存在质量异常",report:"请生成本月的质量分析报告",prediction:"请预测下个月的质量趋势"};m.value=t[s.action]||s.text,T()},W=s=>{m.value=s,T()},T=async()=>{if(!m.value.trim()||h.value)return;const s=m.value.trim(),t=Date.now();f.value.push({type:"user",content:s,timestamp:new Date}),m.value="",N();try{await X(s),E.value=Date.now()-t}catch(d){console.error("AI处理错误:",d),f.value.push({type:"ai",content:"抱歉，处理您的问题时出现了错误。请稍后重试。",timestamp:new Date}),v({message:"处理失败，请稍后重试",type:"error"})}N()},X=async s=>{h.value=!0,_.value=[];try{D("understanding","理解用户问题","processing","正在分析问题意图和关键信息..."),await z(800),b(0,"completed","问题理解完成，识别出关键要素"),D("data_retrieval","检索相关数据","processing","从数据库中查找相关信息..."),await z(600),b(1,"completed","成功检索到相关数据记录"),D("ai_analysis","AI智能分析","processing","调用DeepSeek大模型进行深度分析...");let t;if(k.value)try{t=await Y(s),b(2,"completed","AI分析完成，生成专业回答")}catch(d){console.error("AI调用失败:",d),t=L(s),b(2,"completed","使用基础模式生成回答"),v({message:"AI服务暂时不可用，已切换到基础模式",type:"warning"})}else t=L(s),b(2,"completed","基础模式分析完成");D("result_formatting","整理分析结果","processing","格式化输出结果..."),await z(300),b(3,"completed","结果整理完成，准备展示"),f.value.push({type:"ai",content:t,timestamp:new Date})}finally{h.value=!1}},Y=async s=>{const t=await fetch(`${$.baseURL}${$.endpoint}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${$.apiKey}`},body:JSON.stringify({model:$.model,messages:[{role:"system",content:`你是IQE质量管理系统的AI智能助手，专门负责质量管理数据分析和问答。

当前系统数据概览：
- 库存记录：${n.inventory}条
- 生产记录：${n.production}条
- 检测记录：${n.inspection}条

请基于用户问题提供专业、准确、有用的回答。回答要结构化、易读，可以使用适当的格式和符号。`},{role:"user",content:s}],temperature:.7,max_tokens:2e3})});if(!t.ok)throw new Error(`AI API错误: ${t.status}`);return(await t.json()).choices[0].message.content},L=s=>{const t=s.toLowerCase();return t.includes("库存")||t.includes("inventory")?`📦 **库存查询结果**

根据您的查询，当前系统中共有 ${n.inventory} 条库存记录。

**主要信息：**
- 总库存记录数：${n.inventory}
- 涉及多个工厂和仓库
- 包含各类物料的详细信息

**建议操作：**
1. 查看具体库存详情页面
2. 筛选特定工厂或物料
3. 检查库存状态和预警信息

如需更详细的分析，请启用AI增强模式。`:t.includes("生产")||t.includes("production")?`🏭 **生产数据分析**

当前生产数据概览：

**数据统计：**
- 生产记录总数：${n.production}
- 覆盖多条生产线
- 包含质量检测结果

**关键指标：**
- 生产效率正常
- 质量合格率稳定
- 异常情况已标记

建议查看生产管理页面获取更详细信息。`:t.includes("检测")||t.includes("质量")||t.includes("inspection")?`🔍 **质量检测分析**

质量检测数据概览：

**检测统计：**
- 检测记录数：${n.inspection}
- 涵盖各类质量指标
- 实时更新检测结果

**质量状态：**
- 整体质量水平良好
- 异常批次已识别
- 改进建议已生成

如需深度分析，建议使用AI增强模式。`:`🤖 **智能助手回复**

我收到了您的问题："${s}"

**基础分析：**
这是一个关于质量管理的问题。基于当前数据：
- 库存记录：${n.inventory}条
- 生产记录：${n.production}条
- 检测记录：${n.inspection}条

**建议：**
1. 启用AI增强模式获得更专业的分析
2. 选择左侧相关工具进行深入分析
3. 查看对应的数据管理页面

如有其他问题，请随时询问！`},D=(s,t,d,r="")=>{_.value.push({type:s,title:t,status:d,details:r,timestamp:new Date})},b=(s,t,d="")=>{_.value[s]&&(_.value[s].status=t,d&&(_.value[s].details=d))},Z=s=>({understanding:"🤔",data_retrieval:"📊",ai_analysis:"🤖",result_formatting:"📝"})[s]||"⚙️",ee=s=>({processing:"处理中...",completed:"已完成",failed:"失败"})[s]||s,te=s=>s?new Date(s).toLocaleTimeString():"",se=s=>s.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>"),ae=async s=>{try{await navigator.clipboard.writeText(s),v({message:"内容已复制到剪贴板",type:"success"})}catch{v({message:"复制失败",type:"error"})}},ne=s=>{v({message:"感谢您的反馈！",type:"success"})},oe=()=>{v({message:"语音输入功能开发中...",type:"info"})},ie=()=>{v({message:"文件上传功能开发中...",type:"info"})},z=s=>new Promise(t=>setTimeout(t,s)),N=()=>{Ie(()=>{x.value&&(x.value.scrollTop=x.value.scrollHeight)})};pe(async()=>{console.log("🤖 AI智能助手重新设计版本已加载"),await le(),setTimeout(()=>{f.value.length===0&&v({message:"欢迎使用IQE AI智能助手！",type:"success",duration:3e3})},1e3)});const le=async()=>{try{console.log("📊 获取数据统计...");const t=await(await fetch("/api/data/status")).json();t.success?(n.inventory=t.data.inventory,n.inspection=t.data.lab,n.production=t.data.online,n.lastSync=t.data.lastSync,console.log("✅ 数据统计获取成功:",t.data)):(console.error("❌ 获取数据统计失败:",t.message),Q())}catch(s){console.error("❌ 获取数据统计异常:",s),Q()}},Q=()=>{try{const s=localStorage.getItem("unified_inventory_data")||localStorage.getItem("inventory_data"),t=localStorage.getItem("unified_lab_data")||localStorage.getItem("lab_data"),d=localStorage.getItem("unified_factory_data")||localStorage.getItem("factory_data");if(s){const r=JSON.parse(s);n.inventory=r.length}if(t){const r=JSON.parse(t);n.inspection=r.length}if(d){const r=JSON.parse(d);n.production=r.length}console.log("📊 从localStorage加载数据统计:",n)}catch(s){console.warn("从localStorage加载数据统计失败:",s),n.inventory=132,n.inspection=396,n.production=1056}};return(s,t)=>{const d=w("el-switch"),r=w("el-button"),ce=w("el-tag"),A=w("el-icon"),re=w("Like"),de=w("el-input");return i(),c("div",xe,[e("div",$e,[t[3]||(t[3]=e("div",{class:"navbar-left"},[e("div",{class:"logo-section"},[e("div",{class:"logo-icon"},"🤖"),e("div",{class:"logo-text"},[e("h1",null,"IQE AI 智能助手"),e("p",null,"基于DeepSeek大模型的质量管理专家")])])],-1)),e("div",Te,[e("div",{class:V(["status-indicator",{active:k.value}])},[t[2]||(t[2]=e("div",{class:"status-dot"},null,-1)),e("span",null,o(k.value?"AI增强模式":"基础模式"),1)],2),l(d,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=a=>k.value=a),onChange:J,size:"large","active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"]),l(r,{onClick:P,type:"primary",icon:I(ve),circle:""},null,8,["icon"]),l(r,{onClick:j,type:"info",icon:I(ge),circle:""},null,8,["icon"])])]),e("div",De,[e("div",Ve,[t[5]||(t[5]=e("div",{class:"panel-header"},[e("h3",null,"🛠️ 智能工具箱"),e("p",null,"选择工具开始智能分析")],-1)),e("div",Me,[(i(!0),c(S,null,C(q.value,a=>{var g;return i(),c("div",{key:a.id,class:V(["tool-card",{active:((g=M.value)==null?void 0:g.id)===a.id}]),onClick:R=>H(a)},[e("div",{class:"tool-icon",style:be({background:a.color})},o(a.icon),5),e("div",Be,[e("h4",null,o(a.name),1),e("p",null,o(a.description),1)]),a.category?(i(),c("div",Ee,o(a.category),1)):y("",!0)],10,ze)}),128))]),e("div",Le,[t[4]||(t[4]=e("h4",null,"⚡ 快速操作",-1)),e("div",Ne,[(i(!0),c(S,null,C(K.value,a=>(i(),O(r,{key:a.text,onClick:g=>G(a),size:"small",type:a.type,plain:""},{default:u(()=>[B(o(a.icon)+" "+o(a.text),1)]),_:2},1032,["onClick","type"]))),128))])])]),e("div",Qe,[e("div",Re,[e("div",Oe,[t[6]||(t[6]=e("h3",null,"💬 智能对话",-1)),e("div",Fe,[e("span",null,"对话轮次: "+o(f.value.length/2|0),1),e("span",null,"响应时间: "+o(E.value)+"ms",1)])]),e("div",qe,[(i(!0),c(S,null,C(U.value,a=>(i(),O(ce,{key:a,onClick:g=>W(a),class:"question-tag",effect:"plain",size:"small"},{default:u(()=>[B(o(a),1)]),_:2},1032,["onClick"]))),128))])]),e("div",{class:"chat-content",ref_key:"chatContent",ref:x},[f.value.length===0?(i(),c("div",Ke,t[7]||(t[7]=[e("div",{class:"welcome-icon"},"🎯",-1),e("h3",null,"欢迎使用IQE AI智能助手",-1),e("p",null,"我是您的质量管理专家，可以帮助您：",-1),e("ul",null,[e("li",null,"📊 分析质量数据和趋势"),e("li",null,"🔍 查询库存、生产、检测信息"),e("li",null,"📈 生成可视化图表和报告"),e("li",null,"🤖 提供专业的质量管理建议")],-1),e("p",null,"请选择左侧工具或直接提问开始对话！",-1)]))):y("",!0),(i(!0),c(S,null,C(f.value,(a,g)=>(i(),c("div",{key:g,class:V(["message-item",a.type])},[e("div",Ue,[e("div",je,o(a.type==="user"?"👤":"🤖"),1),a.type==="ai"?(i(),c("div",Je)):y("",!0)]),e("div",Pe,[e("div",{class:"message-content",innerHTML:se(a.content)},null,8,He),e("div",Ge,[e("span",We,o(te(a.timestamp)),1),a.type==="ai"?(i(),c("div",Xe,[l(r,{size:"small",text:"",onClick:R=>ae(a.content)},{default:u(()=>[l(A,null,{default:u(()=>[l(I(we))]),_:1})]),_:2},1032,["onClick"]),l(r,{size:"small",text:"",onClick:R=>ne()},{default:u(()=>[l(A,null,{default:u(()=>[l(re)]),_:1})]),_:2},1032,["onClick"])])):y("",!0)])])],2))),128)),h.value?(i(),c("div",Ye,t[8]||(t[8]=[me('<div class="message-avatar" data-v-08a6c405><div class="avatar-icon" data-v-08a6c405>🤖</div><div class="avatar-status loading" data-v-08a6c405></div></div><div class="message-bubble" data-v-08a6c405><div class="typing-indicator" data-v-08a6c405><span data-v-08a6c405></span><span data-v-08a6c405></span><span data-v-08a6c405></span></div><div class="loading-text" data-v-08a6c405>AI正在思考中...</div></div>',2)]))):y("",!0)],512),e("div",Ze,[e("div",et,[l(de,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=a=>m.value=a),type:"textarea",rows:2,placeholder:"请输入您的问题... (支持 Ctrl+Enter 快速发送)",onKeydown:_e(ye(T,["ctrl"]),["enter"]),disabled:h.value,class:"message-input"},null,8,["modelValue","onKeydown","disabled"]),e("div",tt,[e("div",st,[l(r,{size:"small",text:"",onClick:oe},{default:u(()=>[l(A,null,{default:u(()=>[l(I(fe))]),_:1})]),_:1}),l(r,{size:"small",text:"",onClick:ie},{default:u(()=>[l(A,null,{default:u(()=>[l(I(he))]),_:1})]),_:1})]),l(r,{type:"primary",onClick:T,loading:h.value,disabled:!m.value.trim(),class:"send-button"},{default:u(()=>[l(A,null,{default:u(()=>[l(I(ke))]),_:1}),B(" "+o(h.value?"发送中":"发送"),1)]),_:1},8,["loading","disabled"])])])])]),e("div",at,[t[15]||(t[15]=e("div",{class:"panel-header"},[e("h3",null,"🧠 AI分析过程"),e("p",null,"实时展示AI思考步骤")],-1)),e("div",nt,[_.value.length===0?(i(),c("div",ot,t[9]||(t[9]=[e("div",{class:"empty-icon"},"💭",-1),e("p",null,"等待AI开始分析...",-1)]))):y("",!0),(i(!0),c(S,null,C(_.value,(a,g)=>(i(),c("div",{key:g,class:V(["thinking-step",a.status])},[e("div",it,[e("div",lt,o(g+1),1),g<_.value.length-1?(i(),c("div",ct)):y("",!0)]),e("div",rt,[e("div",dt,[e("span",ut,o(Z(a.type)),1),e("span",pt,o(a.title),1),e("span",vt,o(ee(a.status)),1)]),a.details?(i(),c("div",gt,[e("p",null,o(a.details),1)])):y("",!0),a.status==="processing"?(i(),c("div",mt,t[10]||(t[10]=[e("div",{class:"progress-bar"},null,-1)]))):y("",!0)])],2))),128))]),e("div",_t,[t[14]||(t[14]=e("h4",null,"📊 数据概览",-1)),e("div",yt,[e("div",ft,[e("div",ht,o(n.inventory),1),t[11]||(t[11]=e("div",{class:"stat-label"},"库存记录",-1))]),e("div",kt,[e("div",bt,o(n.production),1),t[12]||(t[12]=e("div",{class:"stat-label"},"生产记录",-1))]),e("div",wt,[e("div",It,o(n.inspection),1),t[13]||(t[13]=e("div",{class:"stat-label"},"检测记录",-1))])])])])])])}}},Tt=Se(At,[["__scopeId","data-v-08a6c405"]]);export{Tt as default};
