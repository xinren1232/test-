<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—®ç­”åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .test-button {
            background: #409eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-result {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        .error {
            background: #fef2f2;
            border-color: #fecaca;
            color: #dc2626;
        }
        .success {
            background: #f0fdf4;
            border-color: #bbf7d0;
            color: #16a34a;
        }
    </style>
</head>
<body>
    <h1>ğŸ¤– IQE AIæ™ºèƒ½åŠ©æ‰‹ - é—®ç­”åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-container">
        <h2>ğŸ“‹ æµ‹è¯•è¯´æ˜</h2>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•AIæ™ºèƒ½åŠ©æ‰‹çš„é—®ç­”åŠŸèƒ½ã€‚è¯·åœ¨ä¸‹æ–¹è¾“å…¥é—®é¢˜è¿›è¡Œæµ‹è¯•ã€‚</p>
        <p><strong>æ³¨æ„</strong>ï¼šæ­¤æµ‹è¯•é¡µé¢éœ€è¦åœ¨IQEåº”ç”¨è¿è¡Œæ—¶ä½¿ç”¨ï¼Œç¡®ä¿ http://localhost:5173 å¯è®¿é—®ã€‚</p>
    </div>

    <div class="test-container">
        <h2>ğŸ” åŸºç¡€åŠŸèƒ½æµ‹è¯•</h2>
        <input type="text" class="test-input" id="basicQuery" placeholder="è¾“å…¥é—®é¢˜ï¼Œå¦‚ï¼šæŸ¥è¯¢æ·±åœ³å·¥å‚åº“å­˜" value="æŸ¥è¯¢æ·±åœ³å·¥å‚åº“å­˜">
        <button class="test-button" onclick="testBasicQuery()">æµ‹è¯•åŸºç¡€é—®ç­”</button>
        <div id="basicResult" class="test-result" style="display: none;"></div>
    </div>

    <div class="test-container">
        <h2>ğŸ¤– AIåŠŸèƒ½æµ‹è¯•</h2>
        <input type="text" class="test-input" id="aiQuery" placeholder="è¾“å…¥å¤æ‚é—®é¢˜ï¼Œå¦‚ï¼šåˆ†ææ·±åœ³å·¥å‚çš„æ•´ä½“è´¨é‡çŠ¶å†µ" value="åˆ†ææ·±åœ³å·¥å‚çš„æ•´ä½“è´¨é‡çŠ¶å†µ">
        <button class="test-button" onclick="testAIQuery()">æµ‹è¯•AIåˆ†æ</button>
        <div id="aiResult" class="test-result" style="display: none;"></div>
    </div>

    <div class="test-container">
        <h2>ğŸ“Š é¢„è®¾æµ‹è¯•ç”¨ä¾‹</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
            <button class="test-button" onclick="runTestCase('æŸ¥è¯¢é£é™©åº“å­˜')">æŸ¥è¯¢é£é™©åº“å­˜</button>
            <button class="test-button" onclick="runTestCase('BOEä¾›åº”å•†è¡¨ç°')">BOEä¾›åº”å•†è¡¨ç°</button>
            <button class="test-button" onclick="runTestCase('æ·±åœ³å·¥å‚è´¨é‡çŠ¶å†µ')">æ·±åœ³å·¥å‚è´¨é‡çŠ¶å†µ</button>
            <button class="test-button" onclick="runTestCase('ç”Ÿäº§ä¸è‰¯ç‡åˆ†æ')">ç”Ÿäº§ä¸è‰¯ç‡åˆ†æ</button>
            <button class="test-button" onclick="runTestCase('æ˜¾ç¤ºåº“å­˜çŠ¶æ€å›¾è¡¨')">æ˜¾ç¤ºåº“å­˜çŠ¶æ€å›¾è¡¨</button>
            <button class="test-button" onclick="runTestCase('æµ‹è¯•å¤±è´¥è®°å½•')">æµ‹è¯•å¤±è´¥è®°å½•</button>
        </div>
        <div id="testCaseResult" class="test-result" style="display: none;"></div>
    </div>

    <div class="test-container">
        <h2>ğŸ”§ APIè¿æ¥æµ‹è¯•</h2>
        <button class="test-button" onclick="testAPIConnection()">æµ‹è¯•DeepSeek APIè¿æ¥</button>
        <div id="apiResult" class="test-result" style="display: none;"></div>
    </div>

    <script>
        // åŸºç¡€é—®ç­”æµ‹è¯•
        async function testBasicQuery() {
            const query = document.getElementById('basicQuery').value;
            const resultDiv = document.getElementById('basicResult');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result';
            resultDiv.textContent = 'ğŸ” æ­£åœ¨æµ‹è¯•åŸºç¡€é—®ç­”åŠŸèƒ½...';
            
            try {
                // æ¨¡æ‹ŸåŸºç¡€é—®ç­”é€»è¾‘
                const result = simulateBasicQuery(query);
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… åŸºç¡€é—®ç­”æµ‹è¯•æˆåŠŸï¼\n\næŸ¥è¯¢: ${query}\nå›å¤: ${result.reply}`;
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ åŸºç¡€é—®ç­”æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        }

        // AIåˆ†ææµ‹è¯•
        async function testAIQuery() {
            const query = document.getElementById('aiQuery').value;
            const resultDiv = document.getElementById('aiResult');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result';
            resultDiv.textContent = 'ğŸ¤– æ­£åœ¨æµ‹è¯•AIåˆ†æåŠŸèƒ½...';
            
            try {
                const result = await testDeepSeekAPI(query);
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… AIåˆ†ææµ‹è¯•æˆåŠŸï¼\n\næŸ¥è¯¢: ${query}\nå›å¤: ${result.content || 'æµ‹è¯•å®Œæˆ'}`;
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ AIåˆ†ææµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        }

        // è¿è¡Œæµ‹è¯•ç”¨ä¾‹
        async function runTestCase(testQuery) {
            const resultDiv = document.getElementById('testCaseResult');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result';
            resultDiv.textContent = `ğŸ§ª æ­£åœ¨è¿è¡Œæµ‹è¯•ç”¨ä¾‹: ${testQuery}...`;
            
            try {
                const result = simulateBasicQuery(testQuery);
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… æµ‹è¯•ç”¨ä¾‹æ‰§è¡ŒæˆåŠŸï¼\n\næµ‹è¯•: ${testQuery}\nç»“æœ: ${result.reply}`;
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå¤±è´¥: ${error.message}`;
            }
        }

        // APIè¿æ¥æµ‹è¯•
        async function testAPIConnection() {
            const resultDiv = document.getElementById('apiResult');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result';
            resultDiv.textContent = 'ğŸ” æ­£åœ¨æµ‹è¯•DeepSeek APIè¿æ¥...';
            
            try {
                const result = await testDeepSeekAPI('ä½ å¥½ï¼Œè¯·ç®€å•ä»‹ç»ä¸€ä¸‹ä½ çš„èƒ½åŠ›');
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… APIè¿æ¥æµ‹è¯•æˆåŠŸï¼\n\nå“åº”: ${result.content || 'è¿æ¥æ­£å¸¸'}`;
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ APIè¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}\n\nå¯èƒ½åŸå› :\n- ç½‘ç»œè¿æ¥é—®é¢˜\n- APIå¯†é’¥æ— æ•ˆ\n- CORSè·¨åŸŸé™åˆ¶`;
            }
        }

        // æ¨¡æ‹ŸåŸºç¡€é—®ç­”
        function simulateBasicQuery(query) {
            const mockData = {
                inventory: 132,
                riskItems: 15,
                factories: ['æ·±åœ³å·¥å‚', 'ä¸Šæµ·å·¥å‚', 'åŒ—äº¬å·¥å‚'],
                suppliers: ['BOE', 'åæ˜Ÿå…‰ç”µ', 'ä¸‰æ˜Ÿç”µå­']
            };

            if (query.includes('åº“å­˜')) {
                if (query.includes('é£é™©')) {
                    return { reply: `å½“å‰å…±æœ‰ ${mockData.riskItems} ä¸ªé£é™©åº“å­˜é¡¹ç›®` };
                }
                if (query.includes('æ·±åœ³')) {
                    return { reply: `æ·±åœ³å·¥å‚åº“å­˜æ¦‚å†µï¼šæ€»è®¡ 44 ä¸ªç‰©æ–™é¡¹ç›®ï¼Œæ­£å¸¸: 35ä¸ªï¼Œé£é™©: 6ä¸ªï¼Œå†»ç»“: 3ä¸ª` };
                }
                return { reply: `åº“å­˜æ€»è§ˆï¼šæ€»è®¡ ${mockData.inventory} ä¸ªåº“å­˜é¡¹ç›®` };
            }

            if (query.includes('BOE') || query.includes('ä¾›åº”å•†')) {
                return { reply: `BOEä¾›åº”å•†åˆ†æï¼šåº“å­˜ç‰©æ–™: 28ä¸ªï¼Œå¹³å‡ä¸è‰¯ç‡: 2.3%` };
            }

            if (query.includes('è´¨é‡') || query.includes('ä¸è‰¯ç‡')) {
                return { reply: `è´¨é‡çŠ¶å†µåˆ†æï¼šæµ‹è¯•å¤±è´¥ç‡: 8.5%ï¼Œå¹³å‡ä¸è‰¯ç‡: 3.2%` };
            }

            if (query.includes('å›¾è¡¨')) {
                return { reply: `åº“å­˜çŠ¶æ€åˆ†å¸ƒå›¾è¡¨å·²ç”Ÿæˆã€‚æ­£å¸¸: 102ä¸ªï¼Œé£é™©: 15ä¸ªï¼Œå†»ç»“: 15ä¸ª` };
            }

            return { reply: `æˆ‘ç†è§£æ‚¨è¯¢é—®çš„æ˜¯"${query}"ã€‚è¯·å°è¯•æ›´å…·ä½“çš„é—®é¢˜ã€‚` };
        }

        // æµ‹è¯•DeepSeek API
        async function testDeepSeekAPI(query) {
            const apiKey = 'sk-cab797574abf4288bcfaca253191565d';
            const baseURL = 'https://api.deepseek.com';
            const endpoint = '/chat/completions';
            
            const response = await fetch(baseURL + endpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'deepseek-chat',
                    messages: [
                        {
                            role: 'system',
                            content: 'ä½ æ˜¯ä¸€ä¸ªè´¨é‡ç®¡ç†ä¸“å®¶ï¼Œè¯·ç®€æ´å›ç­”ã€‚'
                        },
                        {
                            role: 'user',
                            content: query
                        }
                    ],
                    max_tokens: 100,
                    temperature: 0.7,
                    stream: false
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(`APIé”™è¯¯ ${response.status}: ${errorData.error?.message || response.statusText}`);
            }
            
            const data = await response.json();
            return {
                content: data.choices[0].message.content,
                model: data.model,
                usage: data.usage
            };
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¤– é—®ç­”åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“‹ å¯ç”¨æµ‹è¯•åŠŸèƒ½:');
            console.log('   1. åŸºç¡€é—®ç­”æµ‹è¯•');
            console.log('   2. AIåˆ†ææµ‹è¯•');
            console.log('   3. é¢„è®¾æµ‹è¯•ç”¨ä¾‹');
            console.log('   4. APIè¿æ¥æµ‹è¯•');
        });
    </script>
</body>
</html>
